<!DOCTYPE html>
<html lang="{{ site.lang | default: 'en-US' }}" class=" {% if site.fixed_navbar %} has-navbar-fixed-top {% endif %}" >
{% include im-head.html %}
<body class="{% if page.content_type %}content-type-{{ page.content_type }}{% endif %} layout-{{ page.layout | default: 'default'}}">
  {% include im-navbar.html %}
  <header class="webseries-header">
    <div class="container">
      <a href="/webseries/" class="back-link">← All Series</a>
      <h1>{{ page.title }}</h1>
      
      {% if page.content_type == 'episode' %}
        {% assign series = site.webseries | where: "is_series", true | where: "series_slug", page.series_slug | first %}
        <p class="series-title">Part of: <a href="{{ series.url }}">{{ series.title }}</a></p>
      {% endif %}
    </div>
  </header>

  <main class="webseries-main container">
    {% if page.is_series_listing %}
      <!-- Series listing page -->
      <div class="series-grid">
        {% assign all_series = site.webseries | where: "is_series", true %}
        {% for series in all_series %}
          <a href="{{ series.url }}" class="series-card">
            <div class="series-thumb" style="background-image: url('{{ series.thumbnail }}')"></div>
            <h3>{{ series.title }}</h3>
            <p>{{ series.description | truncate: 100 }}</p>
          </a>
        {% endfor %}
      </div>

    {% elsif page.is_series %}
      <!-- Series detail page -->
      <div class="series-detail">
        <div class="series-hero" style="background-image: url('{{ page.banner }}')"></div>
        
        <div class="series-content">
          <div class="main-content">
            {{ content }}
          </div>
          
          <aside class="series-sidebar">
            <div class="episode-list">
              <h3>Episodes</h3>
              {% assign episodes = site.webseries | where: "series_slug", page.series_slug | where: "content_type", "episode" | sort: "episode_number" %}
              {% for ep in episodes %}
                <a href="{{ ep.url }}" class="episode-link {% if ep.url == page.url %}active{% endif %}">
                  <span class="episode-number">#{{ ep.episode_number }}</span>
                  <span class="episode-title">{{ ep.title }}</span>
                  <span class="episode-duration">{{ ep.duration }}</span>
                </a>
              {% endfor %}
            </div>
          </aside>
        </div>
      </div>

    {% elsif page.content_type == 'episode' %}
      <!-- Episode page -->
      <div class="episode-content">
        {% if page.media_type == 'youtube' %}
          <div class="video-container">
            <iframe src="https://www.youtube.com/embed/{{ page.youtube_id }}" frameborder="0" allowfullscreen></iframe>
          </div>
        {% elsif page.media_type == 'video' %}
          <div class="video-container">
            <video controls>
              <source src="{{ page.video_url }}" type="video/mp4">
            </video>
          </div>
        {% endif %}

        <article class="episode-article">
          {{ content }}
        </article>

        <div class="episode-nav">
          {% assign all_eps = site.webseries | where: "series_slug", page.series_slug | where: "content_type", "episode" | sort: "episode_number" %}
          {% for ep in all_eps %}
            {% if ep.episode_number == page.episode_number %}
              {% unless forloop.first %}
                {% assign prev = all_eps[forloop.index0 | minus: 1] %}
                <a href="{{ prev.url }}" class="nav-button prev">← {{ prev.title }}</a>
              {% endunless %}
              {% unless forloop.last %}
                {% assign next = all_eps[forloop.index0 | plus: 1] %}
                <a href="{{ next.url }}" class="nav-button next">{{ next.title }} →</a>
              {% endunless %}
            {% endif %}
          {% endfor %}
        </div>
      </div>
    {% endif %}
  </main>

  <footer class="webseries-footer">
    <div class="container">
      <p>© {{ site.time | date: '%Y' }} Web Series</p>
    </div>
  </footer>

</body>
</html>