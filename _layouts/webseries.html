---
layout: default
---

 <style>
        /* Minimal Custom CSS for Pure Bulma Approach */
        #video-player iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }
        #episode-list {
            max-height: 60vh; 
            overflow-y: auto;
        }
        .episode-title-text { 
            display: inline-block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: calc(100% - 30px); 
            vertical-align: middle;
        }
        .player-controls .slider {
             width: 100%;
        }
        .player-controls { 
            z-index: 10; 
            border-top: 1px solid hsl(0, 0%, 86%); /* Add a separator like Bulma's box */
        }
         /* Ensure player box itself doesn't get extra padding if it's a Bulma box */
        #main-player-box.box {
            padding: 0;
        }
    </style>
</head>

  
        <nav class="navbar is-white has-shadow" role="navigation" aria-label="main navigation">
            <div class="container">
                <div class="navbar-brand">
                    <a class="navbar-item has-text-weight-bold is-size-4" href="{{ "/" | relative_url }}">
                        {{ site.title | default: "My Web Series Site" }}
                    </a>
                </div>
            </div>
        </nav>

    <main class="main">
        <div class="webseries-page-container">
            <section class="section">
                <div class="container">
                    <div class="columns is-vcentered is-multiline">
                        {% if page.series_poster %}
                        <div class="column is-full-mobile is-one-third-tablet is-one-quarter-desktop">
                            <figure class="image is-2by3">
                                <img src="{{ page.series_poster | relative_url }}" alt="{{ page.title }} Poster" style="border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                            </figure>
                        </div>
                        {% endif %}
                        <div class="column is-full-mobile {% if page.series_poster %}is-two-thirds-tablet is-three-quarters-desktop{% else %}is-full{% endif %}">
                            <h1 class="title is-size-1-desktop is-size-2-tablet is-size-3-mobile has-text-grey-darker">{{ page.title }}</h1>
                            {% if page.description %}<p class="subtitle is-size-4-desktop is-size-5-tablet is-size-6-mobile has-text-grey">{{ page.description }}</p>{% endif %}
                            {% if page.series_creator_name %}<p class="is-size-5 mb-3"><strong>Creator/Channel:</strong> {{ page.series_creator_name }}</p>{% endif %}
                            {% if page.tags %}<div class="tags mb-4">{% for tag in page.tags %}<span class="tag is-info is-light">{{ tag }}</span>{% endfor %}</div>{% endif %}
                        </div>
                    </div>
                </div>
            </section>

            <section class="section pt-0">
                <div class="container">
                    <div class="columns is-variable is-1-mobile is-3-tablet is-5-desktop">
                        <div class="column is-two-thirds-desktop is-full-tablet">
                            <div class="box" id="main-player-box"> {/* Added .box for consistent styling */}
                                <figure class="image is-16by9" id="video-wrapper-bulma">
                                    <div id="video-player">
                                        <!-- YouTube Player will be injected here -->
                                    </div>
                                </figure>
                                
                                <div class="player-controls p-3 has-background-grey-darker has-text-light">
                                    <div class="level is-mobile mb-2">
                                        <div class="level-left">
                                            <div class="level-item"><button id="play-pause-btn" class="button is-primary is-small is-rounded" title="Play/Pause"><span class="icon is-small"><i class="fas fa-play"></i></span></button></div>
                                            <div class="level-item"><button id="prev-episode-btn" class="button is-light is-small is-rounded" title="Previous Episode" disabled><span class="icon is-small"><i class="fas fa-backward-step"></i></span></button></div>
                                            <div class="level-item"><button id="next-episode-btn" class="button is-light is-small is-rounded" title="Next Episode" disabled><span class="icon is-small"><i class="fas fa-forward-step"></i></span></button></div>
                                            <div class="level-item current-time-display">00:00</div>
                                        </div>
                                        <div class="level-right"><div class="level-item total-time-display">00:00</div></div>
                                    </div>
                                    <input type="range" id="progress-bar" class="slider is-fullwidth is-small is-primary has-background-grey-light" value="0" step="0.1" title="Seek">
                                    <div class="level is-mobile mt-2">
                                        <div class="level-left">
                                            <div class="level-item"><button id="mute-btn" class="button is-light is-small is-rounded" title="Mute/Unmute"><span class="icon is-small"><i class="fas fa-volume-up"></i></span></button></div>
                                            <div class="level-item field" style="width: 80px;"><input type="range" id="volume-slider" class="slider is-small is-primary has-background-grey-light" min="0" max="1" value="1" step="0.05" title="Volume"></div>
                                            <div class="level-item">
                                                <label class="checkbox is-small" id="autoplay-checkbox-label" for="autoplay-checkbox" title="Autoplay next episode">
                                                    <input type="checkbox" id="autoplay-checkbox" checked> Autoplay
                                                </label>
                                            </div>
                                        </div>
                                        <div class="level-right">
                                            <div class="level-item"><button id="next-episode-btn-player" class="button is-primary is-small is-rounded is-hidden" title="Play Next Episode">Next Episode <span class="icon is-small ml-1"><i class="fas fa-play"></i></span></button></div>
                                            <div class="level-item"><button id="fullscreen-btn" class="button is-light is-small is-rounded" title="Fullscreen"><span class="icon is-small"><i class="fas fa-expand"></i></span></button></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="box mt-4 display-ad-placeholder is-hidden-desktop has-text-centered">
                                <p>Mobile Ad Banner</p><small>(e.g. 320x50)</small>
                            </div>
                        </div>

                        <div class="column is-one-third-desktop is-full-tablet">
                            <div class="box episode-list-container p-0">
                                <p class="menu-label p-3 has-text-centered is-uppercase has-background-grey-lighter">Episodes</p>
                                <ul id="episode-list" class="menu-list">
                                    <li class="p-3 has-text-grey has-text-centered">Loading episodes...</li>
                                </ul>
                            </div>
                            <div class="box mt-4 display-ad-placeholder is-hidden-touch has-text-centered">
                                <p>Sidebar Ad</p><small>(e.g. 300x250 or 160x600)</small>
                            </div>
                        </div>
                    </div>
                    <div class="columns is-centered is-hidden-touch">
                        <div class="column is-two-thirds-desktop is-full-tablet">
                             <div class="box mt-4 display-ad-placeholder has-text-centered">
                                 <p>Desktop Ad Banner</p><small>(e.g. 728x90)</small>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            {% if content and content != "" and content != " " %}
            <section class="section pt-0">
                <div class="container">
                    <div class="columns is-centered">
                        <div class="column is-two-thirds-desktop is-full-tablet">
                             <div class="content box p-5"> {{ content }} </div>
                        </div>
                    </div>
                </div>
            </section>
            {% endif %}
        </div>
    </main>

    <script type="application/ld+json" id="webseries-jsonld"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    
    <script>
        // --- Pass Jekyll Data to JS ---
        const jekyllPageData = {
            youtubePlaylistId: "{{ page.youtube_playlist_id | escape }}",
            title: "{{ page.title | escape }}",
            description: "{{ page.description | strip_html | replace: '\', '\\\\' | replace: '"', '\\"' | escape }}",
            seriesPoster: "{{ page.series_poster | relative_url | escape }}",
            datePublished: "{{ page.date_published | escape }}",
            genre: "{{ page.genre | escape }}",
            seriesCreatorName: "{{ page.series_creator_name | escape }}",
            actors: {{ page.actors | jsonify | default: '[]' }},
            directors: {{ page.directors | jsonify | default: '[]' }},
            productionCompanyName: "{{ page.production_company_name | escape }}",
            publisherName: "{{ page.publisher_name | default: site.title | escape }}",
            episodeOverrides: {{ page.episode_overrides | jsonify | default: '[]' }}
        };

        document.addEventListener('DOMContentLoaded', () => {
            const videoPlayerContainer = document.getElementById('video-player');
            // const mainPlayerBox = document.getElementById('main-player-box'); // Not strictly needed for fullscreen if figure is targeted
            const videoWrapperBulma = document.getElementById('video-wrapper-bulma'); // Target for fullscreen
            const playPauseBtn = document.getElementById('play-pause-btn');
            const playPauseIcon = playPauseBtn.querySelector('.icon i');
            const progressBar = document.getElementById('progress-bar');
            const currentTimeDisplay = document.querySelector('.current-time-display');
            const totalTimeDisplay = document.querySelector('.total-time-display');
            const muteBtn = document.getElementById('mute-btn');
            const muteIcon = muteBtn.querySelector('.icon i');
            const volumeSlider = document.getElementById('volume-slider');
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            const fullscreenIcon = fullscreenBtn.querySelector('.icon i');
            
            const episodeListUl = document.getElementById('episode-list');
            const prevEpisodeBtn = document.getElementById('prev-episode-btn');
            const nextEpisodeBtn = document.getElementById('next-episode-btn');
            const nextEpisodeBtnPlayer = document.getElementById('next-episode-btn-player');
            const autoplayCheckbox = document.getElementById('autoplay-checkbox');

            let activePlayer = null;
            let isSeeking = false;
            let volumeBeforeMute = 1;
            let progressUpdateInterval = null;
            
            let playlistVideos = []; 
            let currentPlaylistIndex = 0;
            let youtubeApiReady = false;
            let playerIsReady = false;

            const formatTime=(s)=>{if(isNaN(s)||s<0)return"00:00";const t=Math.floor(s),h=Math.floor(t/3600),m=Math.floor(t%3600/60),c=t%60;return h>0?`${h}:${String(m).padStart(2,"0")}:${String(c).padStart(2,"0")}`:`${String(m).padStart(2,"0")}:${String(c).padStart(2,"0")}`};
            const updatePlayPauseIcon=()=>{playerIsReady&&activePlayer.getPlayerState&&activePlayer.getPlayerState()===YT.PlayerState.PLAYING?playPauseIcon.classList.replace("fa-play","fa-pause"):playPauseIcon.classList.replace("fa-pause","fa-play")};
            const updateVolumeIcon=()=>{let c=0,i=!1;if(playerIsReady&&activePlayer.getVolume){c=activePlayer.getVolume()/100;i=activePlayer.isMuted()}muteIcon.classList.remove("fa-volume-up","fa-volume-down","fa-volume-mute");if(i||c===0)muteIcon.classList.add("fa-volume-mute");else if(c<0.5)muteIcon.classList.add("fa-volume-down");else muteIcon.classList.add("fa-volume-up")};
            
            const playerControls = {
                play:()=>{if(playerIsReady&&activePlayer.playVideo)activePlayer.playVideo()},
                pause:()=>{if(playerIsReady&&activePlayer.pauseVideo)activePlayer.pauseVideo()},
                togglePlayPause:()=>{if(!playerIsReady||!activePlayer.getPlayerState)return;const p=activePlayer.getPlayerState();p===YT.PlayerState.PLAYING||p===YT.PlayerState.BUFFERING?playerControls.pause():playerControls.play()},
                seekTo:(t)=>{if(playerIsReady&&activePlayer.seekTo)activePlayer.seekTo(t,!0)},
                setVolume:(v)=>{if(playerIsReady&&activePlayer.setVolume){activePlayer.setVolume(v*100);if(v===0&&activePlayer.mute)activePlayer.mute();else if(v>0&&activePlayer.unMute)activePlayer.unMute()}volumeSlider.value=v;updateVolumeIcon()},
                toggleMute:()=>{if(!playerIsReady||!activePlayer.isMuted)return;if(activePlayer.isMuted()||activePlayer.getVolume&&activePlayer.getVolume()===0){if(activePlayer.unMute)activePlayer.unMute();if(activePlayer.setVolume)activePlayer.setVolume(volumeBeforeMute*100>0?volumeBeforeMute*100:50)}else{if(activePlayer.getVolume)volumeBeforeMute=activePlayer.getVolume()/100;if(activePlayer.mute)activePlayer.mute()}volumeSlider.value=activePlayer.isMuted()?0:activePlayer.getVolume?activePlayer.getVolume()/100:0;updateVolumeIcon()},
                getCurrentTime:()=>playerIsReady&&activePlayer.getCurrentTime?activePlayer.getCurrentTime():0,
                getDuration:()=>playerIsReady&&activePlayer.getDuration?activePlayer.getDuration():NaN,
                toggleFullscreen:()=>{
                    const targetElement = videoWrapperBulma; // Target the figure for fullscreen
                    if(!document.fullscreenElement&&!document.webkitFullscreenElement&&!document.msFullscreenElement){
                        if(targetElement.requestFullscreen)targetElement.requestFullscreen();
                        else if(targetElement.webkitRequestFullscreen)targetElement.webkitRequestFullscreen();
                        else if(targetElement.msRequestFullscreen)targetElement.msRequestFullscreen()
                    }else{
                        if(document.exitFullscreen)document.exitFullscreen();
                        else if(document.webkitExitFullscreen)document.webkitExitFullscreen();
                        else if(document.msExitFullscreen)document.msExitFullscreen()
                    }
                },
                next:()=>{if(playerIsReady&&activePlayer.nextVideo)activePlayer.nextVideo()},
                previous:()=>{if(playerIsReady&&activePlayer.previousVideo)activePlayer.previousVideo()},
                playAt:idx=>{if(playerIsReady&&activePlayer.playVideoAt)activePlayer.playVideoAt(idx)}
            };

            function resetPlayerUI(){playPauseIcon.classList.replace("fa-pause","fa-play");progressBar.value=0;progressBar.max=100;currentTimeDisplay.textContent="00:00";totalTimeDisplay.textContent="00:00";if(progressUpdateInterval)clearInterval(progressUpdateInterval);nextEpisodeBtnPlayer.classList.add("is-hidden");prevEpisodeBtn.disabled=!0;nextEpisodeBtn.disabled=!0}
            
            function initializePlayer(playlistId) {
                if (!youtubeApiReady) { console.warn("YT API not ready, player init deferred."); return; }
                if (!playlistId) { episodeListUl.innerHTML = '<li class="p-3 has-text-grey has-text-centered">No playlist ID.</li>'; return; }
                
                videoPlayerContainer.innerHTML = ""; 
                if (activePlayer && typeof activePlayer.destroy === 'function') activePlayer.destroy();
                activePlayer = null; playerIsReady = false;
                resetPlayerUI();
                episodeListUl.innerHTML = '<li class="p-3 has-text-grey has-text-centered">Initializing player...</li>';

                activePlayer = new YT.Player("video-player", {
                    playerVars: { controls: 0, modestbranding: 1, rel: 0, fs: 0, iv_load_policy: 3, listType: "playlist", list: playlistId, origin: window.location.origin },
                    events: { onReady: onPlayerReady, onStateChange: onPlayerStateChange }
                });
            }
            
            window.onYouTubeIframeAPIReady = () => {
                youtubeApiReady = true;
                if (jekyllPageData.youtubePlaylistId) {
                    initializePlayer(jekyllPageData.youtubePlaylistId);
                }
            };

            function onPlayerReady(event) {
                activePlayer = event.target; playerIsReady = true;
                playerControls.setVolume(parseFloat(volumeSlider.value));
                populateEpisodeList(); updateProgressUI(); 
                if(progressUpdateInterval) clearInterval(progressUpdateInterval);
                progressUpdateInterval = setInterval(updateProgressUI, 250);
            }

            function populateEpisodeList() {
                if(!playerIsReady||!activePlayer.getPlaylist){episodeListUl.innerHTML='<li class="p-3 has-text-grey has-text-centered">Could not load episodes.</li>';return}
                const p=activePlayer.getPlaylist();if(!p||p.length===0){episodeListUl.innerHTML='<li class="p-3 has-text-grey has-text-centered">Playlist is empty/invalid.</li>';return}
                playlistVideos=[];episodeListUl.innerHTML="";
                p.forEach((vId,idx)=>{
                    const override = jekyllPageData.episodeOverrides.find(eo => eo.video_id === vId) || {};
                    const title = override.title || `Episode ${idx + 1} (Loading...)`;
                    playlistVideos.push({ 
                        id: vId, title: title, 
                        description: override.description || jekyllPageData.description, 
                        thumbnail: override.thumbnail ? window.location.origin + override.thumbnail : (jekyllPageData.seriesPoster ? window.location.origin + jekyllPageData.seriesPoster : undefined),
                        air_date: override.air_date || jekyllPageData.datePublished,
                        episode_number: override.episode_number || idx + 1 
                    });
                    const li=document.createElement("li");
                    const a=document.createElement("a"); a.dataset.index=idx;
                    a.innerHTML=`<span class="icon is-small"><i class="fas fa-play-circle"></i></span><span class="episode-title-text">${title}</span>`;
                    a.addEventListener("click",(e)=>{ e.preventDefault(); playerControls.playAt(idx); }); // Added preventDefault
                    li.appendChild(a);
                    episodeListUl.appendChild(li)
                });
                updateEpisodeListHighlight(); generateJsonLd();
            }

            function updateEpisodeListHighlight() {
                if(!playerIsReady||!activePlayer.getPlaylistIndex||!playlistVideos.length)return;
                currentPlaylistIndex=activePlayer.getPlaylistIndex();
                document.querySelectorAll("#episode-list li a").forEach(aEl=>{
                    aEl.classList.remove("is-active"); 
                    if(parseInt(aEl.dataset.index)===currentPlaylistIndex){
                        aEl.classList.add("is-active");
                        const tt=aEl.querySelector(".episode-title-text");
                        if(tt&&activePlayer.getVideoData&&activePlayer.getVideoData().title){
                            const ytTitle=activePlayer.getVideoData().title;tt.textContent=ytTitle;
                            if(playlistVideos[currentPlaylistIndex]) playlistVideos[currentPlaylistIndex].title=ytTitle;
                        } else if (tt&&playlistVideos[currentPlaylistIndex]){tt.textContent=playlistVideos[currentPlaylistIndex].title}
                        aEl.parentElement.scrollIntoView({behavior:"smooth",block:"nearest"});
                    }
                });
                prevEpisodeBtn.disabled=currentPlaylistIndex===0;
                nextEpisodeBtn.disabled=currentPlaylistIndex>=playlistVideos.length-1;
                nextEpisodeBtnPlayer.classList.add("is-hidden");
                if (playerIsReady) generateJsonLd();
            }
            
            function onPlayerStateChange(e){
                if (!playerIsReady) return;
                updatePlayPauseIcon();updateEpisodeListHighlight();
                if(e.data===YT.PlayerState.PLAYING){nextEpisodeBtnPlayer.classList.add("is-hidden")}
                else if(e.data===YT.PlayerState.ENDED){
                    progressBar.value=activePlayer.getDuration?activePlayer.getDuration():progressBar.max;
                    if(autoplayCheckbox.checked&¤tPlaylistIndex<playlistVideos.length-1)playerControls.next();
                    else if(currentPlaylistIndex<playlistVideos.length-1)nextEpisodeBtnPlayer.classList.remove("is-hidden")
                } else if (e.data === YT.PlayerState.CUED) { 
                    updateEpisodeListHighlight(); // Important to update title on CUED
                }
                updateProgressUI();
            }
            
            playPauseBtn.addEventListener("click",playerControls.togglePlayPause);
            prevEpisodeBtn.addEventListener("click",playerControls.previous);
            nextEpisodeBtn.addEventListener("click",playerControls.next);
            nextEpisodeBtnPlayer.addEventListener("click",playerControls.next);
            progressBar.addEventListener("input",()=>{isSeeking=!0;currentTimeDisplay.textContent=formatTime(parseFloat(progressBar.value))});
            progressBar.addEventListener("change",()=>{playerControls.seekTo(parseFloat(progressBar.value));isSeeking=!1;});
            volumeSlider.addEventListener("input",()=>{playerControls.setVolume(parseFloat(volumeSlider.value))});
            muteBtn.addEventListener("click",playerControls.toggleMute);
            fullscreenBtn.addEventListener("click",playerControls.toggleFullscreen);

            const updateProgressUI=()=>{if(!playerIsReady||isSeeking||!activePlayer.getCurrentTime)return;const ct=playerControls.getCurrentTime(),dur=playerControls.getDuration();if(!isNaN(dur)&&dur>0){progressBar.value=ct;progressBar.max=dur;currentTimeDisplay.textContent=formatTime(ct);if(totalTimeDisplay.textContent==="00:00"||totalTimeDisplay.textContent==="--:--")totalTimeDisplay.textContent=formatTime(dur)}else totalTimeDisplay.textContent="--:--";updatePlayPauseIcon()};
            
            const onFullscreenChange=()=>{const i=document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement;fullscreenIcon.classList.toggle("fa-compress",!!i);fullscreenIcon.classList.toggle("fa-expand",!i)};
            document.addEventListener("fullscreenchange",onFullscreenChange);document.addEventListener("webkitfullscreenchange",onFullscreenChange);document.addEventListener("msfullscreenchange",onFullscreenChange);

            function generateJsonLd() { /* ... (Same JSON-LD generation function as previous response) ... */
                if (!playerIsReady || playlistVideos.length === 0) return;
                const episodesLd = playlistVideos.map(ep => ({
                    "@type": "TVEpisode", "episodeNumber": ep.episode_number, "name": ep.title,
                    "description": ep.description, "datePublished": ep.air_date, 
                    "url": `${window.location.href.split('?')[0]}#ep${ep.episode_number}`,
                    "partOfTVSeries": { "@type": "WebSeries", "name": jekyllPageData.title },
                    "image": ep.thumbnail,
                    "video": {
                        "@type": "VideoObject", "name": ep.title, "description": ep.description,
                        "thumbnailUrl": ep.thumbnail, "uploadDate": ep.air_date,
                        "duration": activePlayer && activePlayer.getDuration && ep.id === (playlistVideos[currentPlaylistIndex] || {}).id ? `PT${Math.round(activePlayer.getDuration())}S` : undefined,
                        "embedUrl": `https://www.youtube.com/embed/${ep.id}?list=${jekyllPageData.youtubePlaylistId}`
                    }
                }));
                const webSeriesLd = {
                    "@context": "https://schema.org", "@type": "WebSeries", "name": jekyllPageData.title,
                    "description": jekyllPageData.description, "url": window.location.href.split('?')[0],
                    "image": jekyllPageData.seriesPoster ? window.location.origin + jekyllPageData.seriesPoster : undefined,
                    "datePublished": jekyllPageData.datePublished,
                    "genre": jekyllPageData.genre ? jekyllPageData.genre.split(',').map(g => g.trim()) : undefined,
                    "publisher": {"@type": "Organization", "name": jekyllPageData.publisherName },
                    "productionCompany": {"@type": "Organization", "name": jekyllPageData.productionCompanyName || jekyllPageData.seriesCreatorName },
                    "actor": jekyllPageData.actors.length > 0 ? jekyllPageData.actors.map(name => ({"@type": "Person", "name": name})) : undefined,
                    "director": jekyllPageData.directors.length > 0 ? jekyllPageData.directors.map(name => ({"@type": "Person", "name": name})) : 
                                (jekyllPageData.seriesCreatorName ? [{"@type": "Person", "name": jekyllPageData.seriesCreatorName}] : undefined),
                    "creator": jekyllPageData.seriesCreatorName ? {"@type": "Person", "name": jekyllPageData.seriesCreatorName} : 
                               (jekyllPageData.directors.length > 0 ? jekyllPageData.directors.map(name => ({"@type": "Person", "name": name})) : undefined),
                    "episode": episodesLd.length > 0 ? episodesLd : undefined
                };
                const jsonLdScriptTag = document.getElementById('webseries-jsonld');
                if (jsonLdScriptTag) jsonLdScriptTag.textContent = JSON.stringify(webSeriesLd, null, 2);
            }
            
            if (youtubeApiReady && jekyllPageData.youtubePlaylistId) {
                initializePlayer(jekyllPageData.youtubePlaylistId);
            } else if (jekyllPageData.youtubePlaylistId) {
                console.log("DOM ready, YT API not yet. Waiting for API to call initializePlayer.");
            } else {
                episodeListUl.innerHTML = '<li class="p-3 has-text-grey has-text-centered">Error: YouTube Playlist ID missing.</li>';
                console.error("Error: youtube_playlist_id not found in page front matter.");
            }
        });
    </script>