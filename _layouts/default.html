<!DOCTYPE html>
<html lang="{{ site.lang | default: 'en-US' }}" class="{% if site.fixed_navbar %}has-navbar-fixed-top{% endif %}" >
{% include im-head.html %}

<body class="layout-{{ page.layout | default: 'default'}}">
    {% include im-navbar.html %}
    <div class="content"> 
        {{ content }} 
    </div>
   {% include site-before-end.html %}
   {% include head/sw.html %}
<script>
    // assets/js/theme_script.js
document.addEventListener('DOMContentLoaded', () => {
    const htmlElement = document.documentElement;
    const bodyElement = document.body;

    // Navbar Burger Toggle
    const burgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);
    if (burgers.length > 0) {
        burgers.forEach(el => {
            el.addEventListener('click', () => {
                const targetId = el.dataset.target;
                const target = document.getElementById(targetId);
                if (target) {
                    el.classList.toggle('is-active');
                    target.classList.toggle('is-active');
                    el.setAttribute('aria-expanded', el.classList.contains('is-active'));
                }
            });
        });
    }

    // --- Theme Toggle Elements & Logic ---
    const desktopThemeToggleLink = document.getElementById('im-desktop-dark-mode-toggle');
    const desktopThemeIcon = document.getElementById('im-desktop-theme-icon');
    const mobileThemeToggleLink = document.getElementById('im-mobile-dark-mode-toggle');
    const mobileThemeIcon = document.getElementById('im-mobile-theme-icon');

    // Consolidate toggles
    const allThemeToggleLinks = [desktopThemeToggleLink, mobileThemeToggleLink].filter(Boolean);
    const allThemeIcons = [desktopThemeIcon, mobileThemeIcon].filter(Boolean);


    const applyTheme = (theme) => {
        if (theme === 'dark') {
            htmlElement.classList.add('im-is-dark-mode');
            allThemeIcons.forEach(iconEl => { if(iconEl) iconEl.className = 'ph ph-sun'; });
            allThemeToggleLinks.forEach(linkEl => { if(linkEl) linkEl.setAttribute('aria-pressed', 'true'); });
        } else {
            htmlElement.classList.remove('im-is-dark-mode');
            allThemeIcons.forEach(iconEl => { if(iconEl) iconEl.className = 'ph ph-moon'; });
            allThemeToggleLinks.forEach(linkEl => { if(linkEl) linkEl.setAttribute('aria-pressed', 'false'); });
        }
        localStorage.setItem('im-theme', theme);
    };

    const savedTheme = localStorage.getItem('im-theme');
    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    let initialTheme = 'light';

    if (savedTheme) {
        initialTheme = savedTheme;
    } else if (prefersDark) {
        initialTheme = 'dark';
    }
    applyTheme(initialTheme);

    allThemeToggleLinks.forEach(toggleLink => {
        toggleLink.addEventListener('click', (event) => {
            event.preventDefault();
            const isDarkMode = htmlElement.classList.contains('im-is-dark-mode');
            const newTheme = isDarkMode ? 'light' : 'dark';
            applyTheme(newTheme);
        });
    });


    // --- Page Transition Logic ---
    if (bodyElement.classList.contains('im-page-is-loading')) {
        bodyElement.classList.remove('im-page-is-loading');
    }

    // REMOVED PAGE LOAD ANIMATION by commenting out the 'add' class logic
    // if (performance.navigation && performance.navigation.type !== performance.navigation.TYPE_BACK_FORWARD) {
    //     requestAnimationFrame(() => {
    //          bodyElement.classList.add('im-page-is-entering');
    //     });
    // } else if (!performance.navigation && performance.getEntriesByType("navigation")[0]?.type !== "back_forward") {
    //      requestAnimationFrame(() => {
    //          bodyElement.classList.add('im-page-is-entering');
    //     });
    // }

    const internalLinks = document.querySelectorAll('a[href]:not([href^="#"]):not([href^="mailto:"]):not([href^="tel:"]):not([target="_blank"]):not(.im-no-transition)');
    const transitionDurationString = getComputedStyle(document.documentElement).getPropertyValue('--im-page-transition-duration-css').trim() || '0.2s';
    const transitionDuration = parseFloat(transitionDurationString) * 1000;

    internalLinks.forEach(link => {
      link.addEventListener('click', function(event) {
        const href = this.getAttribute('href');
        if (href && (href.startsWith('/') || href.startsWith('.') || href.startsWith(window.location.origin) || !href.includes(':'))) {
          event.preventDefault();
          // bodyElement.classList.remove('im-page-is-entering'); // Not needed if entry animation is off
          bodyElement.classList.add('im-page-is-exiting');
          setTimeout(() => {
            window.location.href = href;
          }, transitionDuration);
        }
      });
    });

    window.addEventListener('pageshow', function(event) {
      if (event.persisted) {
        bodyElement.classList.remove('im-page-is-exiting', 'im-page-is-loading');
        // requestAnimationFrame(() => { // Not needed if entry animation is off
        //      bodyElement.classList.add('im-page-is-entering');
        // });
      }
    });
});
</script>
   <script src="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2"></script>
</body>
</html>