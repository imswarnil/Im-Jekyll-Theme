<!DOCTYPE html>
<html lang="{{ site.lang | default: 'en-US' }}" class="{% if site.fixed_navbar %}has-navbar-fixed-top{% endif %}" >
{% include im-head.html %}
<body class="layout-{{ page.layout | default: 'default'}} im-main-content-area">
    {% include im-navbar.html %}
    <div class="content"> 
        {{ content }} 
    </div>
   {% include site-before-end.html %}
   {% include head/sw.html %}
   <script src="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2"></script>
   <!-- Place this script at the end of your <body> or in a linked .js file -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    const htmlElement = document.documentElement;
    const toggleButton = document.getElementById('themeToggleBtn');
    const toggleIconElement = document.getElementById('themeToggleIcon');

    const THEME_STORAGE_KEY = 'userAppThemePreference'; // Use a unique key for your site
    const DARK_THEME_VALUE = 'dark';
    const LIGHT_THEME_VALUE = 'light'; // Represents the absence of data-theme or data-theme="light"

    function applyTheme(theme) {
        if (theme === DARK_THEME_VALUE) {
            htmlElement.setAttribute('data-theme', DARK_THEME_VALUE);
            if (toggleIconElement) { toggleIconElement.className = 'ph ph-sun'; } // Sun icon
            if (toggleButton) { toggleButton.setAttribute('aria-pressed', 'true'); }
        } else {
            htmlElement.removeAttribute('data-theme'); // Light mode is default (no attribute)
            // Or if your light mode CSS specifically targets data-theme="light":
            // htmlElement.setAttribute('data-theme', LIGHT_THEME_VALUE);
            if (toggleIconElement) { toggleIconElement.className = 'ph ph-moon'; } // Moon icon
            if (toggleButton) { toggleButton.setAttribute('aria-pressed', 'false'); }
        }
    }

    function toggleAndStoreTheme() {
        const isCurrentlyDark = htmlElement.getAttribute('data-theme') === DARK_THEME_VALUE;
        const newTheme = isCurrentlyDark ? LIGHT_THEME_VALUE : DARK_THEME_VALUE;
        applyTheme(newTheme);
        localStorage.setItem(THEME_STORAGE_KEY, newTheme);
    }

    if (toggleButton) {
        toggleButton.addEventListener('click', toggleAndStoreTheme);
    }

    // Initialize theme on page load
    const savedTheme = localStorage.getItem(THEME_STORAGE_KEY);
    const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)').matches;

    if (savedTheme) {
        applyTheme(savedTheme);
    } else if (prefersDarkScheme) {
        applyTheme(DARK_THEME_VALUE); // Default to OS preference if no saved theme
    } else {
        applyTheme(LIGHT_THEME_VALUE); // Default to light
    }

    // Navbar burger toggle
    const navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);
    if (navbarBurgers.length > 0) {
        navbarBurgers.forEach(el => {
            el.addEventListener('click', () => {
                const target = el.dataset.target;
                const $target = document.getElementById(target);
                el.classList.toggle('is-active');
                $target.classList.toggle('is-active');
            });
        });
    }
});
</script>
</body>
</html>