<!DOCTYPE html>
<html lang="{{ site.lang | default: 'en-US' }}" class="{% if site.fixed_navbar %}has-navbar-fixed-top{% endif %}">
{% include im-head.html %}
<body class="layout-{{ page.layout | default: 'default'}} im-main-content-area">
    {% include im-navbar.html %}
    {%- comment -%}
  Sub Navigation Bar for Jekyll
  - Shows nothing on homepage.
  - "Back to Home" on regular pages.
  - Breadcrumbs on blog posts.
  - Right-hand side placeholder for ads or other content.
{%- endcomment -%}

{%- assign current_page_url = page.url | absolute_url -%}
{%- assign site_url = site.url | append: site.baseurl | append: "/" -%}

{%- comment -%} Only show this section if NOT on the homepage {%- endcomment -%}
{%- if current_page_url != site_url -%}
<section class="section py-2 has-background-grey-lighter sub-navigation-bar">
    <div class="container">
        <div class="columns is-mobile is-vcentered">
            <!-- Left Column: Navigation (Back Button or Breadcrumbs) -->
            <div class="column">
                {%- if page.layout == 'post' and page.categories.size > 0 -%}
                    {%- comment -%} We are on a blog post with categories {%- endcomment -%}
                    <nav class="breadcrumb is-small" aria-label="breadcrumbs">
                        <ul>
                            <li>
                                <a href="{{ "/" | relative_url }}" aria-label="Back to Homepage">
                                    <span class="icon is-small"><i class="ph ph-house-line"></i></span>
                                    <span>Home</span>
                                </a>
                            </li>
                            {%- if page.categories.first -%}
                                {%- assign category_slug = page.categories.first | slugify -%}
                                {%- assign category_page_url = "/category/" | append: category_slug | append: "/" | relative_url -%}
                                {%- comment -%}
                                    Assuming your category pages are at /category/category-slug/
                                    Adjust 'category_page_url' if your category URL structure is different.
                                    You might need to find the category page object to get its actual title
                                    if you want to display a prettier category name than just the slugified version.
                                    For simplicity, we use the first category.
                                {%- endcomment -%}
                                <li>
                                    <a href="{{ category_page_url }}">
                                        <span>{{ page.categories.first | capitalize }}</span>
                                    </a>
                                </li>
                            {%- endif -%}
                            <li class="is-active">
                                <a href="{{ page.url | relative_url }}" aria-current="page">
                                    <span>{{ page.title | escape }}</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                {%- else -%}
                    {%- comment -%} Regular page (not a post, or post without categories) {%- endcomment -%}
                    <a href="{{ "/" | relative_url }}" class="button is-link is-light is-small" aria-label="Back to Homepage">
                        <span class="icon is-small">
                            <i class="ph ph-arrow-left"></i>
                        </span>
                        <span>Back to Home</span>
                    </a>
                {%- endif -%}
            </div>

            <!-- Right Column: Ad Placeholder or Other Content -->
            <div class="column is-narrow">
                <div class="sub-nav-placeholder">
                    <span class="icon is-small"><i class="ph ph-megaphone"></i></span>
                    <span>Ad Space</span>
                </div>
            </div>
        </div>
    </div>
</section>

{%- comment -%} JSON-LD for Breadcrumbs (conditionally generated) {%- endcomment -%}
{%- if page.layout == 'post' and page.categories.size > 0 -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ "/" | absolute_url }}"
    }
    {%- if page.categories.first -%}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": "{{ page.categories.first | capitalize }}",
      "item": "{{ category_page_url | absolute_url }}"
    }
    {%- endif -%}
    ,{
      "@type": "ListItem",
      "position": 3,
      "name": "{{ page.title | escape }}",
      "item": "{{ page.url | absolute_url }}"
    }
  ]
}
</script>
{%- endif -%}

{%- endif -%}
    <div class="content"> 
        {{ content }} 
    </div>
   {% include site-before-end.html %}
   {% include head/sw.html %}
   <script src="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2"></script>
   <script>
    const htmlTag = document.getElementById('htmlTag');
  const toggleBtn = document.getElementById('themeToggleBtn');
  const icon = document.getElementById('themeToggleIcon');

  // Optional: Add transition on theme switch
  function addThemeTransition() {
    htmlTag.style.transition = 'background-color 0.5s ease, color 0.5s ease';
  }

  function setTheme(theme) {
    htmlTag.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);

    if (theme === 'dark') {
      icon.className = 'ph ph-moon'; // Phosphor icon for dark mode
    } else {
      icon.className = 'ph ph-sun'; // Phosphor icon for light mode
    }

    addThemeTransition();
  }

  // Toggle handler
  toggleBtn.addEventListener('click', () => {
    const currentTheme = htmlTag.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    setTheme(newTheme);
  });

  // On page load, apply saved theme
  document.addEventListener('DOMContentLoaded', () => {
    const savedTheme = localStorage.getItem('theme') || 'dark';
    setTheme(savedTheme);
  });
   </script>
</body>
</html>