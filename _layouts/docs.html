<!DOCTYPE html>
<html lang="{{ site.lang | default: 'en-US' }}">
  {% include im-head.html %}
  <body>
    {% include im-navbar.html %}

    <!-- Documentation Layout -->
    <div class="docs-container">
      <!-- Mobile Menu Toggle -->
      <button class="docs-mobile-toggle button is-primary is-hidden-desktop" id="docsMobileToggle" aria-expanded="false" aria-controls="docsSidebar">
        <span class="icon">
          <i class="fas fa-bars"></i>
        </span>
        <span>Menu</span>
      </button>

      <!-- Left Sidebar - Documentation Menu -->
      <aside class="docs-sidebar is-hidden-mobile" id="docsSidebar">
        <div class="docs-sidebar-inner">
          <!-- Brand Logo -->
          <div class="docs-brand">
            <a href="{{ site.baseurl }}/" class="docs-brand-link">
              <img src="{{ site.logo | default: '/assets/logos/logo.svg' }}" alt="{{ site.title }} Logo" class="docs-brand-logo">
              <span>Documentation</span>
            </a>
          </div>

          <!-- Search Box -->
          <div class="docs-search">
            <div class="docs-search-inner">
              <input type="text" placeholder="Search documentation..." class="docs-search-input input is-small" id="docsSearchInput">
              <button class="docs-search-button button is-small is-primary">
                <span class="icon">
                  <i class="fas fa-search"></i>
                </span>
              </button>
            </div>
          </div>

          <!-- Documentation Menu -->
          <nav class="docs-menu" id="docsMenu">
            {% for item in site.data.documentation.docs %}
              <div class="docs-menu-section">
                <h3 class="docs-menu-label menu-label">
                  <span class="icon-text">
                    <span class="icon">
                      <i class="{{ item.icon }}"></i>
                    </span>
                    <span>{{ item.label }}</span>
                  </span>
                </h3>
                <ul class="docs-menu-list menu-list">
                  {% for subitem in item.items %}
                    {% if subitem.items %}
                      <li class="docs-menu-item has-children">
                        <a class="docs-menu-link">{{ subitem.name }}</a>
                        <ul class="docs-submenu">
                          {% for subsubitem in subitem.items %}
                            <li class="docs-menu-item">
                              <a href="{{ site.baseurl }}{{ subsubitem.link }}" 
                                 class="docs-menu-link {% if page.url == subsubitem.link %}is-active{% endif %}"
                                 data-search="{{ subsubitem.name | downcase }} {{ subitem.name | downcase }} {{ item.label | downcase }}">
                                {{ subsubitem.name }}
                              </a>
                            </li>
                          {% endfor %}
                        </ul>
                      </li>
                    {% else %}
                      <li class="docs-menu-item">
                        <a href="{{ site.baseurl }}{{ subitem.link }}" 
                           class="docs-menu-link {% if page.url == subitem.link %}is-active{% endif %}"
                           data-search="{{ subitem.name | downcase }} {{ item.label | downcase }}">
                          {{ subitem.name }}
                        </a>
                      </li>
                    {% endif %}
                  {% endfor %}
                </ul>
              </div>
            {% endfor %}
          </nav>
        </div>
      </aside>

      <!-- Main Content Area -->
      <main class="docs-main">
        <!-- Breadcrumbs -->
        <nav class="docs-breadcrumb breadcrumb" aria-label="breadcrumbs">
          <ul>
            <li><a href="{{ site.baseurl }}/">Home</a></li>
            <li><a href="{{ site.baseurl }}/docs/">Documentation</a></li>
            {% if page.category %}
              <li><a href="#">{{ page.category }}</a></li>
            {% endif %}
            <li class="is-active"><a href="#" aria-current="page">{{ page.title }}</a></li>
          </ul>
        </nav>

        <!-- Page Header -->
        <header class="docs-header">
          <h1 class="title is-2">{{ page.title }}</h1>
          {% if page.subtitle %}
            <p class="subtitle is-4 has-text-grey">{{ page.subtitle }}</p>
          {% endif %}
        </header>

        <!-- Content -->
        <div class="docs-content content">
          {{ content }}
        </div>

        <!-- Page Footer with Feedback and Navigation -->
        <footer class="docs-footer">
          <div class="docs-feedback">
            <p>Was this helpful?</p>
            <div class="docs-feedback-buttons">
              <button class="docs-feedback-button button is-small is-success">
                <span class="icon">
                  <i class="fas fa-thumbs-up"></i>
                </span>
                <span>Yes</span>
              </button>
              <button class="docs-feedback-button button is-small is-danger">
                <span class="icon">
                  <i class="fas fa-thumbs-down"></i>
                </span>
                <span>No</span>
              </button>
            </div>
          </div>

          <div class="docs-pagination">
            {% if page.previous %}
              <a href="{{ site.baseurl }}{{ page.previous.url }}" class="docs-pagination-link button is-light">
                <span class="icon">
                  <i class="fas fa-arrow-left"></i>
                </span>
                <span>
                  <span class="has-text-grey is-size-7">Previous</span>
                  <span class="is-size-6">{{ page.previous.title }}</span>
                </span>
              </a>
            {% endif %}
            {% if page.next %}
              <a href="{{ site.baseurl }}{{ page.next.url }}" class="docs-pagination-link button is-light">
                <span>
                  <span class="has-text-grey is-size-7">Next</span>
                  <span class="is-size-6">{{ page.next.title }}</span>
                </span>
                <span class="icon">
                  <i class="fas fa-arrow-right"></i>
                </span>
              </a>
            {% endif %}
          </div>
        </footer>
      </main>

      <!-- Right Sidebar - Table of Contents -->
      <aside class="docs-toc is-hidden-mobile">
        <div class="docs-toc-inner">
          <div class="menu">
            <p class="menu-label">On this page</p>
            {% include utility/toc.html html=content class="menu-list" h_min=2 h_max=3 %}
          </div>

          <div class="docs-ad box mt-5">
            <span class="tag is-light is-small is-uppercase">Advertisement</span>
            <div class="docs-ad-content mt-2">
              <img src="https://via.placeholder.com/250" alt="Advertisement">
            </div>
          </div>

          <div class="docs-author box mt-5">
            <article class="media">
              <figure class="media-left">
                <p class="image is-48x48">
                  <img class="is-rounded" src="https://via.placeholder.com/48" alt="Author avatar">
                </p>
              </figure>
              <div class="media-content">
                <div class="content">
                  <p>
                    <strong>Documentation Team</strong>
                    <br>
                    <small class="has-text-grey">Last updated: {{ page.last_modified_at | date: "%b %d, %Y" }}</small>
                  </p>
                </div>
              </div>
            </article>
          </div>

          <div class="docs-social box mt-5">
            <p class="menu-label">Share this page</p>
            <div class="field is-grouped">
              <p class="control">
                <a class="button is-small" aria-label="Twitter">
                  <span class="icon">
                    <i class="fab fa-twitter"></i>
                  </span>
                </a>
              </p>
              <p class="control">
                <a class="button is-small" aria-label="LinkedIn">
                  <span class="icon">
                    <i class="fab fa-linkedin"></i>
                  </span>
                </a>
              </p>
              <p class="control">
                <a class="button is-small" aria-label="Facebook">
                  <span class="icon">
                    <i class="fab fa-facebook"></i>
                  </span>
                </a>
              </p>
              <p class="control">
                <a class="button is-small" aria-label="Copy link">
                  <span class="icon">
                    <i class="fas fa-link"></i>
                  </span>
                </a>
              </p>
            </div>
          </div>
        </div>
      </aside>
    </div>

    {% include footer.html %}

    <!-- Custom CSS -->
    <style>
      /* Documentation Layout */
      .docs-container {
        display: flex;
        min-height: calc(100vh - var(--navbar-height, 3.25rem));
        background-color: var(--bulma-body-background-color);
      }

      /* Left Sidebar */
      .docs-sidebar {
        width: 280px;
        background-color: var(--bulma-scheme-main);
        border-right: 1px solid var(--bulma-border);
        height: calc(100vh - var(--navbar-height, 3.25rem));
        position: fixed;
        top: var(--navbar-height, 3.25rem);
        left: 0;
        overflow-y: auto;
        padding: 1.5rem 0;
        z-index: 39;
        transition: transform 0.3s ease;
      }

      @media screen and (min-width: 1024px) {
        .docs-sidebar {
          position: sticky;
        }
      }

      .docs-sidebar-inner {
        display: flex;
        flex-direction: column;
        height: 100%;
      }

      .docs-brand {
        padding: 0 1.5rem 1.5rem;
        border-bottom: 1px solid var(--bulma-border);
        margin-bottom: 1.5rem;
      }

      .docs-brand-link {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        text-decoration: none;
        color: var(--bulma-text);
        font-weight: 700;
        font-size: 1.25rem;
      }

      .docs-brand-logo {
        height: 32px;
        width: auto;
      }

      .docs-search {
        padding: 0 1.5rem 1.5rem;
        border-bottom: 1px solid var(--bulma-border);
        margin-bottom: 1.5rem;
      }

      .docs-search-inner {
        position: relative;
      }

      /* Documentation Menu */
      .docs-menu {
        flex: 1;
        overflow-y: auto;
        padding: 0 1.5rem;
      }

      /* Hidden elements for search filtering */
      .docs-menu-section.hidden,
      .docs-menu-item.hidden {
        display: none;
      }

      /* Main Content */
      .docs-main {
        flex: 1;
        max-width: 800px;
        padding: 2rem 3rem;
        margin-left: 280px;
      }

      /* Page Header */
      .docs-header {
        margin-bottom: 2rem;
        border-bottom: 1px solid var(--bulma-border);
        padding-bottom: 1.5rem;
      }

      /* Footer */
      .docs-footer {
        border-top: 1px solid var(--bulma-border);
        padding-top: 2rem;
        margin-top: 3rem;
      }

      .docs-feedback {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 2rem;
      }

      /* Pagination */
      .docs-pagination {
        display: flex;
        justify-content: space-between;
        gap: 1rem;
      }

      .docs-pagination-link {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
      }

      /* Right Sidebar - Table of Contents */
      .docs-toc {
        width: 260px;
        padding: 2rem 1.5rem;
        position: sticky;
        top: var(--navbar-height, 3.25rem);
        height: calc(100vh - var(--navbar-height, 3.25rem));
        overflow-y: auto;
      }

      /* Mobile Menu Toggle */
      .docs-mobile-toggle {
        position: fixed;
        bottom: 1rem;
        right: 1rem;
        z-index: 40;
        border-radius: 50%;
        width: 48px;
        height: 48px;
        box-shadow: var(--bulma-shadow);
      }

      /* Responsive Styles */
      @media screen and (max-width: 1023px) {
        .docs-toc {
          display: none;
        }
        
        .docs-main {
          padding-right: 2rem;
          margin-left: 0;
          width: 100%;
        }

        .docs-sidebar {
          transform: translateX(-100%);
        }

        .docs-sidebar.is-active {
          transform: translateX(0);
        }
      }

      @media screen and (max-width: 768px) {
        .docs-main {
          padding: 1.5rem;
        }
        
        .docs-pagination {
          flex-direction: column;
        }
      }
    </style>

    <!-- JavaScript -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Mobile menu toggle functionality
        const mobileToggle = document.getElementById('docsMobileToggle');
        const sidebar = document.getElementById('docsSidebar');
        
        if (mobileToggle && sidebar) {
          mobileToggle.addEventListener('click', function() {
            const isExpanded = this.getAttribute('aria-expanded') === 'true';
            this.setAttribute('aria-expanded', !isExpanded);
            sidebar.classList.toggle('is-active');
            
            // Toggle body overflow when menu is open
            document.body.style.overflow = isExpanded ? '' : 'hidden';
          });
        }

        // Close menu when clicking outside or pressing Escape
        document.addEventListener('click', function(e) {
          if (sidebar && sidebar.classList.contains('is-active')) {
            const isClickInsideSidebar = sidebar.contains(e.target);
            const isClickOnToggle = mobileToggle && mobileToggle.contains(e.target);
            
            if (!isClickInsideSidebar && !isClickOnToggle) {
              sidebar.classList.remove('is-active');
              if (mobileToggle) {
                mobileToggle.setAttribute('aria-expanded', 'false');
                document.body.style.overflow = '';
              }
            }
          }
        });

        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' && sidebar && sidebar.classList.contains('is-active')) {
            sidebar.classList.remove('is-active');
            if (mobileToggle) {
              mobileToggle.setAttribute('aria-expanded', 'false');
              document.body.style.overflow = '';
            }
          }
        });

        // Search functionality
        const searchInput = document.getElementById('docsSearchInput');
        const menuItems = document.querySelectorAll('.docs-menu-item');
        const menuSections = document.querySelectorAll('.docs-menu-section');
        
        if (searchInput) {
          searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase().trim();
            
            if (searchTerm.length > 0) {
              let hasVisibleItems = false;
              
              menuItems.forEach(item => {
                const link = item.querySelector('.docs-menu-link');
                const searchData = link.getAttribute('data-search');
                
                if (searchData.includes(searchTerm)) {
                  item.classList.remove('hidden');
                  hasVisibleItems = true;
                  
                  // Show parent sections if item is visible
                  let parent = item.closest('.docs-menu-section');
                  if (parent) parent.classList.remove('hidden');
                } else {
                  item.classList.add('hidden');
                }
              });
              
              // Hide sections with no visible items
              menuSections.forEach(section => {
                const visibleItems = section.querySelectorAll('.docs-menu-item:not(.hidden)');
                if (visibleItems.length === 0) {
                  section.classList.add('hidden');
                }
              });
            } else {
              // Show all items when search is empty
              menuItems.forEach(item => item.classList.remove('hidden'));
              menuSections.forEach(section => section.classList.remove('hidden'));
            }
          });
        }

        // Smooth scrolling for TOC links
        document.querySelectorAll('.menu-list a').forEach(anchor => {
          anchor.addEventListener('click', function(e) {
            if (this.hash) {
              e.preventDefault();
              const targetElement = document.querySelector(this.hash);
              
              if (targetElement) {
                window.scrollTo({
                  top: targetElement.offsetTop - 20,
                  behavior: 'smooth'
                });
                
                history.pushState(null, null, this.hash);
              }
            }
          });
        });

        // Highlight current section in TOC while scrolling
        const highlightCurrentSection = () => {
          const sections = document.querySelectorAll('.docs-content h2[id], .docs-content h3[id]');
          let currentSection = '';
          
          sections.forEach(section => {
            const sectionTop = section.offsetTop;
            if (window.scrollY >= sectionTop - 100) {
              currentSection = '#' + section.id;
            }
          });
          
          document.querySelectorAll('.menu-list a').forEach(link => {
            link.classList.remove('is-active');
            if (link.getAttribute('href') === currentSection) {
              link.classList.add('is-active');
            }
          });
        };

        window.addEventListener('scroll', highlightCurrentSection);
        highlightCurrentSection(); // Run once on load
      });
    </script>

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "TechArticle",
      "headline": "{{ page.title }}",
      "description": "{{ page.description | default: page.excerpt | strip_html | strip_newlines | truncate: 160 }}",
      "author": {
        "@type": "Organization",
        "name": "{{ site.title }}"
      },
      "datePublished": "{{ page.date | date_to_xmlschema }}",
      "dateModified": "{{ page.last_modified_at | default: page.date | date_to_xmlschema }}",
      "publisher": {
        "@type": "Organization",
        "name": "{{ site.title }}",
        "logo": {
          "@type": "ImageObject",
          "url": "{{ site.logo | absolute_url }}"
        }
      },
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "{{ page.url | absolute_url }}"
      }
    }
    </script>

    {% include site-before-end.html %}
  </body>
</html>