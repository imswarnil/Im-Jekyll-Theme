<!DOCTYPE html>
<html lang="{{ site.lang | default: 'en-US' }}">
  {% include im-head.html %}
  
  <body class="has-navbar-fixed-top">
    {% include im-navbar.html %}
    <style>
      /* Docs layout */
.docs-container {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

.docs-wrapper {
  display: flex;
  flex: 1;
  margin-top: 3.25rem; /* Navbar height */
}

.docs-sidebar {
  width: 280px;
  background-color: #f5f5f5;
  border-right: 1px solid #dbdbdb;
  padding: 1.5rem;
  overflow-y: auto;
  position: sticky;
  top: 3.25rem;
  height: calc(100vh - 3.25rem);
}

.docs-content {
  flex: 1;
  padding: 2rem;
  max-width: 800px;
  margin: 0 auto;
  width: 100%;
}

.docs-toc {
  width: 240px;
  padding: 2rem 1rem;
  overflow-y: auto;
  position: sticky;
  top: 3.25rem;
  height: calc(100vh - 3.25rem);
}

/* Header */
.docs-header {
  background-color: #f5f5f5;
  border-left: 4px solid #485fc7;
}

/* Menu */
.docs-menu-section {
  margin-bottom: 1.5rem;
}

.docs-menu-dropdown summary {
  cursor: pointer;
  list-style: none;
}

.docs-menu-dropdown summary::-webkit-details-marker {
  display: none;
}

.docs-menu-dropdown summary::before {
  content: "▸";
  margin-right: 0.5rem;
  font-size: 0.8em;
  color: #7a7a7a;
}

.docs-menu-dropdown[open] summary::before {
  content: "▾";
}

/* Mobile menu toggle */
.docs-mobile-menu-toggle {
  position: fixed;
  bottom: 1rem;
  right: 1rem;
  z-index: 40;
  box-shadow: 0 2px 3px rgba(10, 10, 10, 0.1);
}

/* Responsive */
@media screen and (max-width: 1023px) {
  .docs-sidebar {
    position: fixed;
    left: -280px;
    top: 3.25rem;
    z-index: 30;
    transition: left 0.3s ease;
  }
  
  .docs-sidebar.is-hidden-mobile {
    left: 0;
  }
  
  .docs-content {
    padding: 1.5rem;
  }
}

@media screen and (max-width: 768px) {
  .docs-content {
    padding: 1rem;
  }
}
    </style>

    <div class="docs-container">
      <!-- Mobile menu toggle -->
      <button class="docs-mobile-menu-toggle button is-primary is-hidden-desktop">
        <span class="icon">
          <i class="fas fa-bars"></i>
        </span>
        <span>Menu</span>
      </button>

      <div class="docs-wrapper">
        <!-- Sidebar -->
        <aside class="docs-sidebar is-hidden-mobile">
          <div class="docs-sidebar-inner">
            <div class="docs-search mb-4">
              <div class="field has-addons">
                <div class="control is-expanded">
                  <input class="input" type="text" placeholder="Search docs..." id="docs-search-input">
                </div>
                <div class="control">
                  <button class="button is-primary">
                    <span class="icon">
                      <i class="fas fa-search"></i>
                    </span>
                  </button>
                </div>
              </div>
            </div>

            <nav class="docs-menu">
              {% for item in site.data.documentation.docs %}
                <div class="docs-menu-section">
                  <p class="menu-label is-flex is-align-items-center">
                    <span class="icon mr-2">
                      <i class="{{ item.icon }}"></i>
                    </span>
                    {{ item.label }}
                  </p>
                  
                  <ul class="menu-list">
                    {% for subitem in item.items %}
                      {% if subitem.items %}
                        <li>
                          <details class="docs-menu-dropdown" {% if page.url contains subitem.link %}open{% endif %}>
                            <summary class="has-text-weight-bold">{{ subitem.name }}</summary>
                            <ul>
                              {% for subsubitem in subitem.items %}
                                <li>
                                  <a href="{{ subsubitem.link | relative_url }}" 
                                     class="{% if page.url == subsubitem.link %}is-active{% endif %}">
                                    {{ subsubitem.name }}
                                  </a>
                                </li>
                              {% endfor %}
                            </ul>
                          </details>
                        </li>
                      {% else %}
                        <li>
                          <a href="{{ subitem.link | relative_url }}" 
                             class="{% if page.url == subitem.link %}is-active{% endif %}">
                            {{ subitem.name }}
                          </a>
                        </li>
                      {% endif %}
                    {% endfor %}
                  </ul>
                </div>
              {% endfor %}
            </nav>
          </div>
        </aside>

        <!-- Main content -->
        <main class="docs-content">
          <header class="docs-header box is-primary mb-6">
            <div class="docs-header-content">
              <h1 class="title is-2">{{ page.title }}</h1>
              {% if page.subtitle %}
                <p class="subtitle is-4">{{ page.subtitle }}</p>
              {% endif %}
            </div>
          </header>

          <div class="docs-main-content content">
            {{ content }}
          </div>

          <div class="docs-pagination mt-6">
            {% if page.previous.url %}
              <a href="{{ page.previous.url | relative_url }}" class="button is-primary is-outlined">
                <span class="icon">
                  <i class="fas fa-arrow-left"></i>
                </span>
                <span>{{ page.previous.title }}</span>
              </a>
            {% endif %}
            
            {% if page.next.url %}
              <a href="{{ page.next.url | relative_url }}" class="button is-primary is-outlined is-pulled-right">
                <span>{{ page.next.title }}</span>
                <span class="icon">
                  <i class="fas fa-arrow-right"></i>
                </span>
              </a>
            {% endif %}
          </div>
        </main>

        <!-- Table of Contents -->
        <aside class="docs-toc is-hidden-mobile">
          <div class="docs-toc-inner">
            <p class="menu-label">On this page</p>
            {% include utility/toc.html html=content class="menu-list" h_min=2 h_max=3 %}
            
            <div class="docs-toc-footer mt-4">
              <p class="has-text-weight-semibold">Last updated</p>
              <p class="is-size-7">{{ page.last_modified_at | date: "%b %d, %Y" }}</p>
            </div>
          </div>
        </aside>
      </div>
    </div>

    <script>
      // Mobile menu toggle
      document.addEventListener('DOMContentLoaded', () => {
        const mobileMenuToggle = document.querySelector('.docs-mobile-menu-toggle');
        const sidebar = document.querySelector('.docs-sidebar');
        
        if (mobileMenuToggle && sidebar) {
          mobileMenuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('is-hidden-mobile');
          });
        }

        // Search functionality
        const searchInput = document.getElementById('docs-search-input');
        if (searchInput) {
          searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const menuItems = document.querySelectorAll('.docs-menu li a');
            
            menuItems.forEach(item => {
              const text = item.textContent.toLowerCase();
              const li = item.closest('li');
              
              if (text.includes(searchTerm)) {
                li.style.display = 'block';
                
                // Show parent sections
                let parent = li.closest('.docs-menu-section');
                while (parent) {
                  parent.style.display = 'block';
                  parent = parent.parentElement.closest('.docs-menu-section');
                }
              } else {
                li.style.display = 'none';
              }
            });
          });
        }

        // Highlight current section in TOC while scrolling
        window.addEventListener('scroll', () => {
          const headings = document.querySelectorAll('h2, h3');
          let currentId = '';
          
          headings.forEach(heading => {
            const rect = heading.getBoundingClientRect();
            if (rect.top <= 100) {
              currentId = heading.id;
            }
          });
          
          document.querySelectorAll('.docs-toc a').forEach(link => {
            link.classList.remove('is-active');
            if (link.getAttribute('href') === `#${currentId}`) {
              link.classList.add('is-active');
            }
          });
        });
      });
    </script>
  </body>
</html>