<nav class="navbar is-fixed-top pro-navbar" role="navigation" aria-label="main navigation" id="professionalNavbar">
    <div class="container">
        <div class="navbar-brand">
            <a href="{{ site.url | default: '.' }}/" class="navbar-item pro-navbar-logo">
                {% if site.logo_image_path %}
                <img src="{{ site.logo_image_path | relative_url }}" alt="{{ site.title | escape | default: 'Site' }} Logo">
                {% else %}
                <span class="icon is-medium"><i class="ph-bold ph-code"></i></span>
                <span class="has-text-weight-bold ml-2">{{ site.title | default: "My Site Title" }}</span>
                {% endif %}
            </a>

            <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="professionalNavbarMenu">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>

        <div class="navbar-menu" id="professionalNavbarMenu">
            <div class="navbar-start">
                {% for item in site.navbar %}
                  {% if item.name %}
                    {% assign item_url_relative = item.link | relative_url | default: "#" %}

                    {% capture processed_page_url %}{{ page.url | remove: "index.html" }}{% endcapture %}
                    {% if processed_page_url == "/" %}{% assign page_url_cleaned = "/" %}
                    {% else %}{% assign page_url_cleaned = processed_page_url | remove_first: "/" %}{% if page_url_cleaned endswith "/" %}{% assign page_url_cleaned = page_url_cleaned | remove_last: "/" %}{% endif %}{% endif %}

                    {% capture processed_item_url %}{{ item_url_relative | remove: "index.html" }}{% endcapture %}
                    {% if processed_item_url == "/" %}{% assign current_item_url_cleaned = "/" %}
                    {% else %}{% assign current_item_url_cleaned = processed_item_url | remove_first: "/" %}{% if current_item_url_cleaned endswith "/" %}{% assign current_item_url_cleaned = current_item_url_cleaned | remove_last: "/" %}{% endif %}{% endif %}

                    {% assign is_active_page = false %}
                    {% if page_url_cleaned == current_item_url_cleaned and current_item_url_cleaned != "#" %}
                        {% assign is_active_page = true %}
                    {% endif %}

                    {% assign is_active_parent = false %}
                    {% if item.dropdown %}
                      {% if item.link != "#" and current_item_url_cleaned != "" and current_item_url_cleaned != "/" and page_url_cleaned contains current_item_url_cleaned %}
                        {% assign is_active_parent = true %}
                      {% endif %}
                      {% for subitem in item.dropdown %}
                        {% assign subitem_url_relative = subitem.link | relative_url %}
                        {% capture processed_subitem_url %}{{ subitem_url_relative | remove: "index.html" }}{% endcapture %}
                        {% if processed_subitem_url == "/" %}{% assign subitem_url_cleaned = "/" %}
                        {% else %}{% assign subitem_url_cleaned = processed_subitem_url | remove_first: "/" %}{% if subitem_url_cleaned endswith "/" %}{% assign subitem_url_cleaned = subitem_url_cleaned | remove_last: "/" %}{% endif %}{% endif %}
                        {% if page_url_cleaned == subitem_url_cleaned %}{% assign is_active_parent = true %}{% assign is_active_page = false %}{% break %}{% endif %}
                      {% endfor %}
                    {% endif %}

                    {% if item.dropdown %}
                    <div class="navbar-item has-dropdown {% if is_active_parent %}is-active-dropdown-parent{% else %}is-hoverable{% endif %}">
                      <a class="navbar-link {% if is_active_parent %}is-active{% endif %}" {% if item.link != "#" %}href="{{ item_url_relative }}"{% else %}role="button" aria-haspopup="true" aria-expanded="false"{% endif %}>
                        {% if item.icon %}<span class="icon mr-1"><i class="ph ph-{{ item.icon }}"></i></span>{% endif %}
                        <span>{{ item.name }}</span>
                      </a>
                      <div class="navbar-dropdown is-boxed">
                        {% for subitem in item.dropdown %}
                          {% assign subitem_url_relative = subitem.link | relative_url %}
                          {% capture processed_subitem_url_dd %}{{ subitem_url_relative | remove: "index.html" }}{% endcapture %}
                          {% if processed_subitem_url_dd == "/" %}{% assign subitem_url_cleaned_dd = "/" %}
                          {% else %}{% assign subitem_url_cleaned_dd = processed_subitem_url_dd | remove_first: "/" %}{% if subitem_url_cleaned_dd endswith "/" %}{% assign subitem_url_cleaned_dd = subitem_url_cleaned_dd | remove_last: "/" %}{% endif %}{% endif %}
                          <a class="navbar-item {% if page_url_cleaned == subitem_url_cleaned_dd %}is-active{% endif %}" href="{{ subitem_url_relative }}">
                            {% if subitem.image %}
                                <figure class="image is-24x24 mr-2">
                                    <img class="is-rounded" src="{{ subitem.image | relative_url }}" alt="{{ subitem.name | escape }}">
                                </figure>
                            {% elsif subitem.icon %}
                                <span class="icon mr-1 is-small"><i class="ph ph-{{ subitem.icon }}"></i></span>
                            {% endif %}
                            <span>{{ subitem.name }}</span>
                          </a>
                        {% endfor %}
                      </div>
                    </div>
                    {% else %}
                    <a class="navbar-item {% if is_active_page %}is-active{% endif %}" href="{{ item_url_relative }}">
                      {% if item.icon %}<span class="icon mr-1"><i class="ph ph-{{ item.icon }}"></i></span>{% endif %}
                      <span>{{ item.name }}</span>
                    </a>
                    {% endif %}
                  {% endif %}
                {% endfor %}
            </div>

            <div class="navbar-end">
                <a href="{{ '/search' | relative_url | default: '#' }}" class="navbar-item" aria-label="Search">
                    <span class="icon"><i class="ph ph-magnifying-glass"></i></span>
                </a>
                {% if site.github_username %}
                <a href="https://github.com/{{ site.github_username }}" class="navbar-item" aria-label="GitHub" target="_blank" rel="noopener">
                    <span class="icon"><i class="ph ph-github-logo"></i></span>
                </a>
                {% endif %}
                <div class="navbar-item">
                    <a href="{{ site.action_button_link | default: '#' }}" class="button is-primary">
                        {{ site.action_button_text | default: "Get Started" }}
                    </a>
                </div>
            </div>
        </div>
    </div>
</nav>

<style>
    body {
        padding-top: var(--bulma-navbar-height, 3.25rem); 
        font-family: var(--bulma-family-sans-serif);
    }

    nav.pro-navbar {
        background-color: var(--bulma-white);
        box-shadow: 0 2px 3px hsla(0, 0%, 4%, 0.1); /* Subtle shadow */
        font-family: var(--bulma-family-sans-serif);
    }

    nav.pro-navbar .navbar-brand .navbar-item.pro-navbar-logo {
        font-weight: var(--bulma-weight-semibold);
        color: var(--bulma-text-strong);
    }
    nav.pro-navbar .navbar-brand .navbar-item.pro-navbar-logo img {
        max-height: calc(var(--bulma-navbar-height, 3.25rem) - 1rem);
    }
     nav.pro-navbar .navbar-brand .navbar-item.pro-navbar-logo .icon { /* For ph-code icon */
        color: var(--bulma-primary);
    }


    nav.pro-navbar .navbar-burger span {
        background-color: var(--bulma-text);
        height: 2px; /* Slightly thicker burger lines */
    }

    /* Center navbar-start items on desktop */
    @media screen and (min-width: 1024px) {
        nav.pro-navbar .navbar-menu {
            flex-grow: 1; /* Allow navbar-menu to take available space */
        }
        nav.pro-navbar .navbar-start {
            margin-left: auto;   /* Push items to center */
            margin-right: auto;  /* Push items to center */
            justify-content: center; /* Center items within navbar-start itself */
        }
         nav.pro-navbar .navbar-end {
            margin-left: 0; /* Standard end alignment */
        }
    }
    
    nav.pro-navbar .navbar-item,
    nav.pro-navbar .navbar-link {
        color: var(--bulma-text);
        font-weight: var(--bulma-weight-medium);
        padding-left: 1rem;
        padding-right: 1rem;
        transition: color 0.2s ease-in-out, background-color 0.2s ease-in-out, border-bottom-color 0.2s ease-in-out;
        border-bottom: 2px solid transparent; /* For active state underline */
    }
    nav.pro-navbar .navbar-item .icon { /* General icon styling within items */
        color: var(--bulma-grey-dark);
        transition: color 0.2s ease-in-out;
    }

    nav.pro-navbar .navbar-item:hover,
    nav.pro-navbar .navbar-link:hover,
    nav.pro-navbar .navbar-item.is-hoverable:hover > .navbar-link { 
        background-color: var(--bulma-background); /* Default Bulma hover background */
        color: var(--bulma-link-hover);
        border-bottom-color: transparent; /* Remove border on non-active hover */
    }
    nav.pro-navbar .navbar-item:hover .icon,
    nav.pro-navbar .navbar-link:hover .icon {
        color: var(--bulma-link-hover);
    }
    
    /* Active state for direct links and dropdown parent links */
    nav.pro-navbar .navbar-item.is-active,
    nav.pro-navbar .navbar-link.is-active,
    nav.pro-navbar .navbar-item.is-active-dropdown-parent > .navbar-link {
        background-color: transparent !important; /* No background for active links themselves */
        color: var(--bulma-primary) !important;
        font-weight: var(--bulma-weight-semibold);
        border-bottom: 2px solid var(--bulma-primary);
    }
    nav.pro-navbar .navbar-item.is-active .icon,
    nav.pro-navbar .navbar-link.is-active .icon,
    nav.pro-navbar .navbar-item.is-active-dropdown-parent > .navbar-link .icon {
        color: var(--bulma-primary) !important;
    }


    nav.pro-navbar .navbar-link::after { /* Bulma's dropdown arrow */
        border-color: var(--bulma-grey-dark);
    }
    nav.pro-navbar .navbar-link:hover::after,
    nav.pro-navbar .navbar-link.is-active::after,
    nav.pro-navbar .navbar-item.is-active-dropdown-parent > .navbar-link::after {
        border-color: var(--bulma-primary);
    }


    nav.pro-navbar .navbar-dropdown {
        border-top-color: var(--bulma-primary); /* Match active underline */
        box-shadow: var(--bulma-dropdown-shadow, 0 8px 8px rgba(10, 10, 10, 0.1));
        border-radius: 0 0 var(--bulma-radius) var(--bulma-radius);
    }
    nav.pro-navbar .navbar-dropdown .navbar-item {
        border-bottom: none; /* No underline for dropdown items */
        padding-left: 1rem;
        padding-right: 1rem;
    }
    nav.pro-navbar .navbar-dropdown .navbar-item:hover {
        background-color: var(--bulma-background);
        color: var(--bulma-link-hover);
    }
    nav.pro-navbar .navbar-dropdown .navbar-item.is-active {
        background-color: var(--bulma-primary-light) !important;
        color: var(--bulma-primary) !important;
        font-weight: var(--bulma-weight-semibold);
    }
    nav.pro-navbar .navbar-dropdown .navbar-item.is-active .icon {
        color: var(--bulma-primary) !important;
    }
     nav.pro-navbar .navbar-dropdown .navbar-item figure.image.is-24x24 {
        height: 24px;
        width: 24px;
    }

    /* Navbar End styling */
    nav.pro-navbar .navbar-end .navbar-item .icon {
        color: var(--bulma-grey-darker);
    }
    nav.pro-navbar .navbar-end .navbar-item:hover .icon {
        color: var(--bulma-link);
    }

    @media screen and (max-width: 1023px) {
        nav.pro-navbar .navbar-start {
            margin-left: 0;
            margin-right: 0;
            justify-content: flex-start; /* Standard mobile stacking */
        }
        nav.pro-navbar .navbar-item.is-active,
        nav.pro-navbar .navbar-link.is-active,
        nav.pro-navbar .navbar-item.is-active-dropdown-parent > .navbar-link {
            border-bottom-color: transparent; /* No underline for active items on mobile */
            /* Bulma's default mobile active style (background) will take over if .is-active is directly on the item */
        }
         nav.pro-navbar .navbar-item.has-dropdown.is-active-dropdown-parent > .navbar-link {
             /* Ensure the parent link of an active dropdown gets some distinction on mobile */
            background-color: var(--bulma-white-ter);
        }
        nav.pro-navbar .navbar-item.has-dropdown.is-hoverable:not(.is-active-dropdown-parent) .navbar-dropdown {
             display: none; /* Ensure dropdowns are hidden unless toggled by JS via is-active-dropdown-parent */
        }
        nav.pro-navbar .navbar-item.has-dropdown.is-active-dropdown-parent .navbar-dropdown {
            display: block;
        }
    }
</style>

<!-- Include Phosphor Icons Script (place in <head> or before body end) -->
<script src="https://unpkg.com/@phosphor-icons/web"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const mainNavbar = document.getElementById('professionalNavbar');
    if (!mainNavbar) return;

    const navbarBurgers = mainNavbar.querySelectorAll('.navbar-burger');
    navbarBurgers.forEach(burger => {
        burger.addEventListener('click', () => {
            const targetId = burger.dataset.target;
            const targetMenu = document.getElementById(targetId);
            if (targetMenu) {
                burger.classList.toggle('is-active');
                targetMenu.classList.toggle('is-active');
            }
        });
    });

    const navbarDropdowns = mainNavbar.querySelectorAll('.navbar-item.has-dropdown');
    navbarDropdowns.forEach(dropdown => {
        const link = dropdown.querySelector('.navbar-link');
        if (link) {
            link.addEventListener('click', function(event) {
                if (window.innerWidth < 1024) { 
                    event.preventDefault();
                    // Use a distinct class for JS-toggled active state on mobile for dropdowns
                    // to avoid conflict with server-rendered 'is-active' for current page highlighting.
                    dropdown.classList.toggle('is-active-dropdown-parent'); 
                    const isExpanded = link.getAttribute('aria-expanded') === 'true';
                    link.setAttribute('aria-expanded', !isExpanded);
                }
            });
        }
        
        // Bulma handles hover for 'is-hoverable' on desktop.
        // Liquid logic should set 'is-active' for the currently active section's parent dropdown.
        // This ensures 'is-hoverable' is only for non-active dropdowns on desktop.
        if ('ontouchstart' in document.documentElement) {
            dropdown.classList.remove('is-hoverable');
        } else {
            // if the dropdown parent isn't already marked as active (e.g. section is active)
            // then is-hoverable (from Liquid) will apply.
        }
    });
});
</script>