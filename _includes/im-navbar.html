<nav class="navbar is-fixed-top has-shadow" role="navigation" aria-label="main navigation">
  <div class="container">
    <div class="navbar-brand">
      <a href="{{ site.baseurl }}/" class="navbar-item">
        {% if site.logo %}
        <img class="image" src="{{ site.logo | relative_url }}" alt="{{ site.title | escape }} Logo">
        {% endif %}
        <span class="has-text-weight-bold ml-2">{{ site.title }}</span>
      </a>

      <!-- Hamburger -->
      <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="mainNavbarMenu">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

    <div class="navbar-menu" id="mainNavbarMenu">
      <div class="navbar-end">
        {% for item in site.navbar %}
          {% if item.name %}
            {% assign item_url_relative = item.link | relative_url %}
            {% assign current_page_url = page.url | remove: "index.html" | default: "/" %}
            {% assign current_item_url = item_url_relative | remove: "index.html" | default: "/" %}
            {% assign is_active_page = false %}
            {% if current_page_url == current_item_url and current_item_url != "/#" %}
              {% assign is_active_page = true %}
            {% endif %}

            {% assign is_active_parent = false %}
            {% if item.dropdown %}
              {% if item.link != "/#" and current_item_url != "/" and current_page_url contains current_item_url %}
                {% assign is_active_parent = true %}
              {% endif %}
              {% for subitem in item.dropdown %}
                {% assign subitem_url_relative_cleaned = subitem.link | relative_url | remove: "index.html" | default: "/" %}
                {% if current_page_url == subitem_url_relative_cleaned %}
                  {% assign is_active_parent = true %}
                  {% break %}
                {% endif %}
              {% endfor %}
            {% endif %}

            {% if item.dropdown %}
              <div class="navbar-item has-dropdown is-hoverable">
                <a class="navbar-link {% if is_active_parent %}is-active{% endif %}" {% if item.link != "/#" %}href="{{ item_url_relative }}"{% else %}role="button"{% endif %}>
                  {% if item.icon %}
                    <span class="icon"><i class="ph-{% if site.icon_style != 'regular' %}{{ site.icon_style }}{% else %}ph{% endif %} ph-{{ item.icon }}"></i></span>
                  {% endif %}
                  {{ item.name }}
                </a>
                <div class="navbar-dropdown is-boxed">
                  {% for subitem in item.dropdown %}
                    {% assign subitem_url_relative = subitem.link | relative_url %}
                    {% assign subitem_url_relative_cleaned = subitem_url_relative | remove: "index.html" | default: "/" %}
                    <a class="navbar-item {% if current_page_url == subitem_url_relative_cleaned %}is-active{% endif %}" href="{{ subitem_url_relative }}">
                      {% if subitem.icon %}
                        <span class="icon is-small"><i class="ph-{% if site.icon_style != 'regular' %}{{ site.icon_style }}{% else %}ph{% endif %} ph-{{ subitem.icon }}"></i></span>
                      {% endif %}
                      {{ subitem.name }}
                    </a>
                  {% endfor %}
                </div>
              </div>
            {% else %}
              <a class="navbar-item {% if is_active_page %}is-active{% endif %}" href="{{ item_url_relative }}">
                {% if item.icon %}
                  <span class="icon"><i class="ph-{% if site.icon_style != 'regular' %}{{ site.icon_style }}{% else %}ph{% endif %} ph-{{ item.icon }}"></i></span>
                {% endif %}
                {{ item.name }}
              </a>
            {% endif %}
          {% endif %}
        {% endfor %}

        <!-- Optional search icon -->
        <a href="{{ '/search' | relative_url }}" class="navbar-item" aria-label="Search">
          <span class="icon is-small"><i class="ph-{% if site.icon_style != 'regular' %}{{ site.icon_style }}{% else %}ph{% endif %} ph-magnifying-glass"></i></span>
        </a>
      </div>
    </div>
  </div>
</nav>
