{% comment %}
  Optimized AdSense Component with Lazy Loading
  Usage: {% include adsense.html format="responsive" slot="auto" %}

  Parameters:
  - format: ad format type (responsive, leaderboard, skyscraper, etc.)
  - slot: specific slot ID or 'auto' to choose best for format
  - layout: for responsive ads (in-article, in-feed, matched-content)
  - lazy: enable lazy loading (true/false)
{% endcomment %}

{% assign format = include.format | default: 'responsive' %}
{% assign slot = include.slot | default: 'auto' %}
{% assign layout = include.layout | default: '' %}
{% assign lazy = include.lazy | default: true %}

{% case format %}
  {% when 'square' %}
    {% assign ad_slot = slot == 'auto' ? '7663977887' : slot %}
  {% when 'horizontal' %}
    {% assign ad_slot = slot == 'auto' ? '8939839370' : slot %}
  {% when 'vertical' %}
    {% assign ad_slot = slot == 'auto' ? '3487917390' : slot %}
  {% when 'leaderboard' %}
    {% assign ad_slot = slot == 'auto' ? '1864856299' : slot %}
  {% when 'leaderboard-large' %}
    {% assign ad_slot = slot == 'auto' ? '8539588233' : slot %}
  {% when 'billboard' %}
    {% assign ad_slot = slot == 'auto' ? '4921873558' : slot %}
  {% when 'article' %}
    {% assign ad_slot = slot == 'auto' ? '6501428979' : slot %}
  {% when 'skyscraper' %}
    {% assign ad_slot = slot == 'auto' ? '5882506557' : slot %}
  {% when 'skyscraper-medium' %}
    {% assign ad_slot = slot == 'auto' ? '4394096538' : slot %}
  {% when 'skyscraper-large' %}
    {% assign ad_slot = slot == 'auto' ? '9488965956' : slot %}
  {% when 'mobile-leaderboard' %}
    {% assign ad_slot = slot == 'auto' ? '4003326983' : slot %}
  {% when 'button' %}
    {% assign ad_slot = slot == 'auto' ? '3836856744' : slot %}
  {% when 'multiplex-h' %}
    {% assign ad_slot = slot == 'auto' ? '9130894804' : slot %}
  {% when 'multiplex-v' %}
    {% assign ad_slot = slot == 'auto' ? '6808134701' : slot %}
  {% else %}
    {% assign ad_slot = slot == 'auto' ? '4774277934' : slot %}
{% endcase %}

<div class="adsense-ad {{ format }}" 
     data-format="{{ format }}" 
     data-slot="{{ ad_slot }}"
     {% if lazy %}data-lazy="true"{% endif %}>
  <div class="ad-placeholder">
    <span class="ad-label">Advertisement</span>
    <div class="ad-content">
      {{ format | capitalize }} Ad
      <small>Loading...</small>
    </div>
  </div>
</div>

<!-- Styles are unchanged â€“ keeping them as-is -->

<script>
document.addEventListener('DOMContentLoaded', function () {
  const adClient = 'ca-pub-1291242080282540';

  // Load AdSense script if not already loaded
  if (!window.adsbygoogle) {
    const script = document.createElement('script');
    script.src = 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=' + adClient;
    script.async = true;
    script.crossOrigin = 'anonymous';
    document.head.appendChild(script);
  }

  const formatStyles = {
    'square': 'width:250px;height:250px',
    'horizontal': 'width:100%;height:90px',
    'vertical': 'width:120px;height:600px',
    'leaderboard': 'width:728px;height:90px',
    'leaderboard-large': 'width:980px;height:90px',
    'billboard': 'width:970px;height:250px',
    'skyscraper': 'width:160px;height:600px',
    'skyscraper-medium': 'width:300px;height:600px',
    'skyscraper-large': 'width:300px;height:1050px',
    'mobile-leaderboard': 'width:300px;height:50px',
    'button': 'width:300px;height:60px'
  };

  function createAdElement(format, slot) {
    const ins = document.createElement('ins');
    ins.className = 'adsbygoogle';
    ins.style.display = 'block';
    ins.dataset.adClient = adClient;
    ins.dataset.adSlot = slot;

    if (format === 'article') {
      ins.dataset.adFormat = 'fluid';
      ins.dataset.adLayout = 'in-article';
    } else if (format === 'multiplex-h' || format === 'multiplex-v') {
      ins.dataset.adFormat = 'autorelaxed';
    } else if (format === 'responsive') {
      ins.dataset.adFormat = 'auto';
      ins.dataset.fullWidthResponsive = 'true';
    } else if (formatStyles[format]) {
      ins.style = formatStyles[format];
    }

    return ins;
  }

  function renderAd(adContainer) {
    const format = adContainer.dataset.format;
    const slot = adContainer.dataset.slot;
    const ad = createAdElement(format, slot);

    adContainer.innerHTML = '';
    adContainer.appendChild(ad);
    adContainer.classList.add('loaded');
    (adsbygoogle = window.adsbygoogle || []).push({});
  }

  const observer = new IntersectionObserver((entries, obs) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        renderAd(entry.target);
        obs.unobserve(entry.target);
      }
    });
  }, { rootMargin: '200px', threshold: 0.1 });

  // Lazy Ads
  document.querySelectorAll('.adsense-ad[data-lazy="true"]').forEach(ad => observer.observe(ad));

  // Non-Lazy Ads (above the fold)
  document.querySelectorAll('.adsense-ad:not([data-lazy="true"])').forEach(ad => renderAd(ad));
});
</script>
