// =============================================================================
// INDEX.SCSS - "IM" THEME FOR BULMA (Comprehensive Light & Dark Mode Foundations)
// =============================================================================
// TABLE OF CONTENTS:
// 1.  THEME VARIABLES (SCSS)
// 2.  CSS CUSTOM PROPERTIES (:root - Light Mode Defaults)
// 3.  CSS CUSTOM PROPERTIES (html.im-is-dark-mode - Dark Mode Overrides)
// 4.  HELPER MIXINS
// 5.  BASE & ELEMENT STYLES
// 6.  BULMA LAYOUT COMPONENT OVERRIDES
// 7.  BULMA ELEMENT OVERRIDES
// 8.  BULMA COMPONENT COLLECTION OVERRIDES
// 9.  BULMA FORM COMPONENT OVERRIDES
// 10. UTILITY CLASSES (Grid System)
// 11. PAGE TRANSITION ANIMATIONS
// 12. DARK MODE SPECIFIC COMPONENT ADJUSTMENTS (If needed beyond CSS Vars)
// =============================================================================

// =============================================================================
// 1. THEME VARIABLES (SCSS)
// =============================================================================
$im-font-primary: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
$im-font-weight-normal: 400;
$im-font-weight-medium: 500;
$im-font-weight-semibold: 600;
$im-font-weight-bold: 700;

$im-base-font-size: 16px;
$im-line-height-base: 1.6;

$im-border-radius: 6px;
$im-spacing-unit: 1rem;

$im-section-padding-vertical: calc(#{$im-spacing-unit} * 2.5);
$im-content-padding: calc(#{$im-spacing-unit} * 1.25);

$im-page-transition-duration: 0.2s;
$im-page-transition-delay: 0.05s;
$im-page-transition-translateY: 10px;

$im-navbar-height: 3.5rem;
$im-navbar-item-padding-vertical: 0.75rem;
$im-navbar-item-padding-horizontal: 1rem;
$im-navbar-scroll-transition-duration: 0.3s;

$im-grid-line-width: 1px !default;
$im-grid-default-spacing: 30px !default;
$im-grid-default-fade-extent: 70% !default;
$im-grid-default-color-var: '--im-color-grid-lines-default';


// =============================================================================
// 2. CSS CUSTOM PROPERTIES (:root - Light Mode Defaults)
// =============================================================================
:root {
  // --- Colors ---
  --im-color-primary-rgb: 229, 57, 53;
  --im-color-primary: rgb(var(--im-color-primary-rgb));
  --im-color-primary-light: #ef5350;
  --im-color-primary-dark: #c62828;
  --im-color-primary-inverse: #FFFFFF;

  --im-color-text: #2D3748;
  --im-color-text-headings: #1A202C;
  --im-color-text-muted: #718096;
  --im-color-text-on-primary: #FFFFFF;
  --im-color-text-on-surface: var(--im-color-text);

  --im-color-background: #F9FAFB;
  --im-color-surface: #FFFFFF;
  --im-navbar-bg-transparent: rgba(255, 255, 255, 0.65);
  --im-navbar-bg-scrolled: rgba(255, 255, 255, 0.9);
  --im-navbar-border-transparent: rgba(226, 232, 240, 0.0); // Using RGB of --im-color-border
  --im-navbar-border-scrolled: rgba(226, 232, 240, 0.5);
  --im-color-surface-alt: #F0F2F5;

  --im-color-border-rgb: 226, 232, 240; // #E2E8F0
  --im-color-border: rgb(var(--im-color-border-rgb));
  --im-color-border-light: #EFF2F7;
  --im-color-border-hover: #D1D9E6; // For input hover

  --im-color-link: var(--im-color-primary);
  --im-color-link-hover: var(--im-color-primary-dark);

  --im-button-primary-bg: var(--im-color-primary);
  --im-button-primary-border: var(--im-color-primary);
  --im-button-primary-text: var(--im-color-primary-inverse);
  --im-button-primary-hover-bg: var(--im-color-primary-dark);
  --im-button-primary-hover-border: var(--im-color-primary-dark);
  --im-button-light-bg: #FEEBEE;
  --im-button-light-border: #FEEBEE;
  --im-button-light-text: var(--im-color-primary-dark);
  --im-button-light-hover-bg: #FFCDD2;
  --im-button-light-hover-border: #FFCDD2;

  --im-input-bg: var(--im-color-surface);
  --im-input-border: var(--im-color-border);
  --im-input-text: var(--im-color-text);
  --im-input-placeholder-text: var(--im-color-text-muted);
  --im-input-focus-border: var(--im-color-primary);
  --im-input-focus-shadow: rgba(var(--im-color-primary-rgb), 0.25);

  // --- Sizing & Spacing ---
  --im-border-radius: #{$im-border-radius};
  --im-spacing-unit: #{$im-spacing-unit};
  --im-content-padding: #{$im-content-padding};
  --im-section-padding-vertical: #{$im-section-padding-vertical};
  --im-navbar-height: #{$im-navbar-height};
  --im-navbar-scroll-transition-duration: #{$im-navbar-scroll-transition-duration};

  // --- Fonts ---
  --im-font-family-sans-serif: #{$im-font-primary};

  // --- Transitions ---
  --im-page-transition-duration-css: #{$im-page-transition-duration};

  // --- Icons ---
  --im-icon-color: var(--im-color-text-muted);
  --im-icon-color-hover: var(--im-color-primary);

  // --- Grid Lines ---
  --im-color-grid-lines-default: rgba(var(--im-color-border-rgb), 0.5);
  --im-color-grid-lines-section: rgba(45, 55, 72, 0.05);
  --im-color-grid-lines-hero: rgba(255, 255, 255, 0.08);
  --im-color-grid-lines-primary: rgba(var(--im-color-primary-rgb), 0.2);
  --im-color-grid-lines-light: rgba(var(--im-color-border-rgb), 0.3); // Lighter version of default border
  --im-color-grid-lines-dark: rgba(45, 55, 72, 0.1); // Darker version for contrast
}

// =============================================================================
// 3. CSS CUSTOM PROPERTIES (html.im-is-dark-mode - Dark Mode Overrides)
// =============================================================================
html.im-is-dark-mode {
  --im-color-primary-inverse: var(--im-color-text-headings); // Text on primary in dark mode might need to be dark text
  --im-color-text: #CBD5E0;
  --im-color-text-headings: #E2E8F0;
  --im-color-text-muted: #A0AEC0;
  --im-color-background: #171C23;
  --im-color-surface: #202731;
  --im-navbar-bg-transparent: rgba(32, 39, 49, 0.65);  // Dark transparent navbar bg
  --im-navbar-bg-scrolled: rgba(32, 39, 49, 0.9);    // Dark scrolled navbar bg
  --im-navbar-border-transparent: rgba(74, 85, 104, 0.0); // RGB of dark border
  --im-navbar-border-scrolled: rgba(74, 85, 104, 0.5);
  --im-color-surface-alt: #252E3D;

  --im-color-border-rgb: 74, 85, 104; // #4A5568 for dark mode
  --im-color-border: rgb(var(--im-color-border-rgb));
  --im-color-border-light: #3E4C5F;
  --im-color-border-hover: #5A6B81;

  --im-color-link: var(--im-color-primary-light);
  --im-color-link-hover: var(--im-color-primary);

  --im-button-primary-hover-bg: var(--im-color-primary-light);
  --im-button-primary-hover-border: var(--im-color-primary-light);
  --im-button-light-bg: #4A5568;
  --im-button-light-border: #4A5568;
  --im-button-light-text: var(--im-color-text-headings);
  --im-button-light-hover-bg: #5A6B81;
  --im-button-light-hover-border: #5A6B81;

  --im-input-bg: var(--im-color-surface);
  --im-input-border: var(--im-color-border);
  --im-input-text: var(--im-color-text-on-surface);
  --im-input-placeholder-text: var(--im-color-text-muted);

  --im-icon-color: var(--im-color-text-muted);
  --im-icon-color-hover: var(--im-color-primary-light);

  --im-color-grid-lines-default: rgba(var(--im-color-border-rgb), 0.4);
  --im-color-grid-lines-section: rgba(255, 255, 255, 0.04);
  --im-color-grid-lines-hero: rgba(255, 255, 255, 0.07);
  --im-color-grid-lines-primary: rgba(var(--im-color-primary-rgb), 0.25);
  --im-color-grid-lines-light: rgba(255, 255, 255, 0.08);
  --im-color-grid-lines-dark: rgba(255, 255, 255, 0.05); // "Dark" lines on a dark bg means very subtle light lines
}


// =============================================================================
// 4. HELPER MIXINS
// =============================================================================
@mixin im-apply-fading-grid($line-color-var-name, $spacing-var-name: '--current-grid-spacing', $fade-var-name: '--current-grid-fade-extent') {
  &::before {
    content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    width: 100%; height: 100%; z-index: -1; pointer-events: none;
    border-radius: inherit;

    --current-grid-spacing-val: var(#{$spacing-var-name}, #{$im-grid-default-spacing});
    --current-grid-fade-val: var(#{$fade-var-name}, #{$im-grid-default-fade-extent});
    --current-grid-line-color-val: var(#{$line-color-var-name}, var(--im-color-grid-lines-default));

    background-image:
      repeating-linear-gradient(to right, var(--current-grid-line-color-val) 0, var(--current-grid-line-color-val) #{$im-grid-line-width}, transparent #{$im-grid-line-width}, transparent var(--current-grid-spacing-val)),
      repeating-linear-gradient(to bottom, var(--current-grid-line-color-val) 0, var(--current-grid-line-color-val) #{$im-grid-line-width}, transparent #{$im-grid-line-width}, transparent var(--current-grid-spacing-val));
    background-size: var(--current-grid-spacing-val) var(--current-grid-spacing-val);
    background-position: center center;
    mask-image: radial-gradient(ellipse at center, black 0%, black var(--current-grid-fade-val), transparent 100%);
    -webkit-mask-image: radial-gradient(ellipse at center, black 0%, black var(--current-grid-fade-val), transparent 100%);
  }
}


// =============================================================================
// 5. BASE & ELEMENT STYLES
// =============================================================================
html {
  background-color: var(--im-color-background);
  font-size: $im-base-font-size;
  scroll-behavior: smooth;
}

body {
  font-family: var(--im-font-family-sans-serif);
  color: var(--im-color-text);
  font-weight: $im-font-weight-normal;
  line-height: $im-line-height-base;
  background-color: var(--im-color-background);
  min-height: 100vh;
  font-size: 1rem;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  transition: background-color 0.3s ease, color 0.3s ease;
}

h1, h2, h3, h4, h5, h6,
.title,
.subtitle {
  font-family: var(--im-font-family-sans-serif);
  color: var(--im-color-text-headings);
  font-weight: $im-font-weight-semibold;
  transition: color 0.3s ease;
  word-break: break-word;
}
.title { font-weight: $im-font-weight-bold !important; line-height: 1.2 !important; margin-bottom: var(--im-spacing-unit) !important; }
.subtitle { color: var(--im-color-text-muted) !important; font-weight: $im-font-weight-normal !important; line-height: 1.5 !important; margin-bottom: calc(var(--im-spacing-unit) * 1.5) !important; }
p { margin-bottom: var(--im-spacing-unit); }
a { color: var(--im-color-link); text-decoration: none; transition: color 0.2s ease-in-out; &:hover { color: var(--im-color-link-hover); } }
strong, b { color: var(--im-color-text-headings); font-weight: $im-font-weight-semibold; }
hr { background-color: var(--im-color-border); border: none; height: 1px; margin: var(--im-spacing-unit) 0; }
hr.is-divider { background-color: var(--im-color-border-light); }

.im-main-content-area { // Wrapper for main page content
    padding-top: var(--im-navbar-height); // Initial padding for fixed navbar
    transition: padding-top var(--im-navbar-scroll-transition-duration) ease-out;
}


// =============================================================================
// 6. BULMA LAYOUT COMPONENT OVERRIDES
// =============================================================================
.section {
  padding: var(--im-section-padding-vertical) 1.5rem;
  position: relative;
  &:not(.hero):not(.hero .section):not(.footer) { // Default grid for sections
    overflow: hidden;
    @include im-apply-fading-grid('--im-color-grid-lines-section');
    > .container, > .columns, > *:not(script):not(style) { // Ensure direct children content is above grid
        position: relative;
        z-index: 1;
    }
  }
}

.hero {
  &.is-primary {
    background-color: var(--im-color-primary); color: var(--im-color-primary-inverse);
    .title, .subtitle, strong { color: var(--im-color-primary-inverse) !important; }
    .button.is-light { /* ... same as previous working version ... */ }
  }
  .hero-body { padding: var(--im-section-padding-vertical) 1.5rem; }
  .hero-head, .hero-body, .hero-foot { position: relative; z-index: 1; }
}

.footer {
  background-color: var(--im-color-surface-alt); color: var(--im-color-text-muted);
  padding: calc(var(--im-spacing-unit) * 2.5) 1.5rem;
  border-top: 1px solid var(--im-color-border); font-size: 0.9em;
  a { color: var(--im-color-text); font-weight: $im-font-weight-medium;
    &:hover { color: var(--im-color-link-hover); }
  }
}


// =============================================================================
// 7. BULMA ELEMENT OVERRIDES
// =============================================================================
.button {
  font-family: var(--im-font-family-sans-serif); font-weight: $im-font-weight-semibold;
  border-radius: var(--im-border-radius); border-width: 1px;
  padding: $im-navbar-item-padding-vertical $im-navbar-item-padding-horizontal;
  box-shadow: 0 1px 2px rgba(0,0,0,0.05);
  transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
  &:active { transform: translateY(1px); box-shadow: none; }
  &.is-primary { /* ... same as previous working version ... */ }
  &.is-light { /* ... same as previous working version ... */ }
}

.box {
  background-color: var(--im-color-surface); border-radius: var(--im-border-radius);
  box-shadow: 0 3px 8px rgba(0,0,0,0.04), 0 1px 3px rgba(0,0,0,0.03);
  border: 1px solid var(--im-color-border-light); padding: var(--im-content-padding);
  color: var(--im-color-text-on-surface);
  transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
}

.content {
  p:not(:last-child), ul:not(:last-child), ol:not(:last-child), pre:not(:last-child),
  blockquote:not(:last-child), table:not(:last-child) { margin-bottom: var(--im-spacing-unit); }
  pre { /* ... same as previous working version ... */ }
  code:not(pre code) { /* ... same as previous working version ... */ }
  blockquote { /* ... same as previous working version ... */ }
  table { td, th { border-color: var(--im-color-border); } th { color: var(--im-color-text-headings); } }
}

.icon {
  color: var(--im-icon-color);
  i.ph { vertical-align: -0.125em; font-size: 1em; }
  a:hover > &, button:hover > &, a:hover > .icon-text > &.icon, button:hover > .icon-text > &.icon {
    color: var(--im-icon-color-hover);
  }
  .icon-text { color: var(--im-color-text); &:hover { color: var(--im-color-link-hover); } }
}

figure.image img { border-radius: var(--im-border-radius); }

.tag {
  border-radius: var(--im-border-radius); font-weight: $im-font-weight-medium;
  padding-left: 0.85em; padding-right: 0.85em;
  &.is-primary { background-color: var(--im-color-primary); color: var(--im-color-primary-inverse); }
  &.is-light { background-color: var(--im-button-light-bg); color: var(--im-button-light-text); }
}
// .notification, .progress, .table specific overrides can go here if needed


// =============================================================================
// 8. BULMA COMPONENT COLLECTION OVERRIDES
// =============================================================================
.card { /* ... same as previous working version ... */ }
.dropdown { /* ... same as previous working version ... */ }

.navbar.im-navbar-custom {
  min-height: var(--im-navbar-height) !important;
  background-color: var(--im-navbar-bg-transparent) !important;
  backdrop-filter: blur(8px) saturate(160%);
  -webkit-backdrop-filter: blur(8px) saturate(160%);
  border-bottom: 1px solid var(--im-navbar-border-transparent);
  transition: transform var(--im-navbar-scroll-transition-duration) ease-out,
              background-color var(--im-navbar-scroll-transition-duration) ease-out,
              border-color var(--im-navbar-scroll-transition-duration) ease-out,
              box-shadow var(--im-navbar-scroll-transition-duration) ease-out;
  position: fixed; top: 0; left: 0; right: 0; z-index: 1030;

  &.is-visible {
    transform: translateY(0%);
    background-color: var(--im-navbar-bg-scrolled) !important;
    border-bottom-color: var(--im-navbar-border-scrolled);
    box-shadow: 0 1px 3px rgba(0,0,0,0.04);
  }
  &.is-hidden-scroll { transform: translateY(-100%); }

  .navbar-brand {
    min-height: var(--im-navbar-height);
    .navbar-item { padding-top: 0; padding-bottom: 0; display:flex; align-items:center; }
  }
  .navbar-menu {
    @media screen and (max-width: 1023px) {
      &.is-active {
        background-color: var(--im-color-surface);
        box-shadow: 0 8px 16px rgba(10, 10, 10, 0.1); padding: 0.5rem 0;
        border-radius: 0 0 var(--im-border-radius) var(--im-border-radius); // only bottom radius
        border: 1px solid var(--im-color-border); border-top: none;
        position: absolute; left: 0; right: 0; top: 100%; z-index: 20;
      }
    }
  }
  .navbar-item, .navbar-link {
    color: var(--im-color-text) !important;
    font-weight: $im-font-weight-medium !important;
    padding: $im-navbar-item-padding-vertical $im-navbar-item-padding-horizontal !important;
    min-height: var(--im-navbar-height);
    display: flex; align-items: center; position: relative;
    transition: color 0.2s ease;
    .icon i.ph { transition: color 0.2s ease; }
    &:hover, &.is-hovered {
      background-color: transparent !important; color: var(--im-color-primary) !important;
      .icon i.ph { color: var(--im-color-primary) !important; }
    }
    &.is-active-nav-item {
      color: var(--im-color-primary) !important; font-weight: $im-font-weight-semibold !important;
      background-color: transparent !important;
      .icon i.ph { color: var(--im-color-primary) !important; }
      &::after {
        content: ''; position: absolute; bottom: 4px; left: 50%; transform: translateX(-50%);
        width: 0; height: 0; border-left: 5px solid transparent;
        border-right: 5px solid transparent; border-bottom: 5px solid var(--im-color-primary);
      }
    }
  }
  .navbar-link::after { border-color: var(--im-color-text-muted) !important; right: $im-navbar-item-padding-horizontal * 0.7; }
  .navbar-link:hover::after, .navbar-link.is-active-nav-item::after { border-color: var(--im-color-primary) !important; }

  .navbar-dropdown {
    background-color: var(--im-color-surface) !important; border: 1px solid var(--im-color-border) !important;
    border-top: none !important; border-radius: 0 0 var(--im-border-radius) var(--im-border-radius) !important;
    box-shadow: 0 6px 12px rgba(10, 10, 10, 0.1) !important;
    padding-top: 0.25rem !important; padding-bottom: 0.25rem !important; font-size: 0.9em;
    .navbar-item {
      padding: calc(#{$im-navbar-item-padding-vertical} * 0.85) calc(#{$im-navbar-item-padding-horizontal} * 1.1) !important;
      min-height: auto; color: var(--im-color-text) !important;
      &:hover { background-color: var(--im-color-surface-alt) !important; color: var(--im-color-primary) !important;}
      &.is-active-nav-item {
        background-color: rgba(var(--im-color-primary-rgb), 0.08) !important;
        color: var(--im-color-primary-dark) !important; font-weight: $im-font-weight-medium !important;
        &::after { display: none; }
      }
    }
  }
  .im-logo-link {
    .im-logo-image { max-height: calc(var(--im-navbar-height) * 0.55); margin-right: 0.5rem; }
    .im-logo-text { font-size: 1.05rem; color: var(--im-color-text-headings); font-weight: $im-font-weight-bold;}
  }
  .im-nav-icon { margin-right: 0.4em; i.ph { font-size: 1.1em; } }
  .im-nav-image-icon { max-height: 1.1rem; margin-right: 0.4em; &.is-small { max-height: 0.9rem; } }
  .navbar-brand .navbar-item.is-hidden-desktop { margin-left:auto; }
  .im-navbar-mobile-action, .im-dark-mode-toggle { // Ensures desktop toggle is also covered if not hidden
    .icon i.ph { color: var(--im-color-text-muted); }
    &:hover .icon i.ph { color: var(--im-color-primary); }
  }
}

.panel { /* ... same as previous working version with $im-content-padding ... */ }


// =============================================================================
// 9. BULMA FORM COMPONENT OVERRIDES
// =============================================================================
.input, .textarea, .select select {
  font-family: var(--im-font-family-sans-serif); border-radius: var(--im-border-radius);
  border: 1px solid var(--im-input-border); box-shadow: none;
  background-color: var(--im-input-bg); color: var(--im-input-text);
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
  padding: 0.6em 0.9em;
  &::placeholder { color: var(--im-input-placeholder-text); opacity: 0.7; }
  &:hover { border-color: var(--im-color-border-hover); }
  &:focus, &.is-focused, &:active, &.is-active {
    border-color: var(--im-input-focus-border) !important;
    box-shadow: 0 0 0 0.125em var(--im-input-focus-shadow) !important;
  }
}
.textarea { line-height: $im-line-height-base; }
.select:not(.is-multiple):not(.is-loading)::after { border-color: var(--im-color-primary); }
.label { color: var(--im-color-text-headings); font-weight: $im-font-weight-semibold; margin-bottom: 0.5em; }
.help { color: var(--im-color-text-muted); font-size: 0.875em; margin-top: 0.25em; }
// .checkbox, .radio, .file - style if used extensively


// =============================================================================
// 10. UTILITY CLASSES (Grid System)
// =============================================================================
.im-has-grid {
  position: relative;
  z-index: 0; // Establish stacking context for ::before pseudo-element
}
.im-has-grid::before { // Corrected: ::before directly on .im-has-grid
  content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
  width: 100%; height: 100%; z-index: -1; pointer-events: none;
  border-radius: inherit;

  --current-grid-spacing: var(--im-grid-spacing-val, #{$im-grid-default-spacing});
  --current-grid-line-width: #{$im-grid-line-width};
  --current-grid-fade-extent: var(--im-grid-fade-val, #{$im-grid-default-fade-extent});
  --current-grid-line-color: var(#{$im-grid-default-color-var});

  background-image:
    repeating-linear-gradient(to right, var(--current-grid-line-color) 0, var(--current-grid-line-color) var(--current-grid-line-width), transparent var(--current-grid-line-width), transparent var(--current-grid-spacing)),
    repeating-linear-gradient(to bottom, var(--current-grid-line-color) 0, var(--current-grid-line-color) var(--current-grid-line-width), transparent var(--current-grid-line-width), transparent var(--current-grid-spacing));
  background-size: var(--current-grid-spacing) var(--current-grid-spacing);
  background-position: center center;
  mask-image: radial-gradient(ellipse at center, black 0%, black var(--current-grid-fade-extent), transparent 100%);
  -webkit-mask-image: radial-gradient(ellipse at center, black 0%, black var(--current-grid-fade-extent), transparent 100%);
}

// Grid modifiers must target the pseudo-element of .im-has-grid
.im-has-grid.is-grid-tiny::before    { --im-grid-spacing-val: 10px; }
.im-has-grid.is-grid-small::before   { --im-grid-spacing-val: 15px; }
.im-has-grid.is-grid-large::before   { --im-grid-spacing-val: 45px; }

.im-has-grid.is-grid-primary::before { --current-grid-line-color: var(--im-color-grid-lines-primary); }
.im-has-grid.is-grid-light::before   { --current-grid-line-color: var(--im-color-grid-lines-light); }
.im-has-grid.is-grid-dark::before    { --current-grid-line-color: var(--im-color-grid-lines-dark); }

.im-has-grid.is-grid-fade-none::before   { mask-image: none; -webkit-mask-image: none; }
.im-has-grid.is-grid-fade-subtle::before { --im-grid-fade-val: 85%; }
.im-has-grid.is-grid-fade-tight::before  { --im-grid-fade-val: 45%; }


// =============================================================================
// 11. PAGE TRANSITION ANIMATIONS
// =============================================================================
body.im-page-is-loading { opacity: 1; }
body.im-page-is-entering { opacity: 1; }
body.im-page-is-exiting {
  animation: imPageFadeOutDown $im-page-transition-duration forwards ease-in !important;
}
@keyframes imPageFadeOutDown {
  from { opacity: 1; transform: translateY(0); }
  to   { opacity: 0; transform: translateY($im-page-transition-translateY); }
}


// =============================================================================
// 12. DARK MODE SPECIFIC COMPONENT ADJUSTMENTS
// =============================================================================
html.im-is-dark-mode {
  // Specific adjustments if CSS variables are not enough
  .box {
    box-shadow: 0 5px 15px rgba(0,0,0,0.25), 0 2px 6px rgba(0,0,0,0.2);
    border-color: var(--im-color-border); // Already uses CSS var
  }
  .card {
    box-shadow: 0 6px 18px rgba(0,0,0,0.28), 0 2px 8px rgba(0,0,0,0.22);
    border-color: var(--im-color-border); // Already uses CSS var
  }
  .navbar.im-navbar-custom {
    border-bottom-color: var(--im-navbar-border-transparent); // Uses dark mode var
    &.is-visible {
        border-bottom-color: var(--im-navbar-border-scrolled); // Uses dark mode var
        box-shadow: 0 1px 3px rgba(0,0,0,0.15); // Darker subtle shadow
    }
  }
  .navbar .navbar-menu {
    @media screen and (max-width: 1023px) {
      &.is-active {
        background-color: var(--im-color-surface);
        box-shadow: 0 8px 16px rgba(0,0,0,0.35);
        border-color: var(--im-color-border);
      }
    }
  }
  .navbar .navbar-dropdown {
     background-color: var(--im-color-surface) !important;
     border-color: var(--im-color-border) !important;
     box-shadow: 0 6px 12px rgba(0,0,0,0.3) !important;
     .navbar-item:hover { background-color: var(--im-color-surface-alt) !important; }
     .navbar-item.is-active-nav-item {
         background-color: rgba(var(--im-color-primary-rgb), 0.2) !important;
         color: var(--im-color-primary-light) !important;
     }
  }
  .im-navbar-mobile-action .icon i.ph,
  .navbar .im-dark-mode-toggle .icon i.ph {
    color: var(--im-icon-color); // Uses dark mode muted color
    &:hover { color: var(--im-icon-color-hover); } // Uses dark mode primary light
  }

  .content pre { background-color: var(--im-color-surface-alt); border-color: var(--im-color-border); }
  .content code:not(pre code) { background-color: #3E4C5F; border-color: #4A5568; color: var(--im-color-primary-light); }
  .content blockquote { background-color: var(--im-color-surface-alt); border-left-color: var(--im-color-primary-light); }

  // Table dark mode
  .table {
    background-color: var(--im-color-surface);
    color: var(--im-color-text-on-surface);
    th { border-color: var(--im-color-border-light); color: var(--im-color-text-headings); }
    td { border-color: var(--im-color-border); }
    &.is-striped tbody tr:not(.is-selected):nth-child(even) {
      background-color: var(--im-color-surface-alt);
    }
    &.is-hoverable tbody tr:not(.is-selected):hover {
      background-color: var(--im-color-border-light);
    }
  }
}