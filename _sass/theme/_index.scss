// =============================================================================
// INDEX.SCSS - "IM" THEME FOR BULMA
// =============================================================================
// TABLE OF CONTENTS:
// 1.  THEME VARIABLES (im- prefix for custom SCSS vars)
// 2.  CSS CUSTOM PROPERTIES (IM Theme :root defaults)
// 3.  HELPER MIXINS
// 4.  BASE & ELEMENT STYLES (HTML, Body, Typography, Links)
// 5.  BULMA COMPONENT OVERRIDES
//     5.1. Layout (Section, Hero, Footer)
//     5.2. Elements (Button, Box, Content, Icon, Image, Tag, Title)
//     5.3. Components (Card, Dropdown, Media, Navbar, Panel)
//     5.4. Form (Input, Textarea, Select)
// 6.  PAGE TRANSITION ANIMATIONS
// 7.  UTILITIES
// 8.  DARK MODE STYLES
// =============================================================================


// =============================================================================
// 1. THEME VARIABLES
// =============================================================================
$im-font-primary: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
$im-font-weight-normal: 400;
$im-font-weight-medium: 500;
$im-font-weight-semibold: 600;
$im-font-weight-bold: 700;
$im-base-font-size: 16px;
$im-line-height-base: 1.65;
$im-border-radius: 8px;
$im-spacing-unit: 1rem;
$im-section-padding-vertical: calc(#{$im-spacing-unit} * 3);
$im-content-padding: calc(#{$im-spacing-unit} * 1.5);
$im-page-transition-duration: 0.2s;
$im-page-transition-delay: 0.05s;
$im-page-transition-translateY: 15px;
$im-grid-spacing: 30px;
$im-grid-line-width: 1px;
$im-grid-fade-extent: 65%;


// =============================================================================
// 2. CSS CUSTOM PROPERTIES (IM Theme :root defaults)
// =============================================================================
:root {
  --im-color-primary-rgb: 229, 57, 53;
  --im-color-primary: rgb(var(--im-color-primary-rgb));
  --im-color-primary-light: #ef5350;
  --im-color-primary-dark: #c62828;
  --im-color-primary-inverse: #FFFFFF;

  --im-color-text: #2D3748;
  --im-color-text-headings: #1A202C;
  --im-color-text-muted: #718096;
  --im-color-text-on-primary: #FFFFFF;
  --im-color-text-on-surface: var(--im-color-text);

  --im-color-background: #F9FAFB;
  --im-color-surface: #FFFFFF;
  --im-color-surface-alt: #F0F2F5;
  --im-color-border: #E2E8F0;
  --im-color-border-light: #EFF2F7;
  --im-color-border-hover: #D1D9E6; // New: For input hover state

  --im-color-link: var(--im-color-primary);
  --im-color-link-hover: var(--im-color-primary-dark);

  --im-button-primary-bg: var(--im-color-primary);
  --im-button-primary-border: var(--im-color-primary);
  --im-button-primary-text: var(--im-color-primary-inverse);
  --im-button-primary-hover-bg: var(--im-color-primary-dark);
  --im-button-primary-hover-border: var(--im-color-primary-dark);

  --im-button-light-bg: #FEEBEE;
  --im-button-light-border: #FEEBEE;
  --im-button-light-text: var(--im-color-primary-dark);
  --im-button-light-hover-bg: #FFCDD2;
  --im-button-light-hover-border: #FFCDD2;

  --im-input-bg: var(--im-color-surface);
  --im-input-border: var(--im-color-border);
  --im-input-text: var(--im-color-text);
  --im-input-placeholder-text: var(--im-color-text-muted);
  --im-input-focus-border: var(--im-color-primary);
  --im-input-focus-shadow: rgba(var(--im-color-primary-rgb), 0.25);

  --im-border-radius: #{$im-border-radius};
  --im-spacing-unit: #{$im-spacing-unit};
  --im-content-padding: #{$im-content-padding};
  --im-section-padding-vertical: #{$im-section-padding-vertical};
  --im-font-family-sans-serif: #{$im-font-primary};
  --im-page-transition-duration-css: #{$im-page-transition-duration};
  --im-grid-line-color-for-section: rgba(45, 55, 72, 0.06);
  --im-grid-line-color-for-hero: rgba(255, 255, 255, 0.12);
  --im-icon-color: var(--im-color-text-muted);
  --im-icon-color-hover: var(--im-color-primary);
}


// =============================================================================
// 3. HELPER MIXINS
// =============================================================================
@mixin im-apply-fading-grid($line-color-var-name) {
  &::before {
    content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    width: 100%; height: 100%; z-index: 0;
    background-image:
      repeating-linear-gradient(to right, var(#{$line-color-var-name}) 0, var(#{$line-color-var-name}) #{$im-grid-line-width}, transparent #{$im-grid-line-width}, transparent #{$im-grid-spacing}),
      repeating-linear-gradient(to bottom, var(#{$line-color-var-name}) 0, var(#{$line-color-var-name}) #{$im-grid-line-width}, transparent #{$im-grid-line-width}, transparent #{$im-grid-spacing});
    background-size: #{$im-grid-spacing} #{$im-grid-spacing};
    background-position: center center;
    mask-image: radial-gradient(ellipse at center, black 0%, black #{$im-grid-fade-extent}, transparent 100%);
    -webkit-mask-image: radial-gradient(ellipse at center, black 0%, black #{$im-grid-fade-extent}, transparent 100%);
    pointer-events: none;
  }
}


// =============================================================================
// 4. BASE & ELEMENT STYLES
// =============================================================================
html {
  background-color: var(--im-color-background);
  font-size: $im-base-font-size;
  scroll-behavior: smooth;
}

body {
  font-family: var(--im-font-family-sans-serif);
  color: var(--im-color-text);
  font-weight: $im-font-weight-normal;
  line-height: $im-line-height-base;
  background-color: var(--im-color-background);
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  transition: background-color 0.3s ease, color 0.3s ease;
}

h1, h2, h3, h4, h5, h6,
.title,
.subtitle {
  font-family: var(--im-font-family-sans-serif);
  color: var(--im-color-text-headings);
  font-weight: $im-font-weight-semibold;
  transition: color 0.3s ease;
}

.title {
  font-weight: $im-font-weight-bold !important;
  line-height: 1.2 !important;
  margin-bottom: var(--im-spacing-unit) !important;
}

.subtitle {
  color: var(--im-color-text-muted) !important;
  font-weight: $im-font-weight-normal !important;
  line-height: 1.5 !important;
  margin-bottom: calc(var(--im-spacing-unit) * 1.5) !important;
}

p { margin-bottom: var(--im-spacing-unit); }

a {
  color: var(--im-color-link);
  text-decoration: none;
  transition: color 0.2s ease-in-out;
  &:hover { color: var(--im-color-link-hover); }
}

strong, b {
  color: var(--im-color-text-headings);
  font-weight: $im-font-weight-semibold;
  transition: color 0.3s ease;
}

hr {
  background-color: var(--im-color-border);
  border: none; height: 1px; margin: var(--im-spacing-unit) 0;
}
hr.is-divider { background-color: var(--im-color-border-light); }


// =============================================================================
// 5. BULMA COMPONENT OVERRIDES
// =============================================================================

// 5.1. Layout (Section, Hero, Footer)
// -----------------------------------------------------------------------------
.section {
  padding: var(--im-section-padding-vertical) 1.5rem;
}

.hero {
  &.is-primary {
    background-color: var(--im-color-primary);
    color: var(--im-color-primary-inverse);
    .title, .subtitle, strong { color: var(--im-color-primary-inverse) !important; }
    .button.is-light {
      background-color: var(--im-color-primary-inverse) !important;
      border-color: var(--im-color-primary-inverse) !important;
      color: var(--im-color-primary) !important;
      &:hover { background-color: rgba(255, 255, 255, 0.9) !important; border-color: rgba(255, 255, 255, 0.9) !important; }
      &.is-outlined {
        background-color: transparent !important; border-color: var(--im-color-primary-inverse) !important; color: var(--im-color-primary-inverse) !important;
        &:hover { background-color: rgba(255, 255, 255, 0.1) !important; }
      }
    }
  }
}

.footer {
  background-color: var(--im-color-surface-alt);
  color: var(--im-color-text-muted);
  padding: calc(var(--im-spacing-unit) * 2.5) 1.5rem;
  border-top: 1px solid var(--im-color-border);
  a { color: var(--im-color-text); font-weight: $im-font-weight-medium;
    &:hover { color: var(--im-color-link-hover); }
  }
}

// 5.2. Elements (Button, Box, Content, Icon, Image, Tag, Title)
// -----------------------------------------------------------------------------
.button {
  font-family: var(--im-font-family-sans-serif);
  font-weight: $im-font-weight-semibold;
  border-radius: var(--im-border-radius);
  border-width: 1px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.05);
  transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
  &:active { transform: translateY(1px); box-shadow: none; }

  &.is-primary {
    background-color: var(--im-button-primary-bg); border-color: var(--im-button-primary-border); color: var(--im-button-primary-text);
    &:hover { background-color: var(--im-button-primary-hover-bg); border-color: var(--im-button-primary-hover-border); }
    &:focus, &.is-focused { box-shadow: 0 0 0 0.125em var(--im-input-focus-shadow); }
  }
  &.is-light {
    background-color: var(--im-button-light-bg); border-color: var(--im-button-light-border); color: var(--im-button-light-text);
    &:hover { background-color: var(--im-button-light-hover-bg); border-color: var(--im-button-light-hover-border); }
  }
}

.box {
  background-color: var(--im-color-surface);
  border-radius: var(--im-border-radius);
  box-shadow: 0 3px 8px rgba(0,0,0,0.04), 0 1px 3px rgba(0,0,0,0.03);
  border: 1px solid var(--im-color-border-light);
  padding: var(--im-content-padding);
  color: var(--im-color-text-on-surface);
  transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
}

.content {
  p:not(:last-child), ul:not(:last-child), ol:not(:last-child), pre:not(:last-child),
  blockquote:not(:last-child), table:not(:last-child) {
    margin-bottom: var(--im-spacing-unit);
  }
  pre {
    background-color: var(--im-color-surface-alt); border: 1px solid var(--im-color-border);
    border-radius: calc(var(--im-border-radius) * 0.75); padding: var(--im-spacing-unit);
    code { background-color: transparent; color: var(--im-color-text-on-surface); }
  }
  code:not(pre code) {
    background-color: var(--im-color-surface-alt); border: 1px solid var(--im-color-border-light);
    color: var(--im-color-primary-dark); padding: 0.15em 0.4em;
    border-radius: calc(var(--im-border-radius) * 0.5); font-size: 0.9em;
  }
  blockquote {
    background-color: var(--im-color-surface-alt); border-left: 4px solid var(--im-color-primary);
    padding: var(--im-spacing-unit) var(--im-content-padding); color: var(--im-color-text-muted);
  }
}

.icon {
  color: var(--im-icon-color);
  i.ph { vertical-align: middle; }
  a:hover > &, button:hover > & { color: var(--im-icon-color-hover); }
}

figure.image img { border-radius: var(--im-border-radius); }

.tag {
  border-radius: var(--im-border-radius); font-weight: $im-font-weight-medium;
  &.is-primary { background-color: var(--im-color-primary); color: var(--im-color-primary-inverse); }
  &.is-light { background-color: var(--im-button-light-bg); color: var(--im-button-light-text); }
}

// 5.3. Components (Card, Dropdown, Media, Navbar, Panel)
// -----------------------------------------------------------------------------
.card {
  background-color: var(--im-color-surface); border-radius: var(--im-border-radius);
  box-shadow: 0 4px 10px rgba(0,0,0,0.05), 0 1px 3px rgba(0,0,0,0.04);
  border: 1px solid var(--im-color-border); color: var(--im-color-text-on-surface);
  transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
  .card-header {
    background-color: transparent; border-bottom: 1px solid var(--im-color-border);
    box-shadow: none; padding: 0.75rem var(--im-content-padding);
    .card-header-title { color: var(--im-color-text-headings); font-weight: $im-font-weight-semibold; }
  }
  .card-image img {
    border-top-left-radius: var(--im-border-radius); border-top-right-radius: var(--im-border-radius);
    border-bottom-left-radius: 0; border-bottom-right-radius: 0;
  }
  .card-content { padding: var(--im-content-padding); }
  .card-footer {
    background-color: transparent; border-top: 1px solid var(--im-color-border);
    padding: 0.75rem var(--im-content-padding);
  }
}

.dropdown {
  .dropdown-menu {
    background-color: var(--im-color-surface); border: 1px solid var(--im-color-border);
    border-radius: var(--im-border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    padding-top: 0.25rem; padding-bottom: 0.25rem;
  }
  .dropdown-item, .dropdown-link {
    color: var(--im-color-text); padding: 0.5rem 1rem;
    &:hover { background-color: var(--im-color-surface-alt); color: var(--im-color-primary); }
    &.is-active { background-color: var(--im-color-primary); color: var(--im-color-primary-inverse); }
  }
  .dropdown-divider { background-color: var(--im-color-border-light); }
}

.navbar {
  background-color: var(--im-color-surface) !important; /* Overriding Bulma */
  transition: background-color 0.3s ease, box-shadow 0.3s ease;
  &.has-shadow-navbar { box-shadow: 0 2px 3px rgba(10, 10, 10, 0.06) !important; } // Softer shadow

  .navbar-item, .navbar-link {
    color: var(--im-color-text) !important;
    font-weight: $im-font-weight-medium !important;
    transition: color 0.2s ease, background-color 0.2s ease;
    &:hover, &.is-hovered { // is-hovered for dropdown parent
      background-color: var(--im-color-surface-alt) !important;
      color: var(--im-color-primary) !important;
    }
    &.is-active-nav-item { // Custom class for active items
      color: var(--im-color-primary) !important;
      font-weight: $im-font-weight-semibold !important;
      background-color: transparent !important; // No background for active top-level
      // Optional: add an indicator for active item
      // position: relative;
      // &::after {
      //   content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
      //   width: 6px; height: 6px; background-color: var(--im-color-primary); border-radius: 50%;
      // }
    }
  }
  .navbar-link::after { border-color: var(--im-color-primary) !important; }
  .navbar-brand .navbar-item {
    font-weight: $im-font-weight-bold !important; color: var(--im-color-text-headings) !important;
    &:hover { background-color: transparent !important; }
  }
  .navbar-dropdown {
    background-color: var(--im-color-surface) !important;
    border: 1px solid var(--im-color-border) !important;
    border-top: 1px solid var(--im-color-border-light) !important; // Slightly lighter top border
    border-radius: 0 0 var(--im-border-radius) var(--im-border-radius) !important;
    box-shadow: 0 8px 16px rgba(10, 10, 10, 0.08) !important; // Softer shadow
    padding-top: 0.25rem !important; padding-bottom: 0.25rem !important;
    .navbar-item {
      font-size: 0.95em; padding-left: 1.25rem; padding-right: 1.25rem;
      &:hover { background-color: var(--im-color-surface-alt) !important; }
      &.is-active-nav-item { // Active item in dropdown
        background-color: rgba(var(--im-color-primary-rgb), 0.1) !important;
        color: var(--im-color-primary-dark) !important;
        font-weight: $im-font-weight-medium !important; // Less emphasis than top-level
      }
    }
  }
  // For the theme toggle icon (using your existing class)
  .im-dark-mode-toggle .icon i.ph {
     color: var(--im-color-text-muted);
     transition: color 0.2s ease;
     &:hover { color: var(--im-color-primary); }
  }
  .im-logo-link {
    display: flex; align-items: center;
    .im-logo-image { max-height: 1.75rem; /* Adjust logo height */ margin-right: 0.5rem; }
    .im-logo-text { font-weight: $im-font-weight-bold; font-size: 1.2rem; color: var(--im-color-text-headings); }
  }
  .im-nav-icon { margin-right: 0.5em; i.ph { font-size: 1.2em; } }
  .im-nav-image-icon { max-height: 1.25rem; margin-right: 0.5em; &.is-small { max-height: 1rem; } }
}

.panel {
  border-radius: var(--im-border-radius); border: 1px solid var(--im-color-border);
  background-color: var(--im-color-surface);
  .panel-heading {
    background-color: var(--im-color-surface-alt); color: var(--im-color-text-headings);
    font-weight: $im-font-weight-semibold; border-bottom: 1px solid var(--im-color-border);
    border-top-left-radius: var(--im-border-radius); border-top-right-radius: var(--im-border-radius);
  }
  .panel-tabs a {
    color: var(--im-color-text-muted);
    &.is-active { color: var(--im-color-primary); border-bottom-color: var(--im-color-primary); }
  }
  .panel-block {
    color: var(--im-color-text-on-surface); border-bottom: 1px solid var(--im-color-border-light);
    &:last-child { border-bottom: none; }
    &:hover { background-color: var(--im-color-surface-alt); }
    .panel-icon { color: var(--im-color-text-muted); }
  }
}

// 5.4. Form (Input, Textarea, Select)
// -----------------------------------------------------------------------------
.input, .textarea, .select select {
  font-family: var(--im-font-family-sans-serif); border-radius: var(--im-border-radius);
  border: 1px solid var(--im-input-border); box-shadow: none;
  background-color: var(--im-input-bg); color: var(--im-input-text);
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
  &::placeholder { color: var(--im-input-placeholder-text); opacity: 0.7; }
  &:hover { border-color: var(--im-color-border-hover); } /* Use new hover variable */
  &:focus, &.is-focused, &:active, &.is-active {
    border-color: var(--im-input-focus-border) !important;
    box-shadow: 0 0 0 0.125em var(--im-input-focus-shadow) !important;
  }
}
.select:not(.is-multiple):not(.is-loading)::after { border-color: var(--im-color-primary); }


// =============================================================================
// 6. PAGE TRANSITION ANIMATIONS
// =============================================================================
body.im-page-is-loading { opacity: 0; }
body.im-page-is-entering {
  animation: imPageFadeInUp $im-page-transition-duration forwards ease-out;
  animation-delay: $im-page-transition-delay;
}
body.im-page-is-exiting {
  animation: imPageFadeOutDown $im-page-transition-duration forwards ease-in !important;
}
@keyframes imPageFadeInUp {
  from { opacity: 0; transform: translateY($im-page-transition-translateY); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes imPageFadeOutDown {
  from { opacity: 1; transform: translateY(0); }
  to   { opacity: 0; transform: translateY($im-page-transition-translateY); }
}


// =============================================================================
// 7. UTILITIES
// =============================================================================
// .is-clipped-1, .is-clipped-2 { /* Defined elsewhere if needed, or here */ }
// .has-shadow-navbar already defined under .navbar


// =============================================================================
// 8. DARK MODE STYLES
// =============================================================================
html.im-is-dark-mode {
  --im-color-primary-inverse: var(--im-color-text);
  --im-color-text: #CBD5E0;
  --im-color-text-headings: #E2E8F0;
  --im-color-text-muted: #A0AEC0;
  --im-color-background: #1A202C;
  --im-color-surface: #2D3748;
  --im-color-surface-alt: #252E3D;
  --im-color-border: #4A5568;
  --im-color-border-light: #3E4C5F;
  --im-color-border-hover: #5A6B81; // Dark mode input hover
  --im-color-link: var(--im-color-primary-light);
  --im-color-link-hover: var(--im-color-primary);
  --im-button-primary-hover-bg: var(--im-color-primary-light);
  --im-button-primary-hover-border: var(--im-color-primary-light);
  --im-button-light-bg: #4A5568;
  --im-button-light-border: #4A5568;
  --im-button-light-text: var(--im-color-text-headings);
  --im-button-light-hover-bg: #5A6B81;
  --im-button-light-hover-border: #5A6B81;
  --im-input-bg: var(--im-color-surface);
  --im-input-border: var(--im-color-border);
  --im-input-text: var(--im-color-text-on-surface);
  --im-input-placeholder-text: var(--im-color-text-muted);
  --im-grid-line-color-for-section: rgba(255, 255, 255, 0.05);
  --im-icon-color: var(--im-color-text-muted);
  --im-icon-color-hover: var(--im-color-primary-light);

  .box { box-shadow: 0 5px 15px rgba(0,0,0,0.2), 0 2px 6px rgba(0,0,0,0.15); border-color: var(--im-color-border); }
  .card { box-shadow: 0 6px 18px rgba(0,0,0,0.22), 0 2px 8px rgba(0,0,0,0.18); border-color: var(--im-color-border); }
  .navbar.has-shadow-navbar { box-shadow: 0 2px 4px rgba(0,0,0,0.35) !important; }
  .navbar .navbar-dropdown { box-shadow: 0 8px 16px rgba(0,0,0,0.25) !important; }
  .content pre { background-color: #252E3D; border-color: var(--im-color-border); }
  .content code:not(pre code) { background-color: #3E4C5F; border-color: #4A5568; color: var(--im-color-primary-light); }
  .content blockquote { background-color: var(--im-color-surface-alt); border-left-color: var(--im-color-primary-light); }

  .navbar .navbar-item.im-dark-mode-toggle .icon i.ph {
    color: var(--im-color-text-muted);
    &:hover { color: var(--im-color-primary-light); }
  }
}