// index.scss - Single File SCSS for "IM" Themed Bulma Overrides

//------------------------------------------------------------------------------
// 1. SCSS Variables (im- prefix)
//------------------------------------------------------------------------------

// Font
$im-font-primary: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
$im-font-weight-normal: 400;
$im-font-weight-medium: 500;
$im-font-weight-semibold: 600;
$im-font-weight-bold: 700;
$im-base-font-size: 16px;
$im-line-height-base: 1.65;

// Sizing & Spacing
$im-border-radius: 8px;
$im-spacing-unit: 1rem;
$im-section-padding-vertical: calc(#{$im-spacing-unit} * 4);
$im-content-padding: calc(#{$im-spacing-unit} * 1.75); // For .box, .card, .panel content

// Page Transition (FASTER ANIMATIONS)
$im-page-transition-duration: 0.2s; // Faster
$im-page-transition-delay: 0.05s;    // Shorter delay (or 0s if preferred)
$im-page-transition-translateY: 15px; // Slightly less translation

// Grid Lines
$im-grid-spacing: 30px;
$im-grid-line-width: 1px;
$im-grid-fade-extent: 65%;

//------------------------------------------------------------------------------
// 2. CSS Custom Properties for Theming (:root for Light Mode Defaults)
//------------------------------------------------------------------------------
:root {
  // Primary Colors (Red Theme)
  --im-color-primary-rgb: 229, 57, 53; // For rgba() usage, #e53935
  --im-color-primary: rgb(var(--im-color-primary-rgb));
  --im-color-primary-light: #ef5350;
  --im-color-primary-dark: #c62828;

  // Text Colors - Light Mode
  --im-color-text: #2D3748;
  --im-color-text-headings: #1A202C;
  --im-color-text-muted: #718096;
  --im-color-text-on-primary: #FFFFFF;
  --im-color-text-on-surface: var(--im-color-text); // Text on cards/boxes

  // Background & Surface Colors - Light Mode
  --im-color-background: #F9FAFB;
  --im-color-surface: #FFFFFF; // For cards, boxes, navbar, panel
  --im-color-border: #E2E8F0;
  --im-color-input-bg: var(--im-color-surface);
  --im-color-input-border: var(--im-color-border);

  // Button Specifics - Light Mode
  --im-button-light-bg: #FEEBEE; // Light red tint
  --im-button-light-border: #FEEBEE;
  --im-button-light-text: var(--im-color-primary-dark);
  --im-button-light-hover-bg: #FFCDD2;
  --im-button-light-hover-border: #FFCDD2;

  // Grid Line Colors - Light Mode
  --im-grid-line-color-for-section: rgba(45, 55, 72, 0.06);
  --im-grid-line-color-for-hero: rgba(255, 255, 255, 0.12);

  // Theme Toggle related (old, but keeping for reference if parts are reused - now primarily controlled by icon color vars if needed)
  // --im-toggle-bg-off: #ccc; // Not used by new toggle
  // --im-toggle-bg-on: var(--im-color-primary); // Not used by new toggle
  // --im-toggle-slider-color: white; // Not used by new toggle
  // For icon colors (though icons typically inherit color or use their own SVG fill)
  --im-icon-sun-color: #f39c12; // Example if you want to control icon color via CSS var
  --im-icon-moon-color: var(--im-color-text); // Example for light mode moon

  // Page Transition Duration for JS
  --im-page-transition-duration-css: #{$im-page-transition-duration};
}

//------------------------------------------------------------------------------
// 3. Mixins
//------------------------------------------------------------------------------

@mixin im-apply-fading-grid($line-color-var-name) {
  &::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    z-index: 0;

    background-image:
      repeating-linear-gradient(
        to right,
        var(#{$line-color-var-name}) 0,
        var(#{$line-color-var-name}) $im-grid-line-width,
        transparent $im-grid-line-width,
        transparent $im-grid-spacing
      ),
      repeating-linear-gradient(
        to bottom,
        var(#{$line-color-var-name}) 0,
        var(#{$line-color-var-name}) $im-grid-line-width,
        transparent $im-grid-line-width,
        transparent $im-grid-spacing
      );
    background-size: $im-grid-spacing $im-grid-spacing;
    background-position: center center;

    mask-image: radial-gradient(ellipse at center, black 0%, black $im-grid-fade-extent, transparent 100%);
    -webkit-mask-image: radial-gradient(ellipse at center, black 0%, black $im-grid-fade-extent, transparent 100%);
    pointer-events: none;
  }
}

//------------------------------------------------------------------------------
// 4. Animations (Page Transitions) - Use SCSS variables for duration
//------------------------------------------------------------------------------

@keyframes imPageFadeInUp {
  from {
    opacity: 0;
    transform: translateY($im-page-transition-translateY);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes imPageFadeOutDown {
  from {
    opacity: 1;
    transform: translateY(0);
  }
  to {
    opacity: 0;
    transform: translateY($im-page-transition-translateY);
  }
}

//------------------------------------------------------------------------------
// 5. Base Styles (HTML, Body, Typography)
//------------------------------------------------------------------------------

html {
  background-color: var(--im-color-background) !important;
  scroll-behavior: smooth;
  font-size: $im-base-font-size;
}

body {
  font-family: $im-font-primary !important;
  color: var(--im-color-text) !important;
  font-weight: $im-font-weight-normal !important;
  line-height: $im-line-height-base !important;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background-color: var(--im-color-background) !important;
  min-height: 100vh;
  transition: background-color 0.3s ease, color 0.3s ease;

  &.im-page-is-loading {
    opacity: 0;
  }
  &.im-page-is-entering {
    animation: imPageFadeInUp $im-page-transition-duration forwards ease-out;
    animation-delay: $im-page-transition-delay;
  }
  &.im-page-is-exiting {
    animation: imPageFadeOutDown $im-page-transition-duration forwards ease-in !important;
  }
}

h1, h2, h3, h4, h5, h6,
.title,
.subtitle {
  font-family: $im-font-primary !important;
  color: var(--im-color-text-headings) !important;
  transition: color 0.3s ease;
}

.title {
  font-weight: $im-font-weight-bold !important;
  line-height: 1.2 !important;
  margin-bottom: calc(#{$im-spacing-unit} * 1) !important;
  &.is-1 { font-size: 2.75rem !important; }
  &.is-2 { font-size: 2rem !important; }
  &.is-3 { font-size: 1.75rem !important; }
}

.subtitle {
  color: var(--im-color-text-muted) !important;
  font-weight: $im-font-weight-normal !important;
  line-height: 1.5 !important;
  margin-bottom: calc(#{$im-spacing-unit} * 1.5) !important;
  &.is-3 { font-size: 1.25rem !important; }
  &.is-4 { font-size: 1.1rem !important; }
}

p {
  margin-bottom: $im-spacing-unit !important;
}

a {
  color: var(--im-color-primary) !important;
  text-decoration: none !important;
  transition: color 0.2s ease-in-out, opacity 0.2s ease-in-out;
  &:hover {
    color: var(--im-color-primary-dark) !important;
  }
}

strong, b {
  color: var(--im-color-text-headings) !important;
  font-weight: $im-font-weight-semibold !important;
  transition: color 0.3s ease;
}

//------------------------------------------------------------------------------
// 6. Component Overrides (Largely unchanged, will use new theme vars)
//------------------------------------------------------------------------------

// --- Hero Section (WITH GRID LINES) ---
.hero {
  position: relative;
  overflow: hidden;
  transition: background-color 0.3s ease;

  &.is-primary {
    background-color: var(--im-color-primary) !important;
    color: var(--im-color-text-on-primary) !important;
    @include im-apply-fading-grid('--im-grid-line-color-for-hero');

    .title,
    .subtitle,
    strong {
      color: var(--im-color-text-on-primary) !important;
    }
    strong {
      font-weight: $im-font-weight-bold !important;
    }

    .field.is-grouped .icon.is-large {
      color: var(--im-color-text-on-primary) !important;
      opacity: 0.8;
      transition: opacity 0.2s ease;
      &:hover {
        opacity: 1;
      }
    }
  }

  .hero-head,
  .hero-body,
  .hero-foot {
    position: relative;
    z-index: 1;
  }
}

// --- Buttons ---
.button {
  font-family: $im-font-primary !important;
  font-weight: $im-font-weight-semibold !important;
  border-radius: $im-border-radius !important;
  padding: 0.7em 1.5em !important;
  transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease !important;
  border-width: 1px !important;
  box-shadow: 0 1px 2px rgba(0,0,0,0.05);

  &:active {
    transform: translateY(1px);
    box-shadow: none;
  }

  &.is-primary {
    background-color: var(--im-color-primary) !important;
    border-color: var(--im-color-primary) !important;
    color: var(--im-color-text-on-primary) !important;
    &:hover {
      background-color: var(--im-color-primary-dark) !important;
      border-color: var(--im-color-primary-dark) !important;
    }
    &:focus, &.is-focused {
      box-shadow: 0 0 0 0.125em rgba(var(--im-color-primary-rgb), 0.25) !important;
    }
  }

  .hero.is-primary & {
    &.is-light {
      &.is-outlined {
        background-color: transparent !important;
        border-color: var(--im-color-text-on-primary) !important;
        color: var(--im-color-text-on-primary) !important;
        &:hover {
          background-color: rgba(255, 255, 255, 0.1) !important;
        }
      }
      &:not(.is-outlined) {
        background-color: var(--im-color-text-on-primary) !important;
        border-color: var(--im-color-text-on-primary) !important;
        color: var(--im-color-primary) !important;
        &:hover {
          background-color: rgba(255, 255, 255, 0.9) !important;
          border-color: rgba(255, 255, 255, 0.9) !important;
        }
      }
    }
  }

  &:not(.hero.is-primary > .hero-body .buttons > &):not(.hero.is-primary > .hero-foot .buttons > &).is-light {
    background-color: var(--im-button-light-bg) !important;
    border-color: var(--im-button-light-border) !important;
    color: var(--im-button-light-text) !important;
    &:hover {
      background-color: var(--im-button-light-hover-bg) !important;
      border-color: var(--im-button-light-hover-border) !important;
    }
  }
}

// --- Box, Card, Panel ---
.box,
.card,
.panel {
  background-color: var(--im-color-surface) !important;
  border-radius: $im-border-radius !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04), 0 2px 4px rgba(0,0,0,0.04) !important;
  border: 1px solid var(--im-color-border) !important;
  color: var(--im-color-text-on-surface) !important;
  transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease, color 0.3s ease;
}

.box {
  padding: $im-content-padding !important;
}

.card {
  padding: 0 !important;
  .card-header {
    box-shadow: none !important;
    border-bottom: 1px solid var(--im-color-border);
    padding: 0.75rem $im-content-padding;
    background-color: transparent !important;
    transition: border-color 0.3s ease;
    .card-header-title {
      color: var(--im-color-text-headings) !important;
      font-weight: $im-font-weight-semibold !important;
      transition: color 0.3s ease;
    }
  }
  .card-content {
    padding: $im-content-padding !important;
    color: var(--im-color-text-on-surface) !important;
    transition: color 0.3s ease;
  }
  .card-footer {
    border-top: 1px solid var(--im-color-border);
    padding: 0.75rem $im-content-padding;
    transition: border-color 0.3s ease;
  }
}

.panel {
  .panel-heading {
    background-color: var(--im-color-surface) !important;
    color: var(--im-color-text-headings) !important;
    border-bottom: 1px solid var(--im-color-border) !important;
    border-top-left-radius: $im-border-radius !important;
    border-top-right-radius: $im-border-radius !important;
    font-weight: $im-font-weight-semibold;
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
  }
  .panel-block, .panel-tabs a {
    border-color: var(--im-color-border) !important;
    color: var(--im-color-text-on-surface) !important;
    transition: border-color 0.3s ease, color 0.3s ease;
    &:hover {
        background-color: rgba(var(--im-color-primary-rgb), 0.05) !important;
    }
  }
  .panel-tabs a.is-active {
    color: var(--im-color-primary) !important;
    border-bottom-color: var(--im-color-primary) !important;
  }
  .panel-icon {
    color: var(--im-color-text-muted) !important;
    transition: color 0.3s ease;
  }
}

// --- Section ---
.section {
  padding: $im-section-padding-vertical 1.5rem !important;
  background-color: transparent !important;
  position: relative;
  overflow: hidden;

  &:not(.hero-body):not(.hero > .section) {
    @include im-apply-fading-grid('--im-grid-line-color-for-section');
  }

  > .container {
    position: relative;
    z-index: 1;
  }
}

// --- Navbar ---
.navbar {
  background-color: var(--im-color-surface) !important;
  box-shadow: 0 2px 4px rgba(0,0,0,0.03) !important;
  transition: background-color 0.3s ease, box-shadow 0.3s ease;

  .navbar-item, .navbar-link {
    color: var(--im-color-text) !important;
    font-weight: $im-font-weight-medium !important;
    transition: color 0.3s ease, background-color 0.3s ease;
    &:hover, &.is-active {
      background-color: transparent !important;
      color: var(--im-color-primary) !important;
    }
    // For the new icon toggle, ensure icon color is appropriate
    &.im-dark-mode-toggle .icon {
        color: var(--im-color-text); // Default icon color
        transition: color 0.3s ease;
    }
    &.im-dark-mode-toggle:hover .icon {
        color: var(--im-color-primary); // Icon color on hover
    }

  }
  .navbar-brand .navbar-item {
    font-weight: $im-font-weight-bold !important;
    color: var(--im-color-text-headings) !important;
  }

  &.is-primary, .hero-head &.is-transparent, .hero-head &.has-background-primary {
    background-color: var(--im-color-primary) !important;
    box-shadow: none !important;
    .navbar-item, .navbar-link {
        color: var(--im-color-text-on-primary) !important;
        &:hover, &.is-active {
            background-color: rgba(255,255,255,0.1) !important;
            color: var(--im-color-text-on-primary) !important;
        }
        // For the new icon toggle in primary navbar
        &.im-dark-mode-toggle .icon {
            color: var(--im-color-text-on-primary);
        }
        &.im-dark-mode-toggle:hover .icon {
            color: var(--im-color-text-on-primary); // Or a slightly lighter/whiter shade if desired
        }
    }
     .navbar-brand .navbar-item {
        color: var(--im-color-text-on-primary) !important;
     }
  }
}

// --- Footer ---
.footer {
  background-color: transparent !important;
  padding: calc(#{$im-spacing-unit} * 3) 1.5rem calc(#{$im-spacing-unit} * 3) !important;
  color: var(--im-color-text-muted) !important;
  border-top: 1px solid var(--im-color-border);
  position: relative;
  z-index: 1;
  transition: color 0.3s ease, border-color 0.3s ease;

  a {
    color: var(--im-color-text) !important;
    font-weight: $im-font-weight-medium !important;
    &:hover {
      color: var(--im-color-primary) !important;
    }
  }
}

// --- Input Fields ---
.input, .textarea, .select select {
  font-family: $im-font-primary !important;
  border-radius: $im-border-radius !important;
  border: 1px solid var(--im-color-input-border) !important;
  box-shadow: none !important;
  background-color: var(--im-color-input-bg) !important;
  color: var(--im-color-text) !important;
  transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;

  &::placeholder {
    color: var(--im-color-text-muted) !important;
    opacity: 0.7;
    transition: color 0.3s ease;
  }

  &:focus, &.is-focused,
  &:active, &.is-active {
    border-color: var(--im-color-primary) !important;
    box-shadow: 0 0 0 0.125em rgba(var(--im-color-primary-rgb), 0.25) !important;
  }
}
.select:not(.is-multiple):not(.is-loading)::after {
  border-color: var(--im-color-primary) !important;
  transition: border-color 0.3s ease;
}


//------------------------------------------------------------------------------
// 7. Dark Mode Styles
//------------------------------------------------------------------------------
html.im-is-dark-mode {
  // Dark Mode Text Colors
  --im-color-text: #CBD5E0;
  --im-color-text-headings: #E2E8F0;
  --im-color-text-muted: #A0AEC0;

  // Dark Mode Background & Surface Colors
  --im-color-background: #1A202C;
  --im-color-surface: #2D3748;
  --im-color-border: #4A5568;
  --im-color-input-bg: var(--im-color-surface);
  --im-color-input-border: var(--im-color-border);
  --im-color-text-on-surface: var(--im-color-text-headings);

  // Dark Mode Button Specifics
  --im-button-light-bg: #4A5568;
  --im-button-light-border: #4A5568;
  --im-button-light-text: var(--im-color-text-headings);
  --im-button-light-hover-bg: #718096;
  --im-button-light-hover-border: #718096;

  // Dark Mode Grid Line Colors
  --im-grid-line-color-for-section: rgba(255, 255, 255, 0.05);
  --im-grid-line-color-for-hero: rgba(255, 255, 255, 0.12);

  // Icon colors for dark mode
  --im-icon-sun-color: #f1c40f; // Sun icon color in dark mode
  --im-icon-moon-color: var(--im-color-text); // Moon icon color (when it's light mode, this var is different)

  // Navbar icon toggle in dark mode
  .navbar .navbar-item.im-dark-mode-toggle .icon {
    color: var(--im-color-text); // Use dark mode text color for icon
  }
  .navbar .navbar-item.im-dark-mode-toggle:hover .icon {
    color: var(--im-color-primary); // Hover remains primary
  }

  .navbar.is-primary .navbar-item.im-dark-mode-toggle .icon,
  .hero-head .navbar.is-transparent .navbar-item.im-dark-mode-toggle .icon,
  .hero-head .navbar.has-background-primary .navbar-item.im-dark-mode-toggle .icon {
    color: var(--im-color-text-on-primary); // Icon on primary bg in dark mode
  }
  // Hover for icon on primary bg in dark mode can remain the same or be adjusted if needed
}

html.im-is-dark-mode {
  .box, .card, .panel {
    box-shadow: 0 6px 15px rgba(0,0,0,0.2), 0 3px 6px rgba(0,0,0,0.15) !important;
  }
}

//------------------------------------------------------------------------------
// 8. Theme Toggle Switch CSS - REMOVED
//------------------------------------------------------------------------------
// This section is no longer needed as the new toggle uses standard navbar item and icon styling.
// The Phosphor icons (ph-sun, ph-moon) will need their own CSS if not using a CDN
// that provides it. The Bulma .icon class handles sizing.
// Color can be controlled via .navbar-item color or specific rules for the icon itself as shown above.