// =============================================================================
// INDEX.SCSS - "IM" THEME FOR BULMA
// =============================================================================
// TABLE OF CONTENTS:
// -----------------------------------------------------------------------------
// 1.  THEME VARIABLES (SCSS)
// 2.  CSS CUSTOM PROPERTIES (:root Defaults)
// 3.  HELPER MIXINS
// 4.  BASE & ELEMENT STYLES
// 5.  BULMA LAYOUT COMPONENT OVERRIDES
// 6.  BULMA ELEMENT OVERRIDES
// 7.  BULMA COMPONENT COLLECTION OVERRIDES
// 8.  BULMA FORM COMPONENT OVERRIDES
// 9.  PAGE SPECIFIC STYLES (Minimal, theming Bulma)
// 10. PAGE TRANSITION ANIMATIONS
// 11. UTILITIES
// 12. DARK MODE STYLES
// 13. PRINT STYLES (Optional)
// =============================================================================


// =============================================================================
// 1. THEME VARIABLES (SCSS)
// =============================================================================
$im-font-primary: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
$im-font-weight-normal: 400;
$im-font-weight-medium: 500;
$im-font-weight-semibold: 600;
$im-font-weight-bold: 700;
$im-base-font-size: 16px;
$im-line-height-base: 1.6;
$im-border-radius: 6px;
$im-spacing-unit: 1rem;
$im-section-padding-vertical: calc(#{$im-spacing-unit} * 2.5);
$im-content-padding: calc(#{$im-spacing-unit} * 1.25);
$im-page-transition-duration: 0.2s;
$im-page-transition-delay: 0.05s;
$im-page-transition-translateY: 10px;
$im-navbar-height: 3rem;
$im-navbar-item-padding-vertical: 0.6rem;
$im-navbar-item-padding-horizontal: 0.8rem;
$im-grid-spacing: 30px; // For fading grid
$im-grid-line-width: 1px; // For fading grid
$im-grid-fade-extent: 65%; // For fading grid


// =============================================================================
// 2. CSS CUSTOM PROPERTIES (:root Defaults)
// =============================================================================
:root {
  // Colors
  --im-color-primary-rgb: 229, 57, 53;
  --im-color-primary: rgb(var(--im-color-primary-rgb));
  --im-color-primary-light: #ef5350;
  --im-color-primary-dark: #c62828;
  --im-color-primary-inverse: #FFFFFF;

  --im-color-text: #2D3748;
  --im-color-text-headings: #1A202C;
  --im-color-text-muted: #718096;
  --im-color-text-on-primary: #FFFFFF;
  --im-color-text-on-surface: var(--im-color-text);

  --im-color-background: #F9FAFB;
  --im-color-surface: #FFFFFF;
  --im-color-surface-alpha: rgba(255, 255, 255, 0.85); // For transparent navbar bg
  --im-color-surface-alt: #F0F2F5;
  --im-color-border-rgb: 226, 232, 240; // For rgba border
  --im-color-border: rgb(var(--im-color-border-rgb)); // #E2E8F0
  --im-color-border-light: #EFF2F7;
  --im-color-border-hover: #D1D9E6;

  --im-color-link: var(--im-color-primary);
  --im-color-link-hover: var(--im-color-primary-dark);

  --im-button-primary-bg: var(--im-color-primary);
  --im-button-primary-border: var(--im-color-primary);
  --im-button-primary-text: var(--im-color-primary-inverse);
  --im-button-primary-hover-bg: var(--im-color-primary-dark);
  --im-button-primary-hover-border: var(--im-color-primary-dark);
  --im-button-light-bg: #FEEBEE;
  --im-button-light-border: #FEEBEE;
  --im-button-light-text: var(--im-color-primary-dark);
  --im-button-light-hover-bg: #FFCDD2;
  --im-button-light-hover-border: #FFCDD2;

  --im-input-bg: var(--im-color-surface);
  --im-input-border: var(--im-color-border);
  --im-input-text: var(--im-color-text);
  --im-input-placeholder-text: var(--im-color-text-muted);
  --im-input-focus-border: var(--im-color-primary);
  --im-input-focus-shadow: rgba(var(--im-color-primary-rgb), 0.25);

  // Sizing & Spacing
  --im-border-radius: #{$im-border-radius};
  --im-spacing-unit: #{$im-spacing-unit};
  --im-content-padding: #{$im-content-padding};
  --im-section-padding-vertical: #{$im-section-padding-vertical};
  --im-navbar-height: #{$im-navbar-height};

  // Fonts
  --im-font-family-sans-serif: #{$im-font-primary};

  // Transitions
  --im-page-transition-duration-css: #{$im-page-transition-duration};

  // Icons
  --im-icon-color: var(--im-color-text-muted);
  --im-icon-color-hover: var(--im-color-primary);

  // Grid Lines (CSS vars for mixin)
  --im-grid-line-color-for-section: rgba(45, 55, 72, 0.06);
  --im-grid-line-color-for-hero: rgba(255, 255, 255, 0.12);
}


// =============================================================================
// 3. HELPER MIXINS
// =============================================================================
@mixin im-apply-fading-grid($line-color-var-name) {
  &::before {
    content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    width: 100%; height: 100%; z-index: 0; pointer-events: none;
    background-image:
      repeating-linear-gradient(to right, var(#{$line-color-var-name}) 0, var(#{$line-color-var-name}) #{$im-grid-line-width}, transparent #{$im-grid-line-width}, transparent #{$im-grid-spacing}),
      repeating-linear-gradient(to bottom, var(#{$line-color-var-name}) 0, var(#{$line-color-var-name}) #{$im-grid-line-width}, transparent #{$im-grid-line-width}, transparent #{$im-grid-spacing});
    background-size: #{$im-grid-spacing} #{$im-grid-spacing};
    background-position: center center;
    mask-image: radial-gradient(ellipse at center, black 0%, black #{$im-grid-fade-extent}, transparent 100%);
    -webkit-mask-image: radial-gradient(ellipse at center, black 0%, black #{$im-grid-fade-extent}, transparent 100%);
  }
}


// =============================================================================
// 4. BASE & ELEMENT STYLES
// =============================================================================
html {
  background-color: var(--im-color-background);
  font-size: $im-base-font-size;
  scroll-behavior: smooth;
  // overflow-y: scroll; // Optional: always show scrollbar to prevent layout shift
}

body {
  font-family: var(--im-font-family-sans-serif);
  color: var(--im-color-text);
  font-weight: $im-font-weight-normal;
  line-height: $im-line-height-base;
  background-color: var(--im-color-background);
  min-height: 100vh;
  font-size: 1rem; // Base for rem units
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  transition: background-color 0.3s ease, color 0.3s ease;

  // Fixed navbar body padding
  &.has-navbar-fixed-top {
      padding-top: var(--im-navbar-height) !important;
  }
}

h1, h2, h3, h4, h5, h6,
.title,
.subtitle {
  font-family: var(--im-font-family-sans-serif);
  color: var(--im-color-text-headings);
  font-weight: $im-font-weight-semibold; // Default for all headings/titles
  transition: color 0.3s ease;
  word-break: break-word; // Prevent overflow
}

.title { // Bulma .title
  font-weight: $im-font-weight-bold !important; // Override for more emphasis
  line-height: 1.2 !important;
  margin-bottom: var(--im-spacing-unit) !important;
}
// Bulma .is-1, .is-2, etc. control size.

.subtitle { // Bulma .subtitle
  color: var(--im-color-text-muted) !important;
  font-weight: $im-font-weight-normal !important;
  line-height: 1.5 !important;
  margin-bottom: calc(var(--im-spacing-unit) * 1.5) !important;
}

p { margin-bottom: var(--im-spacing-unit); }

a {
  color: var(--im-color-link);
  text-decoration: none;
  transition: color 0.2s ease-in-out;
  &:hover { color: var(--im-color-link-hover); }
}

strong, b {
  color: var(--im-color-text-headings);
  font-weight: $im-font-weight-semibold; // Use theme semibold
  transition: color 0.3s ease;
}

hr {
  background-color: var(--im-color-border);
  border: none; height: 1px; margin: var(--im-spacing-unit) 0;
}
hr.is-divider { background-color: var(--im-color-border-light); }


// =============================================================================
// 5. BULMA LAYOUT COMPONENT OVERRIDES
// =============================================================================
.section {
  padding: var(--im-section-padding-vertical) 1.5rem; // Bulma uses 1.5rem horizontal
  // Example of applying grid to all sections except hero and footer
  &:not(.hero):not(.hero .section):not(.footer) {
    position: relative;
    overflow: hidden; // For grid pseudo-element clipping
    // background-color: transparent; // If grid is on body, section should be transparent
    @include im-apply-fading-grid('--im-grid-line-color-for-section');
    > .container, > .columns { // Direct children container/columns above grid
        position: relative;
        z-index: 1;
    }
  }
}

.hero {
  // overflow: hidden; // If applying grid to hero body
  &.is-primary {
    background-color: var(--im-color-primary);
    color: var(--im-color-primary-inverse);
    // Example: if hero itself has the grid, not hero-body
    // position: relative;
    // @include im-apply-fading-grid('--im-grid-line-color-for-hero');
    .title, .subtitle, strong { color: var(--im-color-primary-inverse) !important; }
    .button.is-light {
      background-color: var(--im-color-primary-inverse) !important;
      border-color: var(--im-color-primary-inverse) !important;
      color: var(--im-color-primary) !important;
      &:hover { background-color: rgba(255, 255, 255, 0.9) !important; border-color: rgba(255, 255, 255, 0.9) !important; }
      &.is-outlined {
        background-color: transparent !important; border-color: var(--im-color-primary-inverse) !important; color: var(--im-color-primary-inverse) !important;
        &:hover { background-color: rgba(255, 255, 255, 0.1) !important; }
      }
    }
  }
  .hero-head, .hero-body, .hero-foot {
    position: relative; z-index: 1; // Ensure content above any hero-level grid
  }
}

.footer {
  background-color: var(--im-color-surface-alt);
  color: var(--im-color-text-muted);
  padding: calc(var(--im-spacing-unit) * 2.5) 1.5rem;
  border-top: 1px solid var(--im-color-border);
  font-size: 0.9em; // Slightly smaller footer text
  a { color: var(--im-color-text); font-weight: $im-font-weight-medium;
    &:hover { color: var(--im-color-link-hover); }
  }
}
// .columns, .column, .container, .level are generally fine, styled by global vars & helpers.


// =============================================================================
// 6. BULMA ELEMENT OVERRIDES
// =============================================================================
.button {
  font-family: var(--im-font-family-sans-serif);
  font-weight: $im-font-weight-semibold;
  border-radius: var(--im-border-radius);
  border-width: 1px;
  padding: $im-navbar-item-padding-vertical $im-navbar-item-padding-horizontal; // Use navbar item padding for general buttons too, for consistency
  box-shadow: 0 1px 2px rgba(0,0,0,0.05);
  transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
  &:active { transform: translateY(1px); box-shadow: none; }

  &.is-primary {
    background-color: var(--im-button-primary-bg); border-color: var(--im-button-primary-border); color: var(--im-button-primary-text);
    &:hover { background-color: var(--im-button-primary-hover-bg); border-color: var(--im-button-primary-hover-border); }
    &:focus, &.is-focused { box-shadow: 0 0 0 0.125em var(--im-input-focus-shadow); }
  }
  &.is-light {
    background-color: var(--im-button-light-bg); border-color: var(--im-button-light-border); color: var(--im-button-light-text);
    &:hover { background-color: var(--im-button-light-hover-bg); border-color: var(--im-button-light-hover-border); }
  }
  // &.is-small, &.is-normal, &.is-medium, &.is-large - Bulma handles size
}

.box {
  background-color: var(--im-color-surface);
  border-radius: var(--im-border-radius);
  box-shadow: 0 3px 8px rgba(0,0,0,0.04), 0 1px 3px rgba(0,0,0,0.03);
  border: 1px solid var(--im-color-border-light);
  padding: var(--im-content-padding);
  color: var(--im-color-text-on-surface);
  transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
}

.content {
  p:not(:last-child), ul:not(:last-child), ol:not(:last-child), pre:not(:last-child),
  blockquote:not(:last-child), table:not(:last-child) {
    margin-bottom: var(--im-spacing-unit);
  }
  pre {
    background-color: var(--im-color-surface-alt); border: 1px solid var(--im-color-border);
    border-radius: calc(var(--im-border-radius) * 0.75); padding: var(--im-spacing-unit);
    code { background-color: transparent; color: var(--im-color-text-on-surface); padding: 0; border: none; }
  }
  code:not(pre code) {
    background-color: var(--im-color-surface-alt); border: 1px solid var(--im-color-border-light);
    color: var(--im-color-primary-dark); padding: 0.15em 0.4em;
    border-radius: calc(var(--im-border-radius) * 0.5); font-size: 0.9em;
  }
  blockquote {
    background-color: var(--im-color-surface-alt); border-left: 4px solid var(--im-color-primary);
    padding: var(--im-spacing-unit) var(--im-content-padding); color: var(--im-color-text-muted);
  }
  table { /* Basic table styling */
    td, th { border-color: var(--im-color-border); }
    th { color: var(--im-color-text-headings); }
  }
}

.icon { // Bulma .icon wrapper
  color: var(--im-icon-color);
  i.ph { // Phosphor icons specific adjustments
    vertical-align: -0.125em; // Better vertical alignment for Phosphor
    font-size: 1em; // Ensure it respects .icon size
  }
  // Hover for icon if it's part of a link/button
  a > &.icon:hover, button > &.icon:hover, a:hover > .icon-text > &.icon, button:hover > .icon-text > &.icon {
    color: var(--im-icon-color-hover);
  }
  // Icon text color
  .icon-text {
    color: var(--im-color-text); // Ensure text next to icon is standard text color
    &:hover { color: var(--im-color-link-hover); } // If the icon-text is a link
  }
}

figure.image img { // Images within Bulma's figure.image
  border-radius: var(--im-border-radius);
}

.tag { // Bulma .tag
  border-radius: var(--im-border-radius);
  font-weight: $im-font-weight-medium;
  padding-left: 0.85em; padding-right: 0.85em; // Slightly more padding
  &.is-primary { background-color: var(--im-color-primary); color: var(--im-color-primary-inverse); }
  &.is-light { background-color: var(--im-button-light-bg); color: var(--im-button-light-text); }
}
// .title and .subtitle styling is in section 4.


// =============================================================================
// 7. BULMA COMPONENT COLLECTION OVERRIDES
// =============================================================================
.card {
  background-color: var(--im-color-surface); border-radius: var(--im-border-radius);
  box-shadow: 0 4px 10px rgba(0,0,0,0.05), 0 1px 3px rgba(0,0,0,0.04);
  border: 1px solid var(--im-color-border); color: var(--im-color-text-on-surface);
  transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
  .card-header {
    background-color: transparent; border-bottom: 1px solid var(--im-color-border);
    box-shadow: none; padding: 0.75rem var(--im-content-padding);
    .card-header-title { color: var(--im-color-text-headings); font-weight: $im-font-weight-semibold; }
  }
  .card-image img {
    border-top-left-radius: var(--im-border-radius); border-top-right-radius: var(--im-border-radius);
    border-bottom-left-radius: 0; border-bottom-right-radius: 0;
  }
  .card-content { padding: var(--im-content-padding); }
  .card-footer {
    background-color: transparent; border-top: 1px solid var(--im-color-border);
    padding: 0.75rem var(--im-content-padding);
    a { font-weight: $im-font-weight-medium; }
  }
}

.dropdown {
  .dropdown-menu {
    background-color: var(--im-color-surface); border: 1px solid var(--im-color-border);
    border-radius: var(--im-border-radius); box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    padding-top: 0.25rem; padding-bottom: 0.25rem;
  }
  .dropdown-item, .dropdown-link {
    color: var(--im-color-text); padding: 0.5rem 1rem; font-size: 0.95em;
    &:hover { background-color: var(--im-color-surface-alt); color: var(--im-color-primary); }
    &.is-active { background-color: var(--im-color-primary); color: var(--im-color-primary-inverse); }
  }
  .dropdown-divider { background-color: var(--im-color-border-light); }
}

// .media object styling is generally fine.

.navbar {
  min-height: var(--im-navbar-height) !important;
  background-color: var(--im-color-surface-alpha) !important;
  backdrop-filter: blur(8px) saturate(160%); // Slightly less intense blur
  -webkit-backdrop-filter: blur(8px) saturate(160%);
  border-bottom: 1px solid rgba(var(--im-color-border-rgb), 0.3); // Softer transparent border
  transition: background-color 0.3s ease, border-color 0.3s ease;

  .navbar-brand {
    min-height: var(--im-navbar-height);
    .navbar-item { padding-top: 0; padding-bottom: 0; display:flex; align-items:center; }
  }
  .navbar-menu {
    @include touch {
      background-color: var(--im-color-surface);
      box-shadow: 0 8px 16px rgba(10, 10, 10, 0.1);
      padding: 0.5rem 0;
      border-bottom-left-radius: var(--im-border-radius);
      border-bottom-right-radius: var(--im-border-radius);
      border: 1px solid var(--im-color-border); border-top: none;
    }
  }
  .navbar-item, .navbar-link {
    color: var(--im-color-text) !important;
    font-weight: $im-font-weight-medium !important;
    padding: $im-navbar-item-padding-vertical $im-navbar-item-padding-horizontal !important;
    min-height: var(--im-navbar-height);
    display: flex; align-items: center; position: relative;
    transition: color 0.2s ease, background-color 0.2s ease; // background transition might not be needed for transparent
    &:hover, &.is-hovered {
      background-color: transparent !important; color: var(--im-color-primary) !important;
      .icon i.ph { color: var(--im-color-primary) !important; }
    }
    &.is-active-nav-item {
      color: var(--im-color-primary) !important; font-weight: $im-font-weight-semibold !important;
      background-color: transparent !important;
      .icon i.ph { color: var(--im-color-primary) !important; }
      &::after {
        content: ''; position: absolute; bottom: 4px; left: 50%; transform: translateX(-50%);
        width: 0; height: 0; border-left: 5px solid transparent;
        border-right: 5px solid transparent; border-bottom: 5px solid var(--im-color-primary);
      }
    }
  }
  .navbar-link::after { border-color: var(--im-color-text-muted) !important; right: $im-navbar-item-padding-horizontal * 0.7; }
  .navbar-link:hover::after, .navbar-link.is-active-nav-item::after { border-color: var(--im-color-primary) !important; }

  .navbar-dropdown {
    background-color: var(--im-color-surface) !important; border: 1px solid var(--im-color-border) !important;
    border-top: none !important; // Usually dropdowns connect seamlessly
    border-radius: 0 0 var(--im-border-radius) var(--im-border-radius) !important;
    box-shadow: 0 6px 12px rgba(10, 10, 10, 0.1) !important;
    padding-top: 0.25rem !important; padding-bottom: 0.25rem !important;
    font-size: 0.9em;
    .navbar-item {
      padding: calc(#{$im-navbar-item-padding-vertical} * 0.85) calc(#{$im-navbar-item-padding-horizontal} * 1.1) !important;
      min-height: auto;
      &:hover { background-color: var(--im-color-surface-alt) !important; color: var(--im-color-primary) !important;}
      &.is-active-nav-item {
        background-color: rgba(var(--im-color-primary-rgb), 0.08) !important;
        color: var(--im-color-primary-dark) !important; font-weight: $im-font-weight-medium !important;
        &::after { display: none; }
      }
    }
  }
  .im-logo-link {
    .im-logo-image { max-height: calc(var(--im-navbar-height) * 0.55); margin-right: 0.5rem; }
    .im-logo-text { font-size: 1.05rem; color: var(--im-color-text-headings); font-weight: $im-font-weight-bold;}
  }
  .im-nav-icon { margin-right: 0.4em; i.ph { font-size: 1.1em; } }
  .im-nav-image-icon { max-height: 1.1rem; margin-right: 0.4em; &.is-small { max-height: 0.9rem; } }
  .navbar-brand .navbar-item.is-hidden-desktop { padding-left: 0.4rem; padding-right: 0.4rem; }
  .im-navbar-mobile-action .icon i.ph, .im-dark-mode-toggle .icon i.ph { color: var(--im-color-text-muted); }
  .im-navbar-mobile-action:hover .icon i.ph, .im-dark-mode-toggle:hover .icon i.ph { color: var(--im-color-primary); }
}

.panel {
  border-radius: var(--im-border-radius); border: 1px solid var(--im-color-border);
  background-color: var(--im-color-surface);
  .panel-heading {
    background-color: var(--im-color-surface-alt); color: var(--im-color-text-headings);
    font-weight: $im-font-weight-semibold; border-bottom: 1px solid var(--im-color-border);
    border-top-left-radius: var(--im-border-radius); border-top-right-radius: var(--im-border-radius);
  }
  .panel-tabs a {
    color: var(--im-color-text-muted);
    &.is-active { color: var(--im-color-primary); border-bottom-color: var(--im-color-primary); }
  }
  .panel-block {
    color: var(--im-color-text-on-surface); border-bottom: 1px solid var(--im-color-border-light);
    padding: 0.75em var(--im-content-padding); // Consistent padding
    &:last-child { border-bottom: none; }
    &:hover { background-color: var(--im-color-surface-alt); }
    .panel-icon { color: var(--im-color-text-muted); }
  }
}


// =============================================================================
// 8. BULMA FORM COMPONENT OVERRIDES
// =============================================================================
.input, .textarea, .select select {
  font-family: var(--im-font-family-sans-serif); border-radius: var(--im-border-radius);
  border: 1px solid var(--im-input-border); box-shadow: none;
  background-color: var(--im-input-bg); color: var(--im-input-text);
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
  padding: 0.6em 0.9em; // Slightly adjusted padding for inputs
  &::placeholder { color: var(--im-input-placeholder-text); opacity: 0.7; }
  &:hover { border-color: var(--im-color-border-hover); }
  &:focus, &.is-focused, &:active, &.is-active {
    border-color: var(--im-input-focus-border) !important;
    box-shadow: 0 0 0 0.125em var(--im-input-focus-shadow) !important;
  }
}
.textarea { line-height: $im-line-height-base; } // Ensure textarea line height is good
.select:not(.is-multiple):not(.is-loading)::after { border-color: var(--im-color-primary); }
// .label, .help, .control styling can be added if needed for forms


// =============================================================================
// 9. PAGE SPECIFIC STYLES (Minimal, theming Bulma classes within page scopes)
// =============================================================================
// Example:
// .im-video-page { /* Styles specific to video page, mostly theming Bulma elements */
//   .title.is-3 { /* ... */ }
//   .panel { /* ... */ }
// }


// =============================================================================
// 10. PAGE TRANSITION ANIMATIONS
// =============================================================================
body.im-page-is-loading { opacity: 1; } // No initial fade-in if animation is off
body.im-page-is-entering {
  // animation: imPageFadeInUp $im-page-transition-duration forwards ease-out;
  // animation-delay: $im-page-transition-delay;
  opacity: 1;
}
body.im-page-is-exiting {
  animation: imPageFadeOutDown $im-page-transition-duration forwards ease-in !important;
}
// @keyframes imPageFadeInUp { /* ... */ } // Keep if you might re-enable
@keyframes imPageFadeOutDown {
  from { opacity: 1; transform: translateY(0); }
  to   { opacity: 0; transform: translateY($im-page-transition-translateY); }
}


// =============================================================================
// 11. UTILITIES
// =============================================================================
// Example:
// .im-is-hidden { display: none !important; }


// =============================================================================
// 12. DARK MODE STYLES
// =============================================================================
html.im-is-dark-mode {
  // CSS Custom Property Overrides for Dark Mode
  --im-color-primary-inverse: var(--im-color-text-headings); // Text on primary might need to be darker text
  --im-color-text: #CBD5E0;
  --im-color-text-headings: #E2E8F0;
  --im-color-text-muted: #A0AEC0;
  --im-color-background: #171C23; // Slightly darker background
  --im-color-surface: #202731;    // Slightly darker surface
  --im-color-surface-alpha: rgba(32, 39, 49, 0.85); // Dark transparent navbar bg
  --im-color-surface-alt: #252E3D;
  --im-color-border-rgb: 74, 85, 104; // For rgba border
  --im-color-border: rgb(var(--im-color-border-rgb)); // #4A5568
  --im-color-border-light: #3E4C5F;
  --im-color-border-hover: #5A6B81;
  --im-color-link: var(--im-color-primary-light);
  --im-color-link-hover: var(--im-color-primary);
  --im-button-primary-hover-bg: var(--im-color-primary-light);
  --im-button-primary-hover-border: var(--im-color-primary-light);
  --im-button-light-bg: #4A5568;
  --im-button-light-border: #4A5568;
  --im-button-light-text: var(--im-color-text-headings);
  --im-button-light-hover-bg: #5A6B81;
  --im-button-light-hover-border: #5A6B81;
  --im-input-bg: var(--im-color-surface);
  --im-input-border: var(--im-color-border);
  --im-input-text: var(--im-color-text-on-surface);
  --im-input-placeholder-text: var(--im-color-text-muted);
  --im-icon-color: var(--im-color-text-muted);
  --im-icon-color-hover: var(--im-color-primary-light);
  --im-grid-line-color-for-section: rgba(255, 255, 255, 0.04); // Even more subtle grid

  // Specific Component Dark Mode Adjustments
  .box { box-shadow: 0 5px 15px rgba(0,0,0,0.25), 0 2px 6px rgba(0,0,0,0.2); border-color: var(--im-color-border); }
  .card { box-shadow: 0 6px 18px rgba(0,0,0,0.28), 0 2px 8px rgba(0,0,0,0.22); border-color: var(--im-color-border); }

  .navbar { // Dark mode navbar
    border-bottom-color: rgba(var(--im-color-border-rgb), 0.3); // Softer transparent border
  }
  .navbar .navbar-menu {
    @include touch {
        background-color: var(--im-color-surface); // Solid bg for open mobile menu
        box-shadow: 0 8px 16px rgba(0,0,0,0.35);
        border-color: var(--im-color-border);
    }
  }
  .navbar .navbar-dropdown {
     background-color: var(--im-color-surface) !important;
     border-color: var(--im-color-border) !important;
     box-shadow: 0 6px 12px rgba(0,0,0,0.3) !important;
     .navbar-item:hover {
        background-color: var(--im-color-surface-alt) !important;
     }
     .navbar-item.is-active-nav-item {
         background-color: rgba(var(--im-color-primary-rgb), 0.2) !important;
         color: var(--im-color-primary-light) !important;
     }
  }
  .navbar .im-dark-mode-toggle .icon i.ph,
  .navbar .im-navbar-mobile-action .icon i.ph { // Ensure mobile icons also use dark mode colors
    color: var(--im-color-text-muted);
    &:hover { color: var(--im-color-primary-light); }
  }

  .content pre { background-color: #252E3D; border-color: var(--im-color-border); }
  .content code:not(pre code) { background-color: #3E4C5F; border-color: #4A5568; color: var(--im-color-primary-light); }
  .content blockquote { background-color: var(--im-color-surface-alt); border-left-color: var(--im-color-primary-light); }
}

// =============================================================================
// 13. PRINT STYLES (Optional)
// =============================================================================
// @media print { /* ... */ }