// =============================================================================
// INDEX.SCSS - "IM" THEME FOR BULMA (Comprehensive Light Mode)
// =============================================================================
// TABLE OF CONTENTS:
// 1.  THEME VARIABLES (SCSS)
// 2.  CSS CUSTOM PROPERTIES (:root Defaults)
// 3.  HELPER MIXINS (im-apply-fading-grid)
// 4.  BASE & ELEMENT STYLES (html, body, typography, links, hr)
// 5.  BULMA LAYOUT COMPONENT OVERRIDES (section, hero, footer, columns, container, level)
// 6.  BULMA ELEMENT OVERRIDES (button, box, content, icon, image, notification, progress, table, tag, title)
// 7.  BULMA COMPONENT COLLECTION OVERRIDES (breadcrumb, card, dropdown, menu, message, modal, navbar, pagination, panel, tabs)
// 8.  BULMA FORM COMPONENT OVERRIDES (input, textarea, select, checkbox, radio, file, label, help, field)
// 9.  PAGE SPECIFIC STYLES (Minimal, for demonstration if needed)
// 10. PAGE TRANSITION ANIMATIONS (Load animation off, exit on)
// 11. UTILITIES (e.g., .im-has-grid and its modifiers)
// =============================================================================


// =============================================================================
// 1. THEME VARIABLES (SCSS)
// =============================================================================
$im-font-primary: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
$im-font-weight-normal: 400;
$im-font-weight-medium: 500;
$im-font-weight-semibold: 600;
$im-font-weight-bold: 700;

$im-base-font-size: 16px;
$im-line-height-base: 1.6;

$im-border-radius: 6px;
$im-spacing-unit: 1rem;

$im-section-padding-vertical: calc(#{$im-spacing-unit} * 2.5);
$im-content-padding: calc(#{$im-spacing-unit} * 1.25);

$im-page-transition-duration: 0.2s;
$im-page-transition-delay: 0.05s;
$im-page-transition-translateY: 10px;

$im-navbar-height: 3.5rem;
$im-navbar-item-padding-vertical: 0.75rem;
$im-navbar-item-padding-horizontal: 1rem;
$im-navbar-scroll-transition-duration: 0.3s;

$im-grid-line-width: 1px !default;
$im-grid-default-spacing: 30px !default;
$im-grid-default-fade-extent: 70% !default; // Slightly more fade for subtlety
$im-grid-default-color-var: '--im-color-grid-lines-default';


// =============================================================================
// 2. CSS CUSTOM PROPERTIES (:root Defaults - LIGHT MODE)
// =============================================================================
:root {
  // --- Colors ---
  --im-color-primary-rgb: 229, 57, 53;
  --im-color-primary: rgb(var(--im-color-primary-rgb));
  --im-color-primary-light: #ef5350;
  --im-color-primary-dark: #c62828;
  --im-color-primary-inverse: #FFFFFF;

  --im-color-text: #2D3748;
  --im-color-text-headings: #1A202C;
  --im-color-text-muted: #718096;
  --im-color-text-on-primary: #FFFFFF;
  --im-color-text-on-surface: var(--im-color-text);

  --im-color-background: #F9FAFB;
  --im-color-surface: #FFFFFF;
  --im-navbar-bg-transparent: rgba(255, 255, 255, 0.65); // Initial transparent navbar
  --im-navbar-bg-scrolled: rgba(255, 255, 255, 0.9);  // Navbar when scrolled
  --im-navbar-border-transparent: rgba(var(--im-color-border-rgb, 226, 232, 240), 0.0);
  --im-navbar-border-scrolled: rgba(var(--im-color-border-rgb, 226, 232, 240), 0.5);
  --im-color-surface-alt: #F0F2F5;

  --im-color-border-rgb: 226, 232, 240;
  --im-color-border: rgb(var(--im-color-border-rgb));
  --im-color-border-light: #EFF2F7;
  --im-color-border-hover: #D1D9E6;

  --im-color-link: var(--im-color-primary);
  --im-color-link-hover: var(--im-color-primary-dark);

  --im-button-primary-bg: var(--im-color-primary);
  --im-button-primary-border: var(--im-color-primary);
  --im-button-primary-text: var(--im-color-primary-inverse);
  --im-button-primary-hover-bg: var(--im-color-primary-dark);
  --im-button-primary-hover-border: var(--im-color-primary-dark);
  --im-button-light-bg: #FEEBEE;
  --im-button-light-border: #FEEBEE;
  --im-button-light-text: var(--im-color-primary-dark);
  --im-button-light-hover-bg: #FFCDD2;
  --im-button-light-hover-border: #FFCDD2;

  --im-input-bg: var(--im-color-surface);
  --im-input-border: var(--im-color-border);
  --im-input-text: var(--im-color-text);
  --im-input-placeholder-text: var(--im-color-text-muted);
  --im-input-focus-border: var(--im-color-primary);
  --im-input-focus-shadow: rgba(var(--im-color-primary-rgb), 0.25);

  // --- Sizing & Spacing ---
  --im-border-radius: #{$im-border-radius};
  --im-spacing-unit: #{$im-spacing-unit};
  --im-content-padding: #{$im-content-padding};
  --im-section-padding-vertical: #{$im-section-padding-vertical};
  --im-navbar-height: #{$im-navbar-height};
  --im-navbar-scroll-transition-duration: #{$im-navbar-scroll-transition-duration};

  // --- Fonts ---
  --im-font-family-sans-serif: #{$im-font-primary};

  // --- Transitions ---
  --im-page-transition-duration-css: #{$im-page-transition-duration};

  // --- Icons ---
  --im-icon-color: var(--im-color-text-muted);
  --im-icon-color-hover: var(--im-color-primary);

  // --- Grid Lines ---
  --im-color-grid-lines-default: rgba(var(--im-color-border-rgb), 0.5); // Default for components
  --im-color-grid-lines-section: rgba(45, 55, 72, 0.05); // Subtle for page sections
  --im-color-grid-lines-hero: rgba(255, 255, 255, 0.08); // Light for primary hero
  --im-color-grid-lines-primary: rgba(var(--im-color-primary-rgb), 0.2); // Primary tinted
  --im-color-grid-lines-light: rgba(255, 255, 255, 0.3); // For dark components needing light grid
  --im-color-grid-lines-dark: rgba(0, 0, 0, 0.05);      // For light components needing dark grid
}


// =============================================================================
// 3. HELPER MIXINS
// =============================================================================
@mixin im-apply-fading-grid($line-color-var-name, $spacing-var-name: '--current-grid-spacing', $fade-var-name: '--current-grid-fade-extent') {
  &::before {
    content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    width: 100%; height: 100%; z-index: -1; pointer-events: none; // z-index -1 for components
    border-radius: inherit; // Inherit border-radius

    --current-grid-spacing-val: var(#{$spacing-var-name}, #{$im-grid-default-spacing});
    --current-grid-fade-val: var(#{$fade-var-name}, #{$im-grid-default-fade-extent});
    --current-grid-line-color-val: var(#{$line-color-var-name});

    background-image:
      repeating-linear-gradient(to right, var(--current-grid-line-color-val) 0, var(--current-grid-line-color-val) #{$im-grid-line-width}, transparent #{$im-grid-line-width}, transparent var(--current-grid-spacing-val)),
      repeating-linear-gradient(to bottom, var(--current-grid-line-color-val) 0, var(--current-grid-line-color-val) #{$im-grid-line-width}, transparent #{$im-grid-line-width}, transparent var(--current-grid-spacing-val));
    background-size: var(--current-grid-spacing-val) var(--current-grid-spacing-val);
    background-position: center center;
    mask-image: radial-gradient(ellipse at center, black 0%, black var(--current-grid-fade-val), transparent 100%);
    -webkit-mask-image: radial-gradient(ellipse at center, black 0%, black var(--current-grid-fade-val), transparent 100%);
  }
}


// =============================================================================
// 4. BASE & ELEMENT STYLES
// =============================================================================
html { /* ... (same as your last correct version) ... */ }
body { /* ... (same as your last correct version, including fixed navbar padding) ... */ }
h1, h2, h3, h4, h5, h6, .title, .subtitle { /* ... */ }
.title { /* ... */ }
.subtitle { /* ... */ }
p { /* ... */ }
a { /* ... */ }
strong, b { /* ... */ }
hr, hr.is-divider { /* ... */ }
// --- Main content area wrapper to handle dynamic padding for fixed-scrolling navbar ---
.im-main-content-area {
    padding-top: var(--im-navbar-height);
    transition: padding-top var(--im-navbar-scroll-transition-duration) ease-out;
}

// =============================================================================
// 5. BULMA LAYOUT COMPONENT OVERRIDES
// =============================================================================
.section {
  padding: var(--im-section-padding-vertical) 1.5rem;
  position: relative; // For pseudo-elements like grid or other decorations
  // Default grid for all sections not inside a hero or footer
  &:not(.hero):not(.hero .section):not(.footer) {
    overflow: hidden; // Recommended if applying grid directly
    @include im-apply-fading-grid('--im-color-grid-lines-section');
    > .container, > .columns, > * { // Ensure direct children are above grid
        position: relative;
        z-index: 1;
    }
  }
}

.hero {
  &.is-primary {
    background-color: var(--im-color-primary);
    color: var(--im-color-primary-inverse);
    // If hero itself gets a grid:
    // position: relative;
    // @include im-apply-fading-grid('--im-color-grid-lines-hero');
    .title, .subtitle, strong { color: var(--im-color-primary-inverse) !important; }
    .button.is-light { /* ... (same as your last correct version) ... */ }
  }
  .hero-body {
    padding: var(--im-section-padding-vertical) 1.5rem; // Consistent padding
  }
  .hero-head, .hero-body, .hero-foot { position: relative; z-index: 1; }
}

.footer { /* ... (same as your last correct version) ... */ }
// .columns, .column, .container, .level - use Bulma defaults, styled by base vars


// =============================================================================
// 6. BULMA ELEMENT OVERRIDES
// =============================================================================
.button { /* ... (same as your last correct version, ensure padding uses SCSS vars) ... */
  padding: $im-navbar-item-padding-vertical $im-navbar-item-padding-horizontal;
}
.box { /* ... (same as your last correct version) ... */ }
.content { /* ... (same as your last correct version) ... */ }
.icon { /* ... (same as your last correct version) ... */ }
figure.image img { border-radius: var(--im-border-radius); } // Keep this
// .notification, .progress, .table
.tag { /* ... (same as your last correct version) ... */ }
// .title, .subtitle are in Base Styles

// Example: Table styling
.table {
  background-color: var(--im-color-surface);
  color: var(--im-color-text-on-surface);
  th {
    color: var(--im-color-text-headings);
    border-color: var(--im-color-border-light); // Lighter border for header cells
  }
  td {
    border-color: var(--im-color-border);
  }
  &.is-striped tbody tr:not(.is-selected):nth-child(even) {
    background-color: var(--im-color-surface-alt);
  }
  &.is-hoverable tbody tr:not(.is-selected):hover {
    background-color: var(--im-color-border-light); // Subtle hover
  }
}


// =============================================================================
// 7. BULMA COMPONENT COLLECTION OVERRIDES
// =============================================================================
// .breadcrumb (Style if used)
.card { /* ... (same as your last correct version) ... */ }
.dropdown { /* ... (same as your last correct version) ... */ }
// .menu (Style if used, .menu-list a, .menu-label)
// .message (Style if used, .message-header, .message-body)
// .modal (Style if used, .modal-card, .modal-background)

.navbar.im-navbar-custom { // Target your custom class for navbar
  min-height: var(--im-navbar-height) !important;
  background-color: var(--im-navbar-bg-transparent) !important;
  backdrop-filter: blur(8px) saturate(160%);
  -webkit-backdrop-filter: blur(8px) saturate(160%);
  border-bottom: 1px solid var(--im-navbar-border-transparent);
  transition: transform var(--im-navbar-scroll-transition-duration) ease-out,
              background-color var(--im-navbar-scroll-transition-duration) ease-out,
              border-color var(--im-navbar-scroll-transition-duration) ease-out,
              box-shadow var(--im-navbar-scroll-transition-duration) ease-out;
  position: fixed; top: 0; left: 0; right: 0; z-index: 1030;

  &.is-visible {
    transform: translateY(0%);
    background-color: var(--im-navbar-bg-scrolled) !important;
    border-bottom-color: var(--im-navbar-border-scrolled);
    box-shadow: 0 1px 3px rgba(0,0,0,0.04);
  }
  &.is-hidden-scroll { transform: translateY(-100%); }

  .navbar-brand {
    min-height: var(--im-navbar-height);
    .navbar-item { padding-top: 0; padding-bottom: 0; display:flex; align-items:center; }
  }
  .navbar-menu {
    @media screen and (max-width: 1023px) { // Bulma $desktop - 1px
      &.is-active {
        background-color: var(--im-color-surface);
        box-shadow: 0 8px 16px rgba(10, 10, 10, 0.1);
        padding: 0.5rem 0;
        border-bottom-left-radius: var(--im-border-radius);
        border-bottom-right-radius: var(--im-border-radius);
        border: 1px solid var(--im-color-border); border-top: none;
        position: absolute; left: 0; right: 0; top: 100%; z-index: 20;
      }
    }
  }
  .navbar-item, .navbar-link {
    color: var(--im-color-text) !important;
    font-weight: $im-font-weight-medium !important;
    padding: $im-navbar-item-padding-vertical $im-navbar-item-padding-horizontal !important;
    min-height: var(--im-navbar-height);
    display: flex; align-items: center; position: relative;
    transition: color 0.2s ease; // Only color for transparent bg performance
    .icon i.ph { transition: color 0.2s ease; } // Transition icon color too

    &:hover, &.is-hovered {
      background-color: transparent !important; color: var(--im-color-primary) !important;
      .icon i.ph { color: var(--im-color-primary) !important; }
    }
    &.is-active-nav-item {
      color: var(--im-color-primary) !important; font-weight: $im-font-weight-semibold !important;
      background-color: transparent !important;
      .icon i.ph { color: var(--im-color-primary) !important; }
      &::after {
        content: ''; position: absolute; bottom: 4px; left: 50%; transform: translateX(-50%);
        width: 0; height: 0; border-left: 5px solid transparent;
        border-right: 5px solid transparent; border-bottom: 5px solid var(--im-color-primary);
      }
    }
  }
  .navbar-link::after { border-color: var(--im-color-text-muted) !important; right: $im-navbar-item-padding-horizontal * 0.7; }
  .navbar-link:hover::after, .navbar-link.is-active-nav-item::after { border-color: var(--im-color-primary) !important; }

  .navbar-dropdown { /* ... (same as your last correct version, ensure colors use CSS vars) ... */ }
  .im-logo-link { /* ... (same as your last correct version) ... */ }
  .im-nav-icon { /* ... */ } .im-nav-image-icon { /* ... */ }
  .navbar-brand .navbar-item.is-hidden-desktop { margin-left:auto; }
  .im-navbar-mobile-action, .im-dark-mode-toggle {
    .icon i.ph { color: var(--im-color-text-muted); }
    &:hover .icon i.ph { color: var(--im-color-primary); }
  }
}

.panel { /* ... (same as your last correct version, ensure padding uses $im-content-padding) ... */ }
// .pagination, .tabs styling if used


// =============================================================================
// 8. BULMA FORM COMPONENT OVERRIDES
// =============================================================================
.input, .textarea, .select select { /* ... (same as your last correct version with --im-color-border-hover) ... */ }
.label { color: var(--im-color-text-headings); font-weight: $im-font-weight-semibold; }
.help { color: var(--im-color-text-muted); font-size: 0.875em; }
// .field, .control styling is mostly layout by Bulma


// =============================================================================
// 9. PAGE SPECIFIC STYLES
// =============================================================================
// Example:
// .im-video-page { /* Video page specific theming of Bulma classes */ }


// =============================================================================
// 10. PAGE TRANSITION ANIMATIONS
// =============================================================================
body.im-page-is-loading { opacity: 1; }
body.im-page-is-entering { opacity: 1; } // Animation removed
body.im-page-is-exiting {
  animation: imPageFadeOutDown $im-page-transition-duration forwards ease-in !important;
}
@keyframes imPageFadeOutDown {
  from { opacity: 1; transform: translateY(0); }
  to   { opacity: 0; transform: translateY($im-page-transition-translateY); }
}


// =============================================================================
// 11. UTILITIES (Includes .im-has-grid and modifiers from _grid.scss)
// =============================================================================
// --- Component Grid Utilities ---
.im-has-grid {
  position: relative; z-index: 0;
  &::before {
    content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    width: 100%; height: 100%; z-index: -1; pointer-events: none;
    border-radius: inherit;
    --current-grid-spacing: #{$im-grid-default-spacing};
    --current-grid-line-width: #{$im-grid-line-width}; // Use global SCSS var
    --current-grid-fade-extent: #{$im-grid-default-fade-extent};
    --current-grid-line-color: var(#{$im-grid-default-color-var});

    background-image:
      repeating-linear-gradient(to right, var(--current-grid-line-color) 0, var(--current-grid-line-color) var(--current-grid-line-width), transparent var(--current-grid-line-width), transparent var(--current-grid-spacing)),
      repeating-linear-gradient(to bottom, var(--current-grid-line-color) 0, var(--current-grid-line-color) var(--current-grid-line-width), transparent var(--current-grid-line-width), transparent var(--current-grid-spacing));
    background-size: var(--current-grid-spacing) var(--current-grid-spacing);
    background-position: center center;
    mask-image: radial-gradient(ellipse at center, black 0%, black var(--current-grid-fade-extent), transparent 100%);
    -webkit-mask-image: radial-gradient(ellipse at center, black 0%, black var(--current-grid-fade-extent), transparent 100%);
  }
  // Corner accent pseudo-elements
  &::after, & > *:first-child::before, & > *:first-child::after { // Using first child for remaining corners
    content: ''; position: absolute;
    width: 8px; height: 8px; // Size of corner accents
    z-index: 0; // Above ::before grid, but below actual content
    pointer-events: none;
    border-radius: 2px; // Slightly rounded corners for the accents
  }
  // Top-left
  &::before { // Re-purposing ::before for grid, so we need another way or different pseudo for corners
    // This ::before IS the grid. The corner accents need different pseudos or be on child.
  }
  // Top-right (on child or different pseudo)
  // For simplicity, I'll assume the corner effects are more of an artistic touch
  // and might be applied to specific elements rather than globally with im-has-grid,
  // as combining them with the ::before grid and border-radius inheritance is complex.
  // The _grid.scss partial focused solely on this.
  // If you want them on *every* .im-has-grid, we'd need to add more pseudo-elements,
  // potentially to a wrapper div inside the .im-has-grid element.
}

// Spacing modifiers for .im-has-grid
&.is-grid-tiny::before { --current-grid-spacing: 10px; }
&.is-grid-small::before { --current-grid-spacing: 15px; }
// .is-grid-medium uses default
&.is-grid-large::before { --current-grid-spacing: 45px; }

// Color modifiers for .im-has-grid
&.is-grid-primary::before { --current-grid-line-color: var(--im-color-grid-lines-primary); }
&.is-grid-light::before { --current-grid-line-color: var(--im-color-grid-lines-light); }
&.is-grid-dark::before { --current-grid-line-color: var(--im-color-grid-lines-dark); }

// Fade modifiers for .im-has-grid
&.is-grid-fade-none::before { mask-image: none; -webkit-mask-image: none; }
&.is-grid-fade-subtle::before { --current-grid-fade-extent: 85%; }
&.is-grid-fade-tight::before { --current-grid-fade-extent: 45%; }


// =============================================================================
// 12. DARK MODE STYLES (LIGHT MODE FOCUS - This will be expanded later)
// =============================================================================
// html.im-is-dark-mode {
//   // Redefine CSS Custom Properties for dark theme
//   --im-color-text: #CBD5E0;
//   --im-color-text-headings: #E2E8F0;
//   // ... and so on for all relevant variables
//
//   // Specific component adjustments for dark mode
//   .box { /* ... */ }
//   .navbar.im-navbar-custom {
//       background-color: var(--im-navbar-bg-transparent) !important; // Uses dark mode version of this var
//       border-bottom-color: var(--im-navbar-border-transparent);
//       &.is-visible {
//           background-color: var(--im-navbar-bg-scrolled) !important;
//           border-bottom-color: var(--im-navbar-border-scrolled);
//       }
//   }
//   // ... etc.
// }
// For now, dark mode section is minimal. We'll fill this in based on light mode styles.


// =============================================================================
// 13. PRINT STYLES (Optional)
// =============================================================================
// @media print { /* ... */ }