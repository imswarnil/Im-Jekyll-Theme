// =============================================================================
// INDEX.SCSS - "IM" THEME FOR BULMA
// =============================================================================
// TABLE OF CONTENTS:
// 1.  THEME VARIABLES
// 2.  CSS CUSTOM PROPERTIES
// 3.  HELPER MIXINS
// 4.  BASE & ELEMENT STYLES
// 5.  BULMA COMPONENT OVERRIDES
//     5.1. Layout (Section, Hero, Footer)
//     5.2. Elements (Button, Box, Content, Icon, Image, Tag, Title)
//     5.3. Components (Card, Dropdown, Media, Navbar, Panel)
//     5.4. Form (Input, Textarea, Select)
// 6.  PAGE TRANSITION ANIMATIONS (MODIFIED)
// 7.  UTILITIES
// 8.  DARK MODE STYLES
// =============================================================================

// =============================================================================
// 1. THEME VARIABLES
// =============================================================================
$im-font-primary: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
$im-font-weight-normal: 400;
$im-font-weight-medium: 500;
$im-font-weight-semibold: 600;
$im-font-weight-bold: 700;
$im-base-font-size: 16px; // Or 15px for slightly smaller overall
$im-line-height-base: 1.6; // Slightly tighter
$im-border-radius: 6px; // Slightly smaller radius
$im-spacing-unit: 1rem;
$im-section-padding-vertical: calc(#{$im-spacing-unit} * 2.5); // Reduced
$im-content-padding: calc(#{$im-spacing-unit} * 1.25); // Reduced
$im-page-transition-duration: 0.2s;
$im-page-transition-delay: 0.05s;
$im-page-transition-translateY: 10px; // Reduced
// Navbar Specific Variables
$im-navbar-height: 3rem; // Reduced navbar height (Bulma default is 3.25rem)
$im-navbar-item-padding-vertical: 0.6rem; // Reduced
$im-navbar-item-padding-horizontal: 0.8rem; // Reduced

// =============================================================================
// 2. CSS CUSTOM PROPERTIES
// =============================================================================
:root {
  --im-color-primary-rgb: 229, 57, 53;
  --im-color-primary: rgb(var(--im-color-primary-rgb));
  --im-color-primary-light: #ef5350;
  --im-color-primary-dark: #c62828;
  --im-color-primary-inverse: #FFFFFF;

  --im-color-text: #2D3748;
  --im-color-text-headings: #1A202C;
  --im-color-text-muted: #718096;
  --im-color-text-on-primary: #FFFFFF;
  --im-color-text-on-surface: var(--im-color-text);

  --im-color-background: #F9FAFB;
  --im-color-surface: #FFFFFF;
  --im-color-surface-alpha: rgba(255, 255, 255, 0.85); // For transparent navbar bg with blur
  --im-color-surface-alt: #F0F2F5;
  --im-color-border: #E2E8F0;
  --im-color-border-light: #EFF2F7;
  --im-color-border-hover: #D1D9E6;

  --im-color-link: var(--im-color-primary);
  --im-color-link-hover: var(--im-color-primary-dark);

  --im-button-primary-bg: var(--im-color-primary);
  --im-button-primary-border: var(--im-color-primary);
  --im-button-primary-text: var(--im-color-primary-inverse);
  --im-button-primary-hover-bg: var(--im-color-primary-dark);
  --im-button-primary-hover-border: var(--im-color-primary-dark);
  --im-button-light-bg: #FEEBEE;
  --im-button-light-border: #FEEBEE;
  --im-button-light-text: var(--im-color-primary-dark);
  --im-button-light-hover-bg: #FFCDD2;
  --im-button-light-hover-border: #FFCDD2;

  --im-input-bg: var(--im-color-surface);
  --im-input-border: var(--im-color-border);
  --im-input-text: var(--im-color-text);
  --im-input-placeholder-text: var(--im-color-text-muted);
  --im-input-focus-border: var(--im-color-primary);
  --im-input-focus-shadow: rgba(var(--im-color-primary-rgb), 0.25);

  --im-border-radius: #{$im-border-radius};
  --im-spacing-unit: #{$im-spacing-unit};
  --im-content-padding: #{$im-content-padding};
  --im-section-padding-vertical: #{$im-section-padding-vertical};
  --im-font-family-sans-serif: #{$im-font-primary};
  --im-page-transition-duration-css: #{$im-page-transition-duration};
  --im-icon-color: var(--im-color-text-muted);
  --im-icon-color-hover: var(--im-color-primary);

  --im-navbar-height: #{$im-navbar-height}; // Make SCSS var available to CSS
}

// =============================================================================
// 3. HELPER MIXINS (Keep as is)
// =============================================================================
@mixin im-apply-fading-grid($line-color-var-name) { /* ... */ }

// =============================================================================
// 4. BASE & ELEMENT STYLES (Adjusted for potentially smaller base font/line height)
// =============================================================================
html {
  background-color: var(--im-color-background);
  font-size: $im-base-font-size;
  scroll-behavior: smooth;
  &.has-navbar-fixed-top {
    // Bulma adds padding to body. If body has 100vh, this can cause scroll.
    // This ensures html/body take up correct space.
    // overflow-y: scroll; // Or auto, depends on if you always want scrollbar
  }
}

body {
  font-family: var(--im-font-family-sans-serif);
  color: var(--im-color-text);
  font-weight: $im-font-weight-normal;
  line-height: $im-line-height-base;
  background-color: var(--im-color-background);
  min-height: 100vh;
  transition: background-color 0.3s ease, color 0.3s ease;
  font-size: 1rem; // Ensure body inherits html font-size for rem calculations
  &.has-navbar-fixed-top { // This is Bulma's class on body when html has it
      padding-top: var(--im-navbar-height) !important; // Crucial: Override Bulma if our navbar height is different
  }
}
// ... (rest of h1-h6, p, a, strong, hr styles can remain similar, adjust font-sizes if $im-base-font-size changed)
h1, h2, h3, h4, h5, h6,
.title,
.subtitle {
  font-family: var(--im-font-family-sans-serif);
  color: var(--im-color-text-headings);
  font-weight: $im-font-weight-semibold;
  transition: color 0.3s ease;
}
.title { font-weight: $im-font-weight-bold !important; line-height: 1.2 !important; margin-bottom: var(--im-spacing-unit) !important; }
.subtitle { color: var(--im-color-text-muted) !important; font-weight: $im-font-weight-normal !important; line-height: 1.5 !important; margin-bottom: calc(var(--im-spacing-unit) * 1.5) !important; }
p { margin-bottom: var(--im-spacing-unit); }
a { color: var(--im-color-link); text-decoration: none; transition: color 0.2s ease-in-out; &:hover { color: var(--im-color-link-hover); } }
strong, b { color: var(--im-color-text-headings); font-weight: $im-font-weight-semibold; transition: color 0.3s ease; }
hr { background-color: var(--im-color-border); border: none; height: 1px; margin: var(--im-spacing-unit) 0; }
hr.is-divider { background-color: var(--im-color-border-light); }


// =============================================================================
// 5. BULMA COMPONENT OVERRIDES
// =============================================================================
// ... (Button, Box, Card, Panel, Form elements - adjust padding/font-sizes if $im-base-font-size changed)
// Example for .box to reflect reduced content padding
.box {
  padding: var(--im-content-padding) !important; // Use new smaller padding
  // other .box styles from before
  background-color: var(--im-color-surface);
  border-radius: var(--im-border-radius);
  box-shadow: 0 3px 8px rgba(0,0,0,0.04), 0 1px 3px rgba(0,0,0,0.03);
  border: 1px solid var(--im-color-border-light);
  color: var(--im-color-text-on-surface);
  transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
}
// Apply similar reductions to .card-content, .panel-block etc. if desired.

// 5.3. Components (Navbar specific focus)
// -----------------------------------------------------------------------------
.navbar {
  min-height: var(--im-navbar-height) !important; // Set fixed height
  // Transparent Navbar with Subtle Blur & Bottom Border
  background-color: var(--im-color-surface-alpha) !important; // Use semi-transparent white
  backdrop-filter: blur(10px) saturate(180%); // Modern blur effect
  -webkit-backdrop-filter: blur(10px) saturate(180%);
  border-bottom: 1px solid rgba(var(--im-color-border-rgb, 226, 232, 240), 0.5); // Semi-transparent border
  transition: background-color 0.3s ease, box-shadow 0.3s ease;

  // No need for .has-shadow-navbar if we always have a border or a very subtle fixed shadow.
  // If you want a shadow only on scroll, that requires JS.
  // For a constant subtle shadow with transparency:
  // box-shadow: 0 1px 2px rgba(0,0,0,0.03);


  &.is-fixed-top {
    // Bulma handles position:fixed, top:0, left:0, right:0, z-index:30
    // We ensure our custom height is respected by body padding (see body styles)
  }

  .navbar-brand {
    min-height: var(--im-navbar-height); // Ensure brand area matches navbar height
    .navbar-item { // For logo and mobile icons
      padding-top: 0;
      padding-bottom: 0;
      display:flex;
      align-items:center;
    }
  }

  .navbar-menu {
    @include touch { // Bulma mixin for mobile
      background-color: var(--im-color-surface); // Solid background for open mobile menu
      box-shadow: 0 8px 16px rgba(10, 10, 10, 0.1);
      padding: 0.5rem 0;
      border-bottom-left-radius: var(--im-border-radius);
      border-bottom-right-radius: var(--im-border-radius);
    }
  }

  .navbar-item, .navbar-link {
    color: var(--im-color-text) !important;
    font-weight: $im-font-weight-medium !important;
    padding: $im-navbar-item-padding-vertical $im-navbar-item-padding-horizontal !important; // Reduced padding
    min-height: var(--im-navbar-height); // Ensure items fill height for clickability
    display: flex; // For vertical centering of icon and text
    align-items: center; // Vertical centering
    transition: color 0.2s ease, background-color 0.2s ease;
    position: relative; // For the triangle indicator

    &:hover, &.is-hovered {
      background-color: transparent !important; // Keep transparent on hover for main items
      color: var(--im-color-primary) !important;
      .icon i.ph { // Change icon color on item hover
         color: var(--im-color-primary) !important;
      }
    }

    &.is-active-nav-item {
      color: var(--im-color-primary) !important;
      font-weight: $im-font-weight-semibold !important;
      background-color: transparent !important;

      .icon i.ph { // Active icon color
         color: var(--im-color-primary) !important;
      }

      // Triangle Indicator
      &::after {
        content: '';
        position: absolute;
        bottom: 0px; // Adjust to sit on the very bottom or slightly above
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 6px solid transparent; // Triangle size
        border-right: 6px solid transparent;
        border-bottom: 6px solid var(--im-color-primary); // Triangle color and direction
      }
    }
  }
  .navbar-link { // For dropdown toggles
    &::after { // Bulma's arrow
      border-color: var(--im-color-text-muted) !important; // Muted arrow
      right: $im-navbar-item-padding-horizontal * 0.8; // Adjust arrow position
    }
    &:hover::after, &.is-active-nav-item::after {
        border-color: var(--im-color-primary) !important;
    }
  }

  .navbar-dropdown {
    background-color: var(--im-color-surface) !important; // Solid background for dropdown
    border: 1px solid var(--im-color-border) !important;
    border-top: 1px solid var(--im-color-border) !important; // Consistent border
    border-radius: 0 0 var(--im-border-radius) var(--im-border-radius) !important;
    box-shadow: 0 8px 16px rgba(10, 10, 10, 0.1) !important;
    padding-top: 0.25rem !important; padding-bottom: 0.25rem !important;
    font-size: 0.9em; // Slightly smaller dropdown text
    .navbar-item {
      padding: calc(#{$im-navbar-item-padding-vertical} * 0.9) calc(#{$im-navbar-item-padding-horizontal} * 1.2) !important; // Adjusted padding
      min-height: auto; // Reset min-height for dropdown items
      &:hover {
        background-color: var(--im-color-surface-alt) !important;
        color: var(--im-color-primary) !important;
      }
      &.is-active-nav-item {
        background-color: rgba(var(--im-color-primary-rgb), 0.1) !important;
        color: var(--im-color-primary-dark) !important;
        font-weight: $im-font-weight-medium !important;
        &::after { display: none; } // No triangle in dropdown
      }
    }
  }

  .im-logo-link {
    .im-logo-image { max-height: calc(var(--im-navbar-height) * 0.6); /* Scale with navbar height */ margin-right: 0.5rem; }
    .im-logo-text { font-size: 1.1rem; color: var(--im-color-text-headings); }
  }
  .im-nav-icon { margin-right: 0.4em; i.ph { font-size: 1.1em; } } // Slightly smaller icons
  .im-nav-image-icon { max-height: 1.1rem; margin-right: 0.4em; &.is-small { max-height: 0.9rem; } }

  // Mobile specific icons in navbar-brand (Search, Theme Toggle)
  .navbar-brand .navbar-item.is-hidden-desktop {
    padding-left: 0.5rem;
    padding-right: 0.5rem;
  }
  .im-navbar-mobile-search, .im-dark-mode-toggle { // Common styling for mobile icons
      .icon i.ph { color: var(--im-color-text-muted); }
      &:hover .icon i.ph { color: var(--im-color-primary); }
  }
}

// =============================================================================
// 6. PAGE TRANSITION ANIMATIONS (MODIFIED)
// =============================================================================
body.im-page-is-loading { opacity: 1; } // No fade-in on load if animation is removed
body.im-page-is-entering {
  // animation: imPageFadeInUp $im-page-transition-duration forwards ease-out; // Commented out
  // animation-delay: $im-page-transition-delay;
  opacity: 1; // Ensure visible if animation is off
}
body.im-page-is-exiting {
  animation: imPageFadeOutDown $im-page-transition-duration forwards ease-in !important;
}
// @keyframes imPageFadeInUp { ... } // Can be kept or removed if not used
@keyframes imPageFadeOutDown {
  from { opacity: 1; transform: translateY(0); }
  to   { opacity: 0; transform: translateY($im-page-transition-translateY); }
}

// =============================================================================
// 7. UTILITIES (Keep as is)
// =============================================================================

// =============================================================================
// 8. DARK MODE STYLES
// =============================================================================
:root { // For --im-color-border-rgb definition
    --im-color-border-rgb: 226, 232, 240; // Corresponds to #E2E8F0
}
html.im-is-dark-mode {
  --im-color-primary-inverse: var(--im-color-text);
  --im-color-text: #CBD5E0;
  --im-color-text-headings: #E2E8F0;
  --im-color-text-muted: #A0AEC0;
  --im-color-background: #1A202C;
  --im-color-surface: #2D3748;
  --im-color-surface-alpha: rgba(45, 55, 72, 0.85); // Dark transparent navbar bg
  --im-color-surface-alt: #252E3D;
  --im-color-border: #4A5568;
  --im-color-border-rgb: 74, 85, 104; // Corresponds to #4A5568
  --im-color-border-light: #3E4C5F;
  --im-color-border-hover: #5A6B81;
  --im-color-link: var(--im-color-primary-light);
  --im-color-link-hover: var(--im-color-primary);
  --im-button-primary-hover-bg: var(--im-color-primary-light);
  --im-button-primary-hover-border: var(--im-color-primary-light);
  --im-button-light-bg: #4A5568;
  --im-button-light-border: #4A5568;
  --im-button-light-text: var(--im-color-text-headings);
  --im-button-light-hover-bg: #5A6B81;
  --im-button-light-hover-border: #5A6B81;
  --im-input-bg: var(--im-color-surface);
  --im-input-border: var(--im-color-border);
  --im-input-text: var(--im-color-text-on-surface);
  --im-input-placeholder-text: var(--im-color-text-muted);
  --im-icon-color: var(--im-color-text-muted);
  --im-icon-color-hover: var(--im-color-primary-light);

  .navbar { // Dark mode specific for navbar
    border-bottom-color: rgba(var(--im-color-border-rgb), 0.5);
    // box-shadow: 0 1px 2px rgba(0,0,0,0.15); // Darker subtle shadow
  }
  .navbar .navbar-menu { // Mobile open menu
    @include touch {
        background-color: var(--im-color-surface);
        box-shadow: 0 8px 16px rgba(0,0,0,0.3);
    }
  }
  .navbar .navbar-dropdown {
     background-color: var(--im-color-surface) !important;
     border-color: var(--im-color-border) !important;
     box-shadow: 0 8px 16px rgba(0,0,0,0.3) !important;
     .navbar-item:hover {
        background-color: var(--im-color-surface-alt) !important;
     }
     .navbar-item.is-active-nav-item {
         background-color: rgba(var(--im-color-primary-rgb), 0.2) !important; // Darker tint
         color: var(--im-color-primary-light) !important;
     }
  }
  .navbar .im-dark-mode-toggle .icon i.ph {
    color: var(--im-color-text-muted);
    &:hover { color: var(--im-color-primary-light); }
  }
  // ... (rest of dark mode overrides for .box, .card, .content etc. from your previous version)
  .box { box-shadow: 0 5px 15px rgba(0,0,0,0.2), 0 2px 6px rgba(0,0,0,0.15); border-color: var(--im-color-border); }
  .card { box-shadow: 0 6px 18px rgba(0,0,0,0.22), 0 2px 8px rgba(0,0,0,0.18); border-color: var(--im-color-border); }
  .content pre { background-color: #252E3D; border-color: var(--im-color-border); }
  .content code:not(pre code) { background-color: #3E4C5F; border-color: #4A5568; color: var(--im-color-primary-light); }
  .content blockquote { background-color: var(--im-color-surface-alt); border-left-color: var(--im-color-primary-light); }
}