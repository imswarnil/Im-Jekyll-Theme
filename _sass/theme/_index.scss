// index.scss - Single File SCSS for "IM" Themed Bulma Overrides

//------------------------------------------------------------------------------
// 1. SCSS Variables (im- prefix)
//------------------------------------------------------------------------------

// Font
$im-font-primary: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
$im-font-weight-normal: 400;
$im-font-weight-medium: 500;
$im-font-weight-semibold: 600;
$im-font-weight-bold: 700;
$im-base-font-size: 16px;
$im-line-height-base: 1.65;

// Sizing & Spacing
$im-border-radius: 6px; // Slightly more subtle radius
$im-spacing-unit: 1rem;
$im-section-padding-vertical: calc(#{$im-spacing-unit} * 3.5); // Adjusted
$im-content-padding: calc(#{$im-spacing-unit} * 1.5); // For .box, .card, .panel content

// Page Transition
$im-page-transition-duration: 0.3s; // Faster
$im-page-transition-timing-function: cubic-bezier(0.25, 0.8, 0.25, 1); // Smoother ease-out like
$im-page-transition-delay: 0.05s; // Shorter delay
$im-page-transition-translateY: 15px; // Less travel

// Grid Lines
$im-grid-spacing: 28px; // Slightly adjusted
$im-grid-line-width: 1px;
$im-grid-fade-extent: 70%; // More central visibility

//------------------------------------------------------------------------------
// 2. CSS Custom Properties for Theming (:root for Light Mode Defaults)
//------------------------------------------------------------------------------
:root {
  // Primary Colors (Red Theme)
  --im-color-primary-rgb: 229, 57, 53; // #e53935
  --im-color-primary: rgb(var(--im-color-primary-rgb));
  --im-color-primary-light: #ef5350;
  --im-color-primary-dark: #c62828;
  --im-color-primary-inverted: #FFFFFF; // Text on primary

  // Contextual Colors - Light Mode
  --im-color-link: #3273dc; // Bulma's default link
  --im-color-info: #209cee;
  --im-color-success: #23d160;
  --im-color-warning: #ffdd57;
  --im-color-danger: #ff3860;

  --im-color-link-inverted: #FFFFFF;
  --im-color-info-inverted: #FFFFFF;
  --im-color-success-inverted: #FFFFFF;
  --im-color-warning-inverted: rgba(0,0,0,0.7); // Dark text on yellow
  --im-color-danger-inverted: #FFFFFF;

  // Text Colors - Light Mode
  --im-color-text: #363636; // Bulma's default text
  --im-color-text-light: #7a7a7a; // Lighter text
  --im-color-text-strong: #363636;
  --im-color-text-headings: #222; // Slightly darker than body
  --im-color-text-muted: #999; // For less important text, placeholders
  --im-color-text-on-surface: var(--im-color-text);

  // Background & Surface Colors - Light Mode
  --im-color-background: #f5f5f5; // Bulma's light grey
  --im-color-surface: #FFFFFF; // For cards, boxes, navbar, panel
  --im-color-border: #dbdbdb; // Bulma's default border
  --im-color-border-light: #ededed; // Lighter border
  --im-color-border-hover: #b5b5b5;
  --im-color-input-bg: var(--im-color-surface);
  --im-color-input-border: var(--im-color-border);
  --im-color-input-shadow: rgba(var(--im-color-primary-rgb), 0.25);
  --im-color-table-row-hover: #f9f9f9;
  --im-color-code-background: #f0f0f0;
  --im-color-pre-background: var(--im-color-code-background);
  --im-color-pre-text: #4a4a4a;

  // Button Specifics - Light Mode
  --im-button-light-bg: #f0f0f0; // Lighter gray
  --im-button-light-border: #f0f0f0;
  --im-button-light-text: var(--im-color-text);
  --im-button-light-hover-bg: #e6e6e6;
  --im-button-light-hover-border: #e6e6e6;

  // Grid Line Colors - Light Mode
  --im-grid-line-color-for-section: rgba(0, 0, 0, 0.05); // Subtle dark
  --im-grid-line-color-for-hero: rgba(255, 255, 255, 0.1); // Subtle light

  // Toggle
  --im-dark-mode-toggle-icon-color: var(--im-color-text);
}

//------------------------------------------------------------------------------
// 3. Mixins
//------------------------------------------------------------------------------

@mixin im-apply-fading-grid($line-color-var-name) {
  &::before {
    content: "";
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    width: 100%; height: 100%;
    z-index: 0;
    background-image:
      repeating-linear-gradient(to right, var(#{$line-color-var-name}) 0, var(#{$line-color-var-name}) $im-grid-line-width, transparent $im-grid-line-width, transparent $im-grid-spacing),
      repeating-linear-gradient(to bottom, var(#{$line-color-var-name}) 0, var(#{$line-color-var-name}) $im-grid-line-width, transparent $im-grid-line-width, transparent $im-grid-spacing);
    background-size: $im-grid-spacing $im-grid-spacing;
    background-position: center center;
    mask-image: radial-gradient(ellipse at center, black 0%, black $im-grid-fade-extent, transparent 100%);
    -webkit-mask-image: radial-gradient(ellipse at center, black 0%, black $im-grid-fade-extent, transparent 100%);
    pointer-events: none;
  }
}

//------------------------------------------------------------------------------
// 4. Animations (Page Transitions)
//------------------------------------------------------------------------------

@keyframes imPageFadeIn { // Simpler fade
  from { opacity: 0; transform: translateY($im-page-transition-translateY); }
  to   { opacity: 1; transform: translateY(0); }
}

@keyframes imPageFadeOut { // Simpler fade
  from { opacity: 1; transform: translateY(0); }
  to   { opacity: 0; transform: translateY(-$im-page-transition-translateY); } // Exit upwards
}

//------------------------------------------------------------------------------
// 5. Base Styles (HTML, Body, Typography)
//------------------------------------------------------------------------------

html {
  background-color: var(--im-color-background) !important;
  scroll-behavior: smooth;
  font-size: $im-base-font-size;
}

body {
  font-family: $im-font-primary !important;
  color: var(--im-color-text) !important;
  font-weight: $im-font-weight-normal !important;
  line-height: $im-line-height-base !important;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background-color: var(--im-color-background) !important;
  min-height: 100vh;
  transition: background-color $im-page-transition-duration var(--im-page-transition-timing-function), color $im-page-transition-duration var(--im-page-transition-timing-function);

  &.im-page-is-loading { opacity: 0; }
  &.im-page-is-entering { animation: imPageFadeIn $im-page-transition-duration var(--im-page-transition-timing-function) forwards; animation-delay: $im-page-transition-delay; }
  &.im-page-is-exiting  { animation: imPageFadeOut $im-page-transition-duration var(--im-page-transition-timing-function) forwards !important; }
}

h1, h2, h3, h4, h5, h6,
.title,
.subtitle {
  font-family: $im-font-primary !important;
  color: var(--im-color-text-headings) !important;
  transition: color $im-page-transition-duration var(--im-page-transition-timing-function);
}

.title {
  font-weight: $im-font-weight-bold !important;
  line-height: 1.2 !important;
  margin-bottom: calc(#{$im-spacing-unit} * 1) !important;
  &.is-1 { font-size: 2.5rem !important; } // Adjusted
  &.is-2 { font-size: 2rem !important; }
  &.is-3 { font-size: 1.75rem !important; }
}

.subtitle {
  color: var(--im-color-text-light) !important; // Use lighter text for subtitles
  font-weight: $im-font-weight-normal !important;
  line-height: 1.5 !important;
  margin-bottom: calc(#{$im-spacing-unit} * 1.5) !important;
  &.is-3 { font-size: 1.25rem !important; }
  &.is-4 { font-size: 1.1rem !important; }
}

p {
  margin-bottom: $im-spacing-unit !important;
}

a {
  color: var(--im-color-link) !important; // Use Bulma's link color var
  text-decoration: none !important;
  transition: color 0.2s ease-in-out, opacity 0.2s ease-in-out;
  &:hover {
    color: darken(var(--im-color-link), 10%) !important;
  }
}

strong, b {
  color: var(--im-color-text-strong) !important;
  font-weight: $im-font-weight-bold !important; // Bulma default for strong
  transition: color $im-page-transition-duration var(--im-page-transition-timing-function);
}

code {
  background-color: var(--im-color-code-background);
  color: var(--im-color-danger);
  padding: 0.25em 0.5em;
  border-radius: $im-border-radius * 0.5;
  font-size: 0.875em;
}
pre {
  background-color: var(--im-color-pre-background);
  color: var(--im-color-pre-text);
  padding: $im-spacing-unit * 1.25;
  border-radius: $im-border-radius;
  code {
    background-color: transparent;
    color: inherit;
    padding: 0;
  }
}

hr {
    background-color: var(--im-color-border-light) !important;
    height: 1px !important;
    margin: $im-spacing-unit * 1.5 0 !important;
}

//------------------------------------------------------------------------------
// 6. Component Overrides
//------------------------------------------------------------------------------

// --- Hero Section (WITH GRID LINES) ---
.hero {
  position: relative;
  overflow: hidden;
  transition: background-color $im-page-transition-duration var(--im-page-transition-timing-function);

  &.is-primary {
    background-color: var(--im-color-primary) !important;
    color: var(--im-color-primary-inverted) !important;
    @include im-apply-fading-grid('--im-grid-line-color-for-hero');
    .title, .subtitle, strong { color: var(--im-color-primary-inverted) !important; }
    strong { font-weight: $im-font-weight-bold !important; }
    .field.is-grouped .icon.is-large { color: var(--im-color-primary-inverted) !important; opacity: 0.8; &:hover{ opacity:1;}}
  }
  // Contextual Heroes
  &.is-link { background-color: var(--im-color-link) !important; color: var(--im-color-link-inverted) !important; .title, .subtitle, strong{ color: var(--im-color-link-inverted) !important;}}
  &.is-info { background-color: var(--im-color-info) !important; color: var(--im-color-info-inverted) !important; .title, .subtitle, strong{ color: var(--im-color-info-inverted) !important;}}
  &.is-success { background-color: var(--im-color-success) !important; color: var(--im-color-success-inverted) !important; .title, .subtitle, strong{ color: var(--im-color-success-inverted) !important;}}
  &.is-warning { background-color: var(--im-color-warning) !important; color: var(--im-color-warning-inverted) !important; .title, .subtitle, strong{ color: var(--im-color-warning-inverted) !important;}}
  &.is-danger { background-color: var(--im-color-danger) !important; color: var(--im-color-danger-inverted) !important; .title, .subtitle, strong{ color: var(--im-color-danger-inverted) !important;}}

  .hero-head, .hero-body, .hero-foot { position: relative; z-index: 1; }
}

// --- Buttons ---
.button {
  font-family: $im-font-primary !important;
  font-weight: $im-font-weight-semibold !important;
  border-radius: $im-border-radius !important;
  padding: 0.6em 1.2em !important; // Slightly less padding
  transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease !important;
  border-width: 1px !important;

  &:active { transform: translateY(1px); box-shadow: none; }

  // Contextual Buttons
  &.is-primary { background-color: var(--im-color-primary) !important; border-color: var(--im-color-primary) !important; color: var(--im-color-primary-inverted) !important; &:hover{ background-color:var(--im-color-primary-dark) !important; border-color:var(--im-color-primary-dark) !important;} &:focus,&.is-focused{box-shadow:0 0 0 0.125em var(--im-color-input-shadow) !important;}}
  &.is-link    { background-color: var(--im-color-link)    !important; border-color: var(--im-color-link)    !important; color: var(--im-color-link-inverted)    !important; &:hover{ background-color:darken(var(--im-color-link),5%)    !important; border-color:darken(var(--im-color-link),5%)    !important;} &:focus,&.is-focused{box-shadow:0 0 0 0.125em rgba(var(--im-color-link),0.25) !important;}} // TODO: RGB for link
  &.is-info    { background-color: var(--im-color-info)    !important; border-color: var(--im-color-info)    !important; color: var(--im-color-info-inverted)    !important; &:hover{ background-color:darken(var(--im-color-info),5%)    !important; border-color:darken(var(--im-color-info),5%)    !important;} &:focus,&.is-focused{box-shadow:0 0 0 0.125em rgba(var(--im-color-info),0.25) !important;}} // TODO: RGB for info
  &.is-success { background-color: var(--im-color-success) !important; border-color: var(--im-color-success) !important; color: var(--im-color-success-inverted) !important; &:hover{ background-color:darken(var(--im-color-success),5%) !important; border-color:darken(var(--im-color-success),5%) !important;} &:focus,&.is-focused{box-shadow:0 0 0 0.125em rgba(var(--im-color-success),0.25) !important;}} // TODO: RGB for success
  &.is-warning { background-color: var(--im-color-warning) !important; border-color: var(--im-color-warning) !important; color: var(--im-color-warning-inverted) !important; &:hover{ background-color:darken(var(--im-color-warning),5%) !important; border-color:darken(var(--im-color-warning),5%) !important;} &:focus,&.is-focused{box-shadow:0 0 0 0.125em rgba(var(--im-color-warning),0.25) !important;}} // TODO: RGB for warning
  &.is-danger  { background-color: var(--im-color-danger)  !important; border-color: var(--im-color-danger)  !important; color: var(--im-color-danger-inverted)  !important; &:hover{ background-color:darken(var(--im-color-danger),5%)  !important; border-color:darken(var(--im-color-danger),5%)  !important;} &:focus,&.is-focused{box-shadow:0 0 0 0.125em rgba(var(--im-color-danger),0.25) !important;}} // TODO: RGB for danger

  .hero.is-primary &.is-light {
    &.is-outlined { background-color:transparent !important; border-color:var(--im-color-primary-inverted) !important; color:var(--im-color-primary-inverted) !important; &:hover{background-color:rgba(255,255,255,0.1)!important;}}
    &:not(.is-outlined) { background-color:var(--im-color-primary-inverted) !important; border-color:var(--im-color-primary-inverted) !important; color:var(--im-color-primary) !important; &:hover{background-color:rgba(255,255,255,0.9)!important; border-color:rgba(255,255,255,0.9)!important;}}
  }
  &.is-light { background-color:var(--im-button-light-bg)!important; border-color:var(--im-button-light-border)!important; color:var(--im-button-light-text)!important; &:hover{background-color:var(--im-button-light-hover-bg)!important; border-color:var(--im-button-light-hover-border)!important;}}
  &.is-white   { border-color: transparent !important; color: var(--im-color-text)!important; &:hover, &:focus { background-color: var(--im-color-background)!important; border-color: transparent!important; color: var(--im-color-text)!important;}}
  &.is-black   { background-color: #0a0a0a!important; border-color:transparent!important; color:#fff!important; &:hover, &:focus { background-color: #000!important; border-color:transparent!important; color:#fff!important;}}
  &.is-ghost   { border-color: transparent!important; color: var(--im-color-link)!important; text-decoration: none!important; &:hover {color:var(--im-color-link)!important; text-decoration:underline!important;}}
}

// --- Box, Card, Panel (NO GRID LINES) ---
.box, .card, .panel {
  background-color: var(--im-color-surface) !important;
  border-radius: $im-border-radius !important;
  box-shadow: 0 0.5em 1em -0.125em rgba(10,10,10,.1), 0 0px 0 1px rgba(10,10,10,.02) !important; // Bulma's default shadow
  border: 1px solid var(--im-color-border) !important;
  color: var(--im-color-text-on-surface) !important;
  transition: background-color $im-page-transition-duration var(--im-page-transition-timing-function), border-color $im-page-transition-duration var(--im-page-transition-timing-function), box-shadow $im-page-transition-duration var(--im-page-transition-timing-function), color $im-page-transition-duration var(--im-page-transition-timing-function);
}
.box { padding: $im-content-padding !important; }
.card {
  padding: 0 !important;
  .card-header { box-shadow:none!important; border-bottom:1px solid var(--im-color-border); padding:0.75rem $im-content-padding; background-color:transparent!important; transition:border-color $im-page-transition-duration var(--im-page-transition-timing-function); .card-header-title{color:var(--im-color-text-headings)!important;font-weight:$im-font-weight-semibold!important;transition:color $im-page-transition-duration var(--im-page-transition-timing-function);}}
  .card-content{ padding:$im-content-padding!important; color:var(--im-color-text-on-surface)!important; transition:color $im-page-transition-duration var(--im-page-transition-timing-function);}
  .card-footer { border-top:1px solid var(--im-color-border); padding:0.75rem $im-content-padding; transition:border-color $im-page-transition-duration var(--im-page-transition-timing-function); }
  .card-image img { border-top-left-radius: $im-border-radius; border-top-right-radius: $im-border-radius; } // If image is first
}
.panel {
  .panel-heading { background-color:var(--im-color-surface)!important; color:var(--im-color-text-headings)!important; border-bottom:1px solid var(--im-color-border)!important; border-top-left-radius:$im-border-radius!important; border-top-right-radius:$im-border-radius!important; font-weight:$im-font-weight-semibold; transition:background-color $im-page-transition-duration var(--im-page-transition-timing-function),color $im-page-transition-duration var(--im-page-transition-timing-function),border-color $im-page-transition-duration var(--im-page-transition-timing-function);}
  .panel-block, .panel-tabs a { border-color:var(--im-color-border)!important; color:var(--im-color-text-on-surface)!important; transition:border-color $im-page-transition-duration var(--im-page-transition-timing-function),color $im-page-transition-duration var(--im-page-transition-timing-function); &:hover{background-color:rgba(var(--im-color-primary-rgb),0.05)!important;}}
  .panel-tabs a.is-active { color:var(--im-color-primary)!important; border-bottom-color:var(--im-color-primary)!important;}
  .panel-icon { color:var(--im-color-text-muted)!important; transition:color $im-page-transition-duration var(--im-page-transition-timing-function);}
}

// --- Section (WITH GRID LINES) ---
.section {
  padding: $im-section-padding-vertical 1.5rem !important;
  background-color: transparent !important;
  position: relative; overflow: hidden;
  &:not(.hero-body):not(.hero > .section) { @include im-apply-fading-grid('--im-grid-line-color-for-section'); }
  > .container { position: relative; z-index: 1; }
}

// --- Navbar ---
.navbar {
  background-color: var(--im-color-surface) !important;
  box-shadow: 0 2px 0 0 var(--im-color-background) !important; // Bulma's subtle bottom border
  min-height: 3.25rem;
  transition: background-color $im-page-transition-duration var(--im-page-transition-timing-function), box-shadow $im-page-transition-duration var(--im-page-transition-timing-function);
  .navbar-item, .navbar-link { color:var(--im-color-text)!important; font-weight:$im-font-weight-medium!important; transition:color $im-page-transition-duration var(--im-page-transition-timing-function),background-color $im-page-transition-duration var(--im-page-transition-timing-function); &:hover,&.is-active{background-color:transparent!important; color:var(--im-color-primary)!important;}}
  .navbar-brand .navbar-item { font-weight:$im-font-weight-bold!important; color:var(--im-color-text-headings)!important;}
  .navbar-burger { color:var(--im-color-text)!important; span{background-color:var(--im-color-text)!important; transition:background-color $im-page-transition-duration var(--im-page-transition-timing-function);}}
  &.is-primary, .hero-head &.is-transparent, .hero-head &.has-background-primary {
    background-color:var(--im-color-primary)!important; box-shadow:none!important;
    .navbar-item,.navbar-link{color:var(--im-color-primary-inverted)!important;&:hover,&.is-active{background-color:rgba(255,255,255,0.1)!important;color:var(--im-color-primary-inverted)!important;}}
    .navbar-brand .navbar-item{color:var(--im-color-primary-inverted)!important;}
    .navbar-burger{color:var(--im-color-primary-inverted)!important; span{background-color:var(--im-color-primary-inverted)!important;}}
  }
}

// --- Footer ---
.footer {
  background-color: var(--im-color-background)!important; // Footer often has a bg
  padding: calc(#{$im-spacing-unit} * 2.5) 1.5rem calc(#{$im-spacing-unit} * 2.5) !important;
  color: var(--im-color-text-light) !important;
  border-top: 1px solid var(--im-color-border-light);
  transition: color $im-page-transition-duration var(--im-page-transition-timing-function), border-color $im-page-transition-duration var(--im-page-transition-timing-function), background-color $im-page-transition-duration var(--im-page-transition-timing-function);
  a {color:var(--im-color-text)!important; font-weight:$im-font-weight-medium!important; &:hover{color:var(--im-color-primary)!important;}}
}

// --- Input Fields & Forms ---
.input, .textarea, .select select {
  font-family: $im-font-primary !important;
  border-radius: $im-border-radius !important;
  border: 1px solid var(--im-color-input-border) !important;
  box-shadow: inset 0 0.0625em 0.125em rgba(10,10,10,.05) !important; // Bulma's subtle inset
  background-color: var(--im-color-input-bg) !important;
  color: var(--im-color-text) !important;
  transition: background-color $im-page-transition-duration var(--im-page-transition-timing-function), border-color $im-page-transition-duration var(--im-page-transition-timing-function), color $im-page-transition-duration var(--im-page-transition-timing-function), box-shadow $im-page-transition-duration var(--im-page-transition-timing-function);
  &::placeholder {color:var(--im-color-text-muted)!important; opacity:0.7; transition:color $im-page-transition-duration var(--im-page-transition-timing-function);}
  &:hover { border-color: var(--im-color-border-hover)!important;}
  &:focus,&.is-focused,&:active,&.is-active { border-color:var(--im-color-primary)!important; box-shadow:0 0 0 0.125em var(--im-color-input-shadow)!important;}
}
.select:not(.is-multiple):not(.is-loading)::after { border-color:var(--im-color-primary)!important; transition:border-color $im-page-transition-duration var(--im-page-transition-timing-function);}
.checkbox, .radio {
    &:hover { color: var(--im-color-text)!important; }
}
.label { color: var(--im-color-text-strong)!important; font-weight: $im-font-weight-bold!important;}
.help { color: var(--im-color-text-light)!important;}
.control.has-icons-left .icon, .control.has-icons-right .icon { color: var(--im-color-border)!important; }
.input:focus ~ .icon, .textarea:focus ~ .icon, .select select:focus ~ .icon { color: var(--im-color-text-light)!important; }

// --- Tags ---
.tags .tag {
  border-radius: $im-border-radius * 0.5 !important;
  margin-bottom: $im-spacing-unit * 0.5 !important;
  transition: background-color $im-page-transition-duration var(--im-page-transition-timing-function), color $im-page-transition-duration var(--im-page-transition-timing-function), border-color $im-page-transition-duration var(--im-page-transition-timing-function);
}
.tag:not(body) { // Default tag
  background-color: var(--im-color-background) !important;
  color: var(--im-color-text) !important;
  &.is-primary { background-color:var(--im-color-primary)!important; color:var(--im-color-primary-inverted)!important;}
  &.is-link    { background-color:var(--im-color-link)!important;    color:var(--im-color-link-inverted)!important;}
  &.is-info    { background-color:var(--im-color-info)!important;    color:var(--im-color-info-inverted)!important;}
  &.is-success { background-color:var(--im-color-success)!important; color:var(--im-color-success-inverted)!important;}
  &.is-warning { background-color:var(--im-color-warning)!important; color:var(--im-color-warning-inverted)!important;}
  &.is-danger  { background-color:var(--im-color-danger)!important;  color:var(--im-color-danger-inverted)!important;}
  &.is-light   { background-color:var(--im-button-light-bg)!important; color:var(--im-button-light-text)!important;} // Match light button
  &.is-dark    { background-color: var(--im-color-text-strong)!important; color: var(--im-color-background)!important;}
  &.is-black   { background-color: #0a0a0a!important; color: #fff!important;}
  &.is-white   { background-color: #fff!important; color: #0a0a0a!important; border: 1px solid var(--im-color-border);}
}
.tags.has-addons .tag:not(:last-child) { margin-right: 0 !important; border-top-right-radius: 0 !important; border-bottom-right-radius: 0 !important; }
.tags.has-addons .tag:not(:first-child){ margin-left: 0 !important; border-top-left-radius: 0 !important; border-bottom-left-radius: 0 !important; }

// --- Notification & Message ---
.notification, .message {
  border-radius: $im-border-radius !important;
  padding: $im-content-padding * 0.8 $im-content-padding $im-content-padding * 0.8 !important;
  transition: background-color $im-page-transition-duration var(--im-page-transition-timing-function), color $im-page-transition-duration var(--im-page-transition-timing-function);
  strong { color: inherit !important; } // Ensure strong inherits notification text color
}
.notification {
  background-color: var(--im-color-background) !important;
  color: var(--im-color-text) !important;
  &.is-primary { background-color:var(--im-color-primary)!important; color:var(--im-color-primary-inverted)!important;}
  // Add other contextual notification colors if needed, similar to .tag
}
.message {
  background-color: var(--im-color-surface) !important; // Message body
  box-shadow: 0 0.5em 1em -0.125em rgba(10,10,10,.1), 0 0px 0 1px rgba(10,10,10,.02) !important;
  .message-header {
    background-color: var(--im-color-text-strong) !important; // Default message header
    color: var(--im-color-background) !important;
    border-bottom: 1px solid var(--im-color-border);
    font-weight: $im-font-weight-bold;
    border-top-left-radius: $im-border-radius !important;
    border-top-right-radius: $im-border-radius !important;
    transition: background-color $im-page-transition-duration var(--im-page-transition-timing-function), color $im-page-transition-duration var(--im-page-transition-timing-function);
  }
  .message-body {
    border-color: var(--im-color-border) !important;
    color: var(--im-color-text) !important;
    border-bottom-left-radius: $im-border-radius !important;
    border-bottom-right-radius: $im-border-radius !important;
    transition: border-color $im-page-transition-duration var(--im-page-transition-timing-function), color $im-page-transition-duration var(--im-page-transition-timing-function);
  }
  // Contextual Messages
  &.is-primary { .message-header{background-color:var(--im-color-primary)!important;color:var(--im-color-primary-inverted)!important;} .message-body{border-color:var(--im-color-primary)!important;}}
  // Add other contextual message colors...
}

// --- Table ---
.table {
  background-color: var(--im-color-surface) !important;
  color: var(--im-color-text) !important;
  th, td { border-color: var(--im-color-border-light) !important; transition: background-color $im-page-transition-duration var(--im-page-transition-timing-function), border-color $im-page-transition-duration var(--im-page-transition-timing-function), color $im-page-transition-duration var(--im-page-transition-timing-function);}
  th { color: var(--im-color-text-strong) !important; }
  thead th, thead td { border-width: 0 0 2px !important; }
  tbody tr:last-child td, tbody tr:last-child th { border-bottom-width: 0 !important; }
  &.is-hoverable tbody tr:hover { background-color: var(--im-color-table-row-hover) !important; }
  &.is-striped tbody tr:nth-child(odd) { background-color: var(--im-color-table-row-hover) !important; }
  &.is-bordered { th,td { border-width: 1px !important; }}
  &.is-fullwidth { width: 100% !important; }
}

// --- Progress Bar ---
.progress {
  background-color: var(--im-color-border-light) !important;
  border-radius: $im-border-radius * 2 !important; // More rounded
  &::-webkit-progress-bar { background-color: var(--im-color-border-light) !important; }
  &::-webkit-progress-value { background-color: var(--im-color-text) !important; border-radius: $im-border-radius * 2 !important; }
  &::-moz-progress-bar { background-color: var(--im-color-text) !important; border-radius: $im-border-radius * 2 !important; }
  &::-ms-fill { background-color: var(--im-color-text) !important; border-radius: $im-border-radius * 2 !important; }
  // Contextual progress bars
  &.is-primary::-webkit-progress-value { background-color:var(--im-color-primary)!important;} &.is-primary::-moz-progress-bar { background-color:var(--im-color-primary)!important;} &.is-primary::-ms-fill { background-color:var(--im-color-primary)!important;}
  // Add other contextual progress colors
}

// --- Pagination ---
.pagination-link, .pagination-previous, .pagination-next {
  border-color: var(--im-color-border) !important;
  color: var(--im-color-text) !important;
  border-radius: $im-border-radius * 0.5 !important;
  &:hover { border-color: var(--im-color-border-hover) !important; color: var(--im-color-primary) !important; }
  &.is-current { background-color: var(--im-color-primary) !important; border-color: var(--im-color-primary) !important; color: var(--im-color-primary-inverted) !important; }
  &:disabled { background-color: var(--im-color-background) !important; border-color: var(--im-color-border-light) !important; color: var(--im-color-text-muted) !important; opacity: 0.7; }
}
.pagination-ellipsis { color: var(--im-color-text-muted) !important; }

// --- Tabs ---
.tabs {
  a { border-bottom-color: var(--im-color-border) !important; color: var(--im-color-text) !important; &:hover { border-bottom-color: var(--im-color-text) !important; color: var(--im-color-text) !important; } }
  li.is-active a { border-bottom-color: var(--im-color-primary) !important; color: var(--im-color-primary) !important; }
  &.is-boxed {
    a { border-radius: $im-border-radius $im-border-radius 0 0 !important; border-color: var(--im-color-border) !important; &:hover { background-color: var(--im-color-background) !important; border-bottom-color: var(--im-color-border) !important; } }
    li.is-active a { background-color: var(--im-color-surface) !important; border-color: var(--im-color-border) !important; border-bottom-color: transparent !important; }
  }
  &.is-toggle {
    a { border-radius: $im-border-radius !important; border-color: var(--im-color-border) !important; margin-bottom: 0 !important; &:hover { background-color: var(--im-color-background) !important; border-color: var(--im-color-border-hover) !important; z-index: 2; } }
    li + li { margin-left: 0 !important; }
    li:first-child a { border-top-right-radius: 0 !important; border-bottom-right-radius: 0 !important; }
    li:last-child a { border-top-left-radius: 0 !important; border-bottom-left-radius: 0 !important; }
    li:not(:first-child):not(:last-child) a { border-radius: 0 !important; }
    li.is-active a { background-color: var(--im-color-primary) !important; border-color: var(--im-color-primary) !important; color: var(--im-color-primary-inverted) !important; z-index: 1; }
  }
}

// --- Menu ---
.menu-list a {
  border-radius: $im-border-radius * 0.5 !important;
  color: var(--im-color-text) !important;
  &:hover { background-color: var(--im-color-background) !important; color: var(--im-color-text-strong) !important; }
  &.is-active { background-color: var(--im-color-primary) !important; color: var(--im-color-primary-inverted) !important; }
}
.menu-label { color: var(--im-color-text-muted) !important; }

// --- Dropdown ---
.dropdown-trigger .button .icon { color: var(--im-color-text) !important; }
.dropdown-menu {
  background-color: var(--im-color-surface) !important;
  border-radius: $im-border-radius !important;
  box-shadow: 0 0.5em 1em -0.125em rgba(10,10,10,.1), 0 0 0 1px rgba(10,10,10,.02) !important;
  padding-top: 4px !important; padding-bottom: 4px !important;
  .dropdown-item {
    color: var(--im-color-text) !important;
    padding-right: 3rem !important; // Bulma default
    &:hover { background-color: var(--im-color-background) !important; color: var(--im-color-text-strong) !important; }
    &.is-active { background-color: var(--im-color-primary) !important; color: var(--im-color-primary-inverted) !important; }
  }
  .dropdown-divider { background-color: var(--im-color-border-light) !important; }
}

// --- Modal ---
.modal-background { background-color: rgba(10,10,10,.86) !important; } // Standard Bulma
.modal-card {
  background-color: var(--im-color-surface) !important;
  border-radius: $im-border-radius !important;
  .modal-card-head, .modal-card-foot { background-color: var(--im-color-surface) !important; border-color: var(--im-color-border-light) !important; }
  .modal-card-head { border-top-left-radius: $im-border-radius !important; border-top-right-radius: $im-border-radius !important; }
  .modal-card-foot { border-bottom-left-radius: $im-border-radius !important; border-bottom-right-radius: $im-border-radius !important; }
  .modal-card-title { color: var(--im-color-text-headings) !important; }
  .modal-card-body { background-color: var(--im-color-surface) !important; color: var(--im-color-text) !important; }
}
.modal-close { background-color: rgba(10,10,10,.2) !important; &:hover{background-color:rgba(10,10,10,.3)!important;}}

// --- Breadcrumb ---
.breadcrumb {
  a { color: var(--im-color-link) !important; &:hover { color: var(--im-color-primary) !important; }}
  li.is-active a { color: var(--im-color-text-strong) !important; }
  li + li::before { color: var(--im-color-text-light) !important; }
}

//------------------------------------------------------------------------------
// 7. Dark Mode Styles
//------------------------------------------------------------------------------
html.im-is-dark-mode {
  // Dark Mode Base Colors
  --im-color-primary: #f44336; // Brighter red for dark mode, if primary needs to change
  --im-color-primary-light: #ff7961;
  --im-color-primary-dark: #ba000d;
  --im-color-primary-rgb: 244, 67, 54; // RGB for #f44336
  // --im-color-primary-inverted: #FFFFFF; // Stays same

  --im-color-link: #64b5f6; // Brighter link blue
  --im-color-info: #4fc3f7;
  --im-color-success: #81c784;
  --im-color-warning: #ffd54f; // Warning might need dark text even in dark mode
  --im-color-danger: #e57373;

  --im-color-link-inverted: #000;
  --im-color-info-inverted: #000;
  --im-color-success-inverted: #000;
  --im-color-warning-inverted: rgba(0,0,0,0.85);
  --im-color-danger-inverted: #000;

  --im-color-text: #e0e0e0;
  --im-color-text-light: #bdbdbd;
  --im-color-text-strong: #f5f5f5;
  --im-color-text-headings: #ffffff;
  --im-color-text-muted: #9e9e9e;
  --im-color-text-on-surface: var(--im-color-text);

  --im-color-background: #1e1e1e; // Very dark grey
  --im-color-surface: #2c2c2c;   // Slightly lighter for surfaces
  --im-color-border: #424242;
  --im-color-border-light: #333333;
  --im-color-border-hover: #555555;
  --im-color-input-bg: #3a3a3a;
  --im-color-input-border: var(--im-color-border);
  --im-color-input-shadow: rgba(var(--im-color-primary-rgb), 0.35); // Use dark primary RGB if changed
  --im-color-table-row-hover: #383838;
  --im-color-code-background: #333;
  --im-color-pre-background: var(--im-color-code-background);
  --im-color-pre-text: #ccc;

  --im-button-light-bg: #424242;
  --im-button-light-border: #424242;
  --im-button-light-text: var(--im-color-text-headings);
  --im-button-light-hover-bg: #555555;
  --im-button-light-hover-border: #555555;

  --im-grid-line-color-for-section: rgba(255, 255, 255, 0.04);
  --im-grid-line-color-for-hero: rgba(255, 255, 255, 0.08);

  --im-dark-mode-toggle-icon-color: var(--im-color-text-light);

  // Specific Dark Mode Component Overrides
  .box, .card, .panel { box-shadow: 0 0.5em 1em -0.125em rgba(0,0,0,.5), 0 0px 0 1px rgba(0,0,0,.3) !important; }
  .navbar { box-shadow: 0 2px 0 0 var(--im-color-background) !important; }
  .footer { background-color: #121212 !important; } // Even darker footer
  code { background-color: var(--im-color-code-background); color: var(--im-color-info); } // Code more distinct
  pre { background-color: var(--im-color-pre-background); color: var(--im-color-pre-text); }
  hr { background-color: var(--im-color-border) !important; }

  .tags .tag:not(body) { // Dark mode tags
    &.is-dark    { background-color: var(--im-color-text-light)!important; color: var(--im-color-background)!important;}
    &.is-black   { background-color: #1c1c1c!important; color: #eee!important;} // Slightly off-black
    &.is-white   { background-color: #eee!important; color: #1c1c1c!important; border: 1px solid var(--im-color-border);}
  }
  .message .message-header { background-color: var(--im-color-surface) !important; color: var(--im-color-text-headings) !important; border-bottom: 1px solid var(--im-color-border-light);}
  .message.is-primary .message-header { background-color:var(--im-color-primary)!important; color:var(--im-color-primary-inverted)!important; }
  .modal-background { background-color: rgba(0,0,0,.92) !important; }
  .modal-close { background-color: rgba(20,20,20,.3) !important; &:hover{background-color:rgba(20,20,20,.4)!important;}}
}

//------------------------------------------------------------------------------
// 8. Dark Mode Toggle Switch CSS (Phosphor Icons based)
//------------------------------------------------------------------------------
.navbar-item.im-dark-mode-toggle {
  color: var(--im-dark-mode-toggle-icon-color) !important; // Use variable for icon color
  cursor: pointer;
  transition: color $im-page-transition-duration var(--im-page-transition-timing-function);
  &:hover, &:focus {
    background-color: transparent !important; // No bg change on hover for icon toggle
    color: var(--im-color-primary) !important; // Highlight with primary color
  }
  .icon i {
    font-size: 1.5rem; // Adjust if Phosphor icons are larger/smaller
    transition: transform 0.3s ease-in-out;
  }
}

// Rotate effect for icon switch (optional)
html.im-is-dark-mode .navbar-item.im-dark-mode-toggle .icon i.ph-sun,
html:not(.im-is-dark-mode) .navbar-item.im-dark-mode-toggle .icon i.ph-moon {
  // transform: rotate(-180deg);
}