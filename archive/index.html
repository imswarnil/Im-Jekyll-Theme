---
title: Archive
description: "Search for a page or post you're looking for. Browse all posts or filter by category."
layout: page
permalink: /archive/
---

<div class="container mt-5 mb-5">
    <div class="columns">
        <div class="column"> {/* Was is-three-quarters, now full width as sidebar is inline */}
            <!-- In-page Sidebar for Category Selection -->
            <aside class="menu p-4 mb-5 has-background-light" style="border-radius: 6px;">
                <p class="menu-label">
                    Categories
                </p>
                <ul class="menu-list" id="category-filter-list">
                    <li><a href="#all" data-category="all" class="category-link is-active">All Posts</a></li>
                    {% assign categories_sorted = site.categories | sort %}
                    {% for category_item in categories_sorted %}
                        {% assign cat_name = category_item[0] %}
                        {% assign cat_slug = cat_name | slugify %}
                        {% assign cat_posts_count = category_item[1].size %}
                        <li>
                            <a href="#{{ cat_slug }}" data-category="{{ cat_slug }}" class="category-link">
                                {{ cat_name | capitalize }} ({{ cat_posts_count }})
                            </a>
                        </li>
                    {% endfor %}
                </ul>
            </aside>

            <h1 class="title is-3" id="archive-title">All Posts</h1>
            <hr>

            <!-- Section for Jekyll's default paginator (All Posts) -->
            <section id="jekyll-paginated-content" class="section archive-column-cards p-0">
                <div id="post-list-jekyll" class="columns is-multiline">
                    {% assign posts_processed_count_jekyll = 0 %}
                    {% if paginator.posts.size == 0 and page.url == "/archive/" %}
                        <div class="column is-full">
                            <p class="has-text-centered">No posts found.</p>
                        </div>
                    {% endif %}

                    {% for post in paginator.posts %}
                        {% assign posts_processed_count_jekyll = posts_processed_count_jekyll | plus: 1 %}

                        <div class="column is-one-third-desktop is-half-tablet is-full-mobile">
                            <a href="{{ post.url | relative_url }}" class="post-item-link">
                                <div class="box post-item-box">
                                    {% if post.image and post.category != "video" %}
                                    <figure class="image is-4by3 mb-4">
                                        <img src="{{ post.image | relative_url }}" alt="{{ post.title }}">
                                    </figure>
                                    {% elsif post.category == "video" and post.VideoId %}
                                    <figure class="image is-16by9 mb-4 video-thumbnail-container-column">
                                        <img src="https://i.ytimg.com/vi/{{ post.VideoId }}/hqdefault.jpg" alt="{{ post.title }}">
                                        {% if post.duration %}
                                        <div class="is-overlay is-flex is-align-items-flex-end is-justify-content-flex-end p-2">
                                            <span class="tag is-dark is-rounded">{{ post.duration }}</span>
                                        </div>
                                        {% endif %}
                                        <div class="is-overlay is-flex is-align-items-center is-justify-content-center video-play-indicator-column">
                                            <span class="icon is-large has-text-white has-background-dark-transparent-overlay-column">
                                                <i class="ph-fill ph-play-circle"></i>
                                            </span>
                                        </div>
                                    </figure>
                                    {% endif %}
                                    <div class="content">
                                        <div class="level is-mobile is-marginless mb-3">
                                            <div class="level-left">
                                                <div class="level-item">
                                                    <span class="tag
                                                        {% if post.category == 'journal' %}is-warning{% endif %}
                                                        {% if post.category == 'video' %}is-danger{% endif %}
                                                        {% if post.category == 'project' %}is-primary{% endif %}
                                                        {% if post.category != 'journal' and post.category != 'video' and post.category != 'project' %}is-info{% endif %}
                                                        is-light is-rounded is-capitalized">
                                                        <span class="icon is-small mr-1">
                                                            {% if post.category == "journal" %}<i class="ph ph-notebook"></i>
                                                            {% elsif post.category == "video" %}<i class="ph ph-youtube-logo"></i>
                                                            {% elsif post.category == "project" %}<i class="ph ph-git-branch"></i>
                                                            {% else %}<i class="ph ph-article"></i>
                                                            {% endif %}
                                                        </span>
                                                        {{ post.category | default: "Blog" }}
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="level-right">
                                                <p class="level-item is-size-7 has-text-grey">
                                                    <time datetime="{{ post.date | date_to_xmlschema }}">{{ post.date | date: "%b %d, '%y" }}</time>
                                                </p>
                                            </div>
                                        </div>
                                        <p class="title is-5 mb-2">{{ post.title }}</p>
                                        <p class="is-size-6 excerpt-text-column">
                                            {% if post.excerpt %}{{ post.excerpt | strip_html | truncate: 100 }}{% else %}{{ post.content | strip_html | truncate: 100 }}{% endif %}
                                        </p>
                                        {% if post.TLTR %}
                                        <article class="message is-light is-small mt-4 {% if post.category == 'journal' %}is-warning{% else %}is-info{% endif %}">
                                            <div class="message-body py-2 px-3"><strong>TL;DR:</strong> {{ post.TLTR }}</div>
                                        </article>
                                        {% endif %}
                                    </div>
                                    <div class="post-item-footer mt-auto pt-3">
                                        {% if post.category == "project" %}
                                            <div class="buttons are-small is-centered">
                                                {% if post.live_url %}<a href="{{ post.live_url }}" class="button is-link is-light" target="_blank" rel="noopener">Demo</a>{% endif %}
                                                {% if post.repo_url %}<a href="{{ post.repo_url }}" class="button is-dark is-light" target="_blank" rel="noopener">Code</a>{% endif %}
                                            </div>
                                        {% elsif post.tags %}
                                             <div class="tags are-small is-centered">
                                                {% for tag in post.tags limit:3 %}
                                                <span class="tag is-light">{{ tag }}</span>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </a>
                        </div>

                        {% comment %} Ad and Newsletter Placement for Jekyll Paginated View {% endcomment %}
                        {% if posts_processed_count_jekyll == 1 %}
                            <div class="column is-one-third-desktop is-half-tablet is-full-mobile ad-slot-jekyll-1">
                                 <div class="box post-item-box ad-placeholder-box" style="display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 250px;">
                                    <p class="is-size-7 has-text-grey-light mb-2">Advertisement</p>
                                    {% include adsense.html format="square" %}
                                    {% capture ad_include_output %}{% include adsense.html format="square" %}{% endcapture %}
                                    {% if ad_include_output == "" or ad_include_output == nil %}
                                    <div class="has-background-white-ter ad-fallback-placeholder" style="width: 100%; min-height: 230px; display:flex; align-items:center; justify-content:center; border: 1px dashed var(--bulma-grey-lighter); border-radius: var(--bulma-radius-small);">
                                        <span class="icon is-large has-text-grey-lighter"><i class="ph ph-megaphone"></i></span>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        {% elsif posts_processed_count_jekyll == 3 %}
                         <div class="column is-one-third-desktop is-half-tablet is-full-mobile newsletter-slot-jekyll-1">
                            <div class="box post-item-box newsletter-box-column has-background-info-light" style="min-height: 250px; display: flex; flex-direction: column; justify-content: center;">
                                <div class="has-text-centered">
                                     <span class="icon is-large has-text-info mb-3"><i class="ph ph-envelope-simple-open"></i></span>
                                    <p class="title is-5 has-text-info-dark">Stay Updated!</p>
                                    <p class="subtitle is-6 has-text-grey-darker">Subscribe for the latest posts & news.</p>
                                  <div class="ghost-signup-form-container" style="min-height: 58px;max-width: 440px;margin: 0 auto;width: 100%"><script src="https://cdn.jsdelivr.net/ghost/signup-form@~0.2/umd/signup-form.min.js" data-label-1="IsActive" data-button-color="#e53935" data-button-text-color="#FFFFFF" data-site="https://imswarnil.com/" data-locale="en" async></script></div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>

                {% if paginator.total_pages > 1 %}
                <nav id="jekyll-pagination-controls" class="pagination is-centered is-rounded mt-6" role="navigation" aria-label="pagination">
                    {% if paginator.previous_page %}
                        <a href="{{ paginator.previous_page_path | prepend: site.baseurl | replace: '//', '/' }}" class="pagination-previous button is-light">
                            <span class="icon is-small"><i class="ph ph-caret-left"></i></span><span>Previous</span>
                        </a>
                    {% else %}
                        <a class="pagination-previous button is-light" disabled>
                            <span class="icon is-small"><i class="ph ph-caret-left"></i></span><span>Previous</span>
                        </a>
                    {% endif %}
                    {% if paginator.next_page %}
                        <a href="{{ paginator.next_page_path | prepend: site.baseurl | replace: '//', '/' }}" class="pagination-next button is-light">
                            <span>Next</span><span class="icon is-small"><i class="ph ph-caret-right"></i></span>
                        </a>
                    {% else %}
                        <a class="pagination-next button is-light" disabled>
                            <span>Next</span><span class="icon is-small"><i class="ph ph-caret-right"></i></span>
                        </a>
                    {% endif %}
                    <ul class="pagination-list">
                        {% for page_number in (1..paginator.total_pages) %}
                        <li>
                            <a href="{% if page_number == 1 %}{{ '/archive/' | relative_url }}{% else %}{{ site.paginate_path | relative_url | replace: ':num', page_number }}{% endif %}"
                               class="pagination-link {% if page_number == paginator.page %}is-current{% endif %}"
                               aria-label="Goto page {{ page_number }}">
                               {{ page_number }}
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                </nav>
                {% endif %}
            </section>

            <!-- Section for Category-Specific Posts (JS Driven) -->
            <section id="category-specific-content" class="section archive-column-cards p-0" style="display: none;">
                <div id="post-list-category" class="columns is-multiline">
                    <!-- JS will populate this -->
                </div>
                <nav id="category-pagination-controls" class="pagination is-centered is-rounded mt-6" style="display: none;">
                    <a id="category-prev" class="pagination-previous button is-light">
                        <span class="icon is-small"><i class="ph ph-caret-left"></i></span><span>Previous</span>
                    </a>
                    <a id="category-next" class="pagination-next button is-light">
                        <span>Next</span><span class="icon is-small"><i class="ph ph-caret-right"></i></span>
                    </a>
                    <ul id="category-page-list" class="pagination-list"></ul>
                </nav>
            </section>

        </div>
        <!-- Original sidebar column removed as per "all code here itself" and inline category list -->
    </div>
</div>

<!-- Data for JavaScript -->
<script id="all_site_posts_data" type="application/json">
  {{ site.posts | jsonify }}
</script>
<script id="site_baseurl_data" type="application/json">
  {{ site.baseurl | jsonify }}
</script>

<!-- Templates for Ad and Newsletter (for JS rendering) -->
<template id="ad-slot-template">
    <div class="column is-one-third-desktop is-half-tablet is-full-mobile">
        <div class="box post-item-box ad-placeholder-box" style="display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 250px;">
            <p class="is-size-7 has-text-grey-light mb-2">Advertisement</p>
            <!-- Actual AdSense code would ideally be initialized here if needed, or use a pre-existing initialized ad unit ID -->
            <!-- For simplicity, we'll use the fallback placeholder structure -->
            <div class="has-background-white-ter ad-fallback-placeholder" style="width: 100%; min-height: 230px; display:flex; align-items:center; justify-content:center; border: 1px dashed var(--bulma-grey-lighter); border-radius: var(--bulma-radius-small);">
                <span class="icon is-large has-text-grey-lighter"><i class="ph ph-megaphone"></i></span>
            </div>
        </div>
    </div>
</template>

<template id="newsletter-slot-template">
    <div class="column is-one-third-desktop is-half-tablet is-full-mobile">
        <div class="box post-item-box newsletter-box-column has-background-info-light" style="min-height: 250px; display: flex; flex-direction: column; justify-content: center;">
            <div class="has-text-centered">
                <span class="icon is-large has-text-info mb-3"><i class="ph ph-envelope-simple-open"></i></span>
                <p class="title is-5 has-text-info-dark">Stay Updated!</p>
                <p class="subtitle is-6 has-text-grey-darker">Subscribe for the latest posts & news.</p>
                <div class="ghost-signup-form-container" style="min-height: 58px;max-width: 440px;margin: 0 auto;width: 100%">
                    <!-- The script will be handled by the main page load; we just provide the container -->
                </div>
            </div>
        </div>
    </div>
</template>


<script>
document.addEventListener('DOMContentLoaded', () => {
    const postsData = JSON.parse(document.getElementById('all_site_posts_data').textContent);
    const siteBaseUrl = JSON.parse(document.getElementById('site_baseurl_data').textContent) || "";

    const postsPerPage = 3; // Same as your Jekyll paginate setting
    let currentCategory = 'all';
    let currentPage = 1;
    let categoryPosts = [];

    const jekyllPaginatedContent = document.getElementById('jekyll-paginated-content');
    const categorySpecificContent = document.getElementById('category-specific-content');
    const postListCategoryContainer = document.getElementById('post-list-category');
    const categoryPaginationControls = document.getElementById('category-pagination-controls');
    const archiveTitle = document.getElementById('archive-title');

    const categoryLinks = document.querySelectorAll('.category-link');
    const categoryPrevButton = document.getElementById('category-prev');
    const categoryNextButton = document.getElementById('category-next');
    const categoryPageList = document.getElementById('category-page-list');

    // Ad/Newsletter templates
    const adSlotTemplate = document.getElementById('ad-slot-template').content.cloneNode(true);
    const newsletterSlotTemplate = document.getElementById('newsletter-slot-template').content.cloneNode(true);


    function getPostCardHTML(post) {
        // Helper to safely get relative URL
        const relativeUrl = (url) => {
            if (!url) return '';
            // Assuming post.url from Jekyll is already relative or absolute correctly
            // For client-side, if it's absolute, it's fine. If relative, ensure it works.
            // Jekyll's `relative_url` filter handles `site.baseurl`. We emulate that partially.
            if (siteBaseUrl && url.startsWith('/')) {
                 // Prevent double slashes if baseurl is "/" or empty, and url also starts with "/"
                if (siteBaseUrl === '/' && url.startsWith('/')) {
                    return url;
                }
                return siteBaseUrl.replace(/\/$/, '') + url;
            }
            return url;
        };

        let imageHTML = '';
        if (post.image && post.category !== 'video') {
            imageHTML = `
            <figure class="image is-4by3 mb-4">
                <img src="${relativeUrl(post.image)}" alt="${post.title}">
            </figure>`;
        } else if (post.category === 'video' && post.VideoId) {
            let durationHTML = '';
            if (post.duration) {
                durationHTML = `
                <div class="is-overlay is-flex is-align-items-flex-end is-justify-content-flex-end p-2">
                    <span class="tag is-dark is-rounded">${post.duration}</span>
                </div>`;
            }
            imageHTML = `
            <figure class="image is-16by9 mb-4 video-thumbnail-container-column">
                <img src="https://i.ytimg.com/vi/${post.VideoId}/hqdefault.jpg" alt="${post.title}">
                ${durationHTML}
                <div class="is-overlay is-flex is-align-items-center is-justify-content-center video-play-indicator-column">
                    <span class="icon is-large has-text-white has-background-dark-transparent-overlay-column">
                        <i class="ph-fill ph-play-circle"></i>
                    </span>
                </div>
            </figure>`;
        }

        let categoryTagClass = 'is-info';
        if (post.category === 'journal') categoryTagClass = 'is-warning';
        else if (post.category === 'video') categoryTagClass = 'is-danger';
        else if (post.category === 'project') categoryTagClass = 'is-primary';

        let categoryIconClass = 'ph-article';
        if (post.category === 'journal') categoryIconClass = 'ph-notebook';
        else if (post.category === 'video') categoryIconClass = 'ph-youtube-logo';
        else if (post.category === 'project') categoryIconClass = 'ph-git-branch';

        // Format date: Input is likely YYYY-MM-DD HH:MM:SS +/-ZZZZ
        // Output: Mon DD, 'YY
        let postDateFormatted = '';
        if (post.date) {
            try {
                const d = new Date(post.date);
                postDateFormatted = d.toLocaleDateString('en-US', { month: 'short', day: '2-digit', year: '2-digit' }).replace(',', ", '");
            } catch (e) {
                // fallback or leave empty
            }
        }


        let excerptHTML = '';
        // Note: strip_html and truncate are Liquid filters. JS needs to replicate or simplify.
        // For simplicity, just use excerpt if available, or a snippet of content.
        // Real HTML stripping and truncation in JS is more involved.
        let excerptText = post.excerpt ? post.excerpt : (post.content ? post.content.substring(0, 150) + "..." : "");
        // Basic HTML tag removal for excerpt
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = excerptText;
        excerptText = (tempDiv.textContent || tempDiv.innerText || "").substring(0,100);


        excerptHTML = `<p class="is-size-6 excerpt-text-column">${excerptText}</p>`;

        let tltrHTML = '';
        if (post.TLTR) {
            tltrHTML = `
            <article class="message is-light is-small mt-4 ${post.category === 'journal' ? 'is-warning' : 'is-info'}">
                <div class="message-body py-2 px-3"><strong>TL;DR:</strong> ${post.TLTR}</div>
            </article>`;
        }

        let footerHTML = '';
        if (post.category === "project") {
            let demoButton = post.live_url ? `<a href="${post.live_url}" class="button is-link is-light" target="_blank" rel="noopener">Demo</a>` : '';
            let codeButton = post.repo_url ? `<a href="${post.repo_url}" class="button is-dark is-light" target="_blank" rel="noopener">Code</a>` : '';
            footerHTML = `<div class="buttons are-small is-centered">${demoButton}${codeButton}</div>`;
        } else if (post.tags && post.tags.length > 0) {
            let tagsHTML = post.tags.slice(0, 3).map(tag => `<span class="tag is-light">${tag}</span>`).join('');
            footerHTML = `<div class="tags are-small is-centered">${tagsHTML}</div>`;
        }

        return `
        <div class="column is-one-third-desktop is-half-tablet is-full-mobile">
            <a href="${relativeUrl(post.url)}" class="post-item-link">
                <div class="box post-item-box">
                    ${imageHTML}
                    <div class="content">
                        <div class="level is-mobile is-marginless mb-3">
                            <div class="level-left">
                                <div class="level-item">
                                    <span class="tag ${categoryTagClass} is-light is-rounded is-capitalized">
                                        <span class="icon is-small mr-1"><i class="ph ${categoryIconClass}"></i></span>
                                        ${post.category || 'Blog'}
                                    </span>
                                </div>
                            </div>
                            <div class="level-right">
                                <p class="level-item is-size-7 has-text-grey">
                                    <time datetime="${post.date}">${postDateFormatted}</time>
                                </p>
                            </div>
                        </div>
                        <p class="title is-5 mb-2">${post.title}</p>
                        ${excerptHTML}
                        ${tltrHTML}
                    </div>
                    <div class="post-item-footer mt-auto pt-3">
                        ${footerHTML}
                    </div>
                </div>
            </a>
        </div>`;
    }

    function renderCategoryPosts() {
        postListCategoryContainer.innerHTML = '';
        const start = (currentPage - 1) * postsPerPage;
        const end = start + postsPerPage;
        const paginatedItems = categoryPosts.slice(start, end);

        let postsRenderedCount = 0;
        paginatedItems.forEach((post, index) => {
            postListCategoryContainer.innerHTML += getPostCardHTML(post);
            postsRenderedCount++;

            if (postsRenderedCount === 1 && categoryPosts.length > 1) { // After 1st post, if more exist
                const adElement = adSlotTemplate.firstElementChild.cloneNode(true);
                postListCategoryContainer.appendChild(adElement);
            } else if (postsRenderedCount === 3 && categoryPosts.length > 3) { // After 3rd post, if more exist
                 const newsletterElement = newsletterSlotTemplate.firstElementChild.cloneNode(true);
                postListCategoryContainer.appendChild(newsletterElement);
                 // Ensure Ghost script re-initializes if necessary, or ensure it's loaded globally
                if (window.SignUpForm) { // Simple check, might need more robust
                   const ghostContainer = newsletterElement.querySelector('.ghost-signup-form-container');
                   if(ghostContainer) {
                     // Re-create script tag for Ghost to potentially re-init on new container
                     const script = document.createElement('script');
                     script.src = "https://cdn.jsdelivr.net/ghost/signup-form@~0.2/umd/signup-form.min.js";
                     script.setAttribute('data-label-1', "IsActive");
                     script.setAttribute('data-button-color',"#e53935");
                     script.setAttribute('data-button-text-color',"#FFFFFF");
                     script.setAttribute('data-site', "https://imswarnil.com/"); // Replace with your site
                     script.setAttribute('data-locale',"en");
                     script.async = true;
                     ghostContainer.innerHTML = ''; // Clear previous if any
                     ghostContainer.appendChild(script);
                   }
                }
            }
        });

        renderCategoryPaginationControls();
        jekyllPaginatedContent.style.display = 'none';
        categorySpecificContent.style.display = 'block';
        categoryPaginationControls.style.display = 'flex';
    }

    function renderCategoryPaginationControls() {
        categoryPageList.innerHTML = '';
        const totalPages = Math.ceil(categoryPosts.length / postsPerPage);

        categoryPrevButton.disabled = currentPage === 1;
        categoryNextButton.disabled = currentPage === totalPages || totalPages === 0;

        for (let i = 1; i <= totalPages; i++) {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.classList.add('pagination-link');
            if (i === currentPage) {
                a.classList.add('is-current');
            }
            a.href = `#${currentCategory}/page/${i}`;
            a.textContent = i;
            a.dataset.page = i;
            a.addEventListener('click', (e) => {
                e.preventDefault();
                currentPage = parseInt(e.target.dataset.page);
                renderCategoryPosts();
                updateURLHash();
            });
            li.appendChild(a);
            categoryPageList.appendChild(li);
        }
    }

    function updateURLHash() {
        if (currentCategory === 'all') {
            // For 'all', rely on Jekyll's pagination URLs.
            // If we are on page 1 of 'all', remove hash.
            // If on other pages of 'all', the URL is already /archive/page/N/
            if (window.location.pathname.includes('/page/')) {
                 // The URL is already a jekyll paginated one, hash isn't primary
            } else {
                 history.pushState(null, null, '#all'); // or clear hash: window.location.pathname + window.location.search
            }
        } else {
            history.pushState(null, null, `#${currentCategory}/page/${currentPage}`);
        }
    }
    
    function handleCategorySelection(selectedCategorySlug, targetPage = 1) {
        currentCategory = selectedCategorySlug;
        currentPage = targetPage;

        categoryLinks.forEach(link => {
            link.classList.toggle('is-active', link.dataset.category === currentCategory);
        });

        if (currentCategory === 'all') {
            archiveTitle.textContent = 'All Posts';
            jekyllPaginatedContent.style.display = 'block';
            categorySpecificContent.style.display = 'none';
            // If navigating to "all", and current URL is not a jekyll paginated one for "all", go to base archive.
            // This logic assumes that if currentCategory becomes 'all', we want Jekyll's pagination.
            // If the current URL is already /archive/ or /archive/page/N/, it's fine.
            // If it was /archive/#video/page/2, and user clicks "All", we should go to /archive/
            if (!window.location.pathname.startsWith('/archive/page/') && window.location.pathname !== '/archive/') {
                if (targetPage > 1) { // User explicitly trying to go to a page of "all"
                    window.location.href = `${siteBaseUrl}/archive/page/${targetPage}/#all`;
                } else {
                    window.location.href = `${siteBaseUrl}/archive/#all`;
                }
                return; // page will reload
            }
        } else {
            const categoryObject = postsData.find(p => p.category && p.category.toLowerCase().replace(/\s+/g, '-') === currentCategory);
            const categoryDisplayName = categoryObject ? categoryObject.category : currentCategory.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            archiveTitle.textContent = `Posts in: ${categoryDisplayName}`;
            
            categoryPosts = postsData.filter(post => post.category && post.category.toLowerCase().replace(/\s+/g, '-') === currentCategory);
            // Sort category posts by date descending (newest first)
            categoryPosts.sort((a, b) => new Date(b.date) - new Date(a.date));
            renderCategoryPosts();
        }
        updateURLHash();
    }


    categoryLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const selectedSlug = e.target.dataset.category;
            handleCategorySelection(selectedSlug, 1); // Go to page 1 of new category
        });
    });

    categoryPrevButton.addEventListener('click', (e) => {
        e.preventDefault();
        if (currentPage > 1) {
            currentPage--;
            renderCategoryPosts();
            updateURLHash();
        }
    });

    categoryNextButton.addEventListener('click', (e) => {
        e.preventDefault();
        const totalPages = Math.ceil(categoryPosts.length / postsPerPage);
        if (currentPage < totalPages) {
            currentPage++;
            renderCategoryPosts();
            updateURLHash();
        }
    });

    // Initial load handling based on URL hash
    function handleInitialLoad() {
        let hash = window.location.hash.substring(1); // Remove #
        let initialCategory = 'all';
        let initialPage = 1;

        if (hash) {
            const parts = hash.split('/page/');
            if (parts.length > 0 && parts[0] !== "" && parts[0] !== "all") {
                initialCategory = parts[0];
                 if (parts.length > 1 && !isNaN(parseInt(parts[1]))) {
                    initialPage = parseInt(parts[1]);
                }
            } else if (parts[0] === "all" && window.location.pathname.includes('/archive/page/')) {
                // If #all and on a jekyll paginated page, stay on "all" mode
                initialCategory = 'all';
                // Jekyll handles current page for 'all' via URL path, not JS currentPage
            }
        }
        
        // If initialCategory is 'all' and we are on a /archive/page/N/, Jekyll's pagination handles it.
        // We only switch to JS rendering if a specific category is in the hash.
        if (initialCategory !== 'all') {
            handleCategorySelection(initialCategory, initialPage);
        } else {
            // Ensure 'All Posts' link is active if no specific category hash
            categoryLinks.forEach(link => {
                link.classList.toggle('is-active', link.dataset.category === 'all');
            });
            jekyllPaginatedContent.style.display = 'block';
            categorySpecificContent.style.display = 'none';
        }
    }

    handleInitialLoad();
    window.addEventListener('hashchange', handleInitialLoad); // Re-evaluate if hash changes externally

});
</script>